<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Mongoid::Persistable
  
    &mdash; mongoid-7.3.0.alpha
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongoid::Persistable";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span></span>
     &raquo; 
    <span class="title">Persistable</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Mongoid::Persistable
  
  
  
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>ActiveSupport::Concern</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)">Creatable</a></span>, <span class='object_link'><a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)">Deletable</a></span>, <span class='object_link'><a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)">Destroyable</a></span>, <span class='object_link'><a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)">Incrementable</a></span>, <span class='object_link'><a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)">Logical</a></span>, <span class='object_link'><a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)">Poppable</a></span>, <span class='object_link'><a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)">Pullable</a></span>, <span class='object_link'><a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)">Pushable</a></span>, <span class='object_link'><a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)">Renamable</a></span>, <span class='object_link'><a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)">Savable</a></span>, <span class='object_link'><a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)">Settable</a></span>, <span class='object_link'><a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)">Unsettable</a></span>, <span class='object_link'><a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)">Updatable</a></span>, <span class='object_link'><a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)">Upsertable</a></span>, <span class='object_link'><a href="Positional.html" title="Mongoid::Positional (module)">Positional</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="Composable.html" title="Mongoid::Composable (module)">Composable</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongoid/persistable.rb<span class="defines">,<br />
  lib/mongoid/persistable/logical.rb,<br /> lib/mongoid/persistable/savable.rb,<br /> lib/mongoid/persistable/poppable.rb,<br /> lib/mongoid/persistable/pullable.rb,<br /> lib/mongoid/persistable/pushable.rb,<br /> lib/mongoid/persistable/settable.rb,<br /> lib/mongoid/persistable/creatable.rb,<br /> lib/mongoid/persistable/deletable.rb,<br /> lib/mongoid/persistable/renamable.rb,<br /> lib/mongoid/persistable/updatable.rb,<br /> lib/mongoid/persistable/unsettable.rb,<br /> lib/mongoid/persistable/upsertable.rb,<br /> lib/mongoid/persistable/destroyable.rb,<br /> lib/mongoid/persistable/incrementable.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Contains general behavior for persistence operations.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)">Creatable</a></span>, <span class='object_link'><a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)">Deletable</a></span>, <span class='object_link'><a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)">Destroyable</a></span>, <span class='object_link'><a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)">Incrementable</a></span>, <span class='object_link'><a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)">Logical</a></span>, <span class='object_link'><a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)">Poppable</a></span>, <span class='object_link'><a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)">Pullable</a></span>, <span class='object_link'><a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)">Pushable</a></span>, <span class='object_link'><a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)">Renamable</a></span>, <span class='object_link'><a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)">Savable</a></span>, <span class='object_link'><a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)">Settable</a></span>, <span class='object_link'><a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)">Unsettable</a></span>, <span class='object_link'><a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)">Updatable</a></span>, <span class='object_link'><a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)">Upsertable</a></span>
    
  
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="LIST_OPERATIONS-constant" class="">LIST_OPERATIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>The atomic operations that deal with arrays or sets in the db.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$addToSet</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$push</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pull</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$pullAll</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#atomically-instance_method" title="#atomically (instance method)">#<strong>atomically</strong>(join_context: nil)  &#x21d2; true, false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute operations atomically (in a single database call) for everything that would happen inside the block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail_due_to_callback!-instance_method" title="#fail_due_to_callback! (instance method)">#<strong>fail_due_to_callback!</strong>(method)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Raise an error if a callback failed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fail_due_to_validation!-instance_method" title="#fail_due_to_validation! (instance method)">#<strong>fail_due_to_validation!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Raise an error if validation failed.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Unsettable.html" title="Mongoid::Persistable::Unsettable (module)">Unsettable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Unsettable.html#unset-instance_method" title="Mongoid::Persistable::Unsettable#unset (method)">#unset</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Upsertable.html" title="Mongoid::Persistable::Upsertable (module)">Upsertable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Upsertable.html#upsert-instance_method" title="Mongoid::Persistable::Upsertable#upsert (method)">#upsert</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Updatable.html" title="Mongoid::Persistable::Updatable (module)">Updatable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Updatable.html#update-instance_method" title="Mongoid::Persistable::Updatable#update (method)">#update</a></span>, <span class='object_link'><a href="Persistable/Updatable.html#update!-instance_method" title="Mongoid::Persistable::Updatable#update! (method)">#update!</a></span>, <span class='object_link'><a href="Persistable/Updatable.html#update_attribute-instance_method" title="Mongoid::Persistable::Updatable#update_attribute (method)">#update_attribute</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Settable.html" title="Mongoid::Persistable::Settable (module)">Settable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Settable.html#set-instance_method" title="Mongoid::Persistable::Settable#set (method)">#set</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Savable.html" title="Mongoid::Persistable::Savable (module)">Savable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Savable.html#save-instance_method" title="Mongoid::Persistable::Savable#save (method)">#save</a></span>, <span class='object_link'><a href="Persistable/Savable.html#save!-instance_method" title="Mongoid::Persistable::Savable#save! (method)">#save!</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Renamable.html" title="Mongoid::Persistable::Renamable (module)">Renamable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Renamable.html#rename-instance_method" title="Mongoid::Persistable::Renamable#rename (method)">#rename</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Pushable.html" title="Mongoid::Persistable::Pushable (module)">Pushable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Pushable.html#add_to_set-instance_method" title="Mongoid::Persistable::Pushable#add_to_set (method)">#add_to_set</a></span>, <span class='object_link'><a href="Persistable/Pushable.html#push-instance_method" title="Mongoid::Persistable::Pushable#push (method)">#push</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Pullable.html" title="Mongoid::Persistable::Pullable (module)">Pullable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Pullable.html#pull-instance_method" title="Mongoid::Persistable::Pullable#pull (method)">#pull</a></span>, <span class='object_link'><a href="Persistable/Pullable.html#pull_all-instance_method" title="Mongoid::Persistable::Pullable#pull_all (method)">#pull_all</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Positional.html" title="Mongoid::Positional (module)">Positional</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Positional.html#positionally-instance_method" title="Mongoid::Positional#positionally (method)">#positionally</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Poppable.html" title="Mongoid::Persistable::Poppable (module)">Poppable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Poppable.html#pop-instance_method" title="Mongoid::Persistable::Poppable#pop (method)">#pop</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Logical.html" title="Mongoid::Persistable::Logical (module)">Logical</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Logical.html#bit-instance_method" title="Mongoid::Persistable::Logical#bit (method)">#bit</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Incrementable.html" title="Mongoid::Persistable::Incrementable (module)">Incrementable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Incrementable.html#inc-instance_method" title="Mongoid::Persistable::Incrementable#inc (method)">#inc</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Destroyable.html" title="Mongoid::Persistable::Destroyable (module)">Destroyable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Destroyable.html#destroy-instance_method" title="Mongoid::Persistable::Destroyable#destroy (method)">#destroy</a></span>, <span class='object_link'><a href="Persistable/Destroyable.html#destroy!-instance_method" title="Mongoid::Persistable::Destroyable#destroy! (method)">#destroy!</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Deletable.html" title="Mongoid::Persistable::Deletable (module)">Deletable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Deletable.html#delete-instance_method" title="Mongoid::Persistable::Deletable#delete (method)">#delete</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Persistable/Creatable.html" title="Mongoid::Persistable::Creatable (module)">Creatable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Persistable/Creatable.html#insert-instance_method" title="Mongoid::Persistable::Creatable#insert (method)">#insert</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="atomically-instance_method">
  
    #<strong>atomically</strong>(join_context: nil)  &#x21d2; <tt>true</tt>, <tt>false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute operations atomically (in a single database call) for everything that would happen inside the block. This method supports nesting further calls to atomically, which will behave according to the options described below.</p>

<p>An option join_context can be given which, when true, will merge the operations declared by the given block with the atomically block wrapping the current invocation for the same document, if one exists. If this block or any other block sharing the same context raises before persisting, then all the operations of that context will not be persisted, and will also be reset in memory.</p>

<p>When join_context is false, the given block of operations will be persisted independently of other contexts. Failures in other contexts will not affect this one, so long as this block was able to run and persist changes.</p>

<p>The default value of join_context is set by the global configuration option join_contexts, whose own default is false.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Execute the operations atomically.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_atomically'>atomically</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tool</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inc'>inc</span><span class='lparen'>(</span><span class='label'>likes:</span> <span class='int'>10</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Execute some inner operations atomically, but independently from the outer operations.</p>
</div></p>
      
      <pre class="example code"><code>
<span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_atomically'>atomically</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_inc'>inc</span> <span class='label'>likes:</span> <span class='int'>10</span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_atomically'>atomically</span> <span class='label'>join_context:</span> <span class='kw'>false</span> <span class='kw'>do</span>
    <span class='comment'># The following is persisted to the database independently.
</span>    <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_unset'>unset</span> <span class='symbol'>:origin</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_atomically'>atomically</span> <span class='label'>join_context:</span> <span class='kw'>true</span> <span class='kw'>do</span>
    <span class='comment'># The following is persisted along with the other outer operations.
</span>    <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_inc'>inc</span> <span class='label'>member_count:</span> <span class='int'>3</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tool</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>join_context</span>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Join the context (i.e. merge declared atomic operations) of the atomically block wrapping this one for the same document, if one exists.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the operation succeeded.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongoid/persistable.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_atomically'>atomically</span><span class='lparen'>(</span><span class='label'>join_context:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_join_context'>join_context</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Mongoid.html" title="Mongoid (module)">Mongoid</a></span></span><span class='period'>.</span><span class='id identifier rubyid_join_contexts'>join_contexts</span> <span class='kw'>if</span> <span class='id identifier rubyid_join_context'>join_context</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_call_depth'>call_depth</span> <span class='op'>=</span> <span class='ivar'>@atomic_depth</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_has_own_context'>has_own_context</span> <span class='op'>=</span> <span class='id identifier rubyid_call_depth'>call_depth</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_join_context'>join_context</span>
  <span class='ivar'>@atomic_updates_to_execute_stack</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid__mongoid_push_atomic_context'>_mongoid_push_atomic_context</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='ivar'>@atomic_depth</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='ivar'>@atomic_depth</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>
    <span class='id identifier rubyid_persist_atomic_operations'>persist_atomic_operations</span> <span class='ivar'>@atomic_context</span>
    <span class='id identifier rubyid__mongoid_remove_atomic_context_changes'>_mongoid_remove_atomic_context_changes</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid__mongoid_reset_atomic_context_changes!'>_mongoid_reset_atomic_context_changes!</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid__mongoid_pop_atomic_context'>_mongoid_pop_atomic_context</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_own_context'>has_own_context</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_call_depth'>call_depth</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='ivar'>@atomic_depth</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@atomic_updates_to_execute_stack</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail_due_to_callback!-instance_method">
  
    #<strong>fail_due_to_callback!</strong>(method)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Raise an error if a callback failed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Raise the callback error.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_fail_due_to_callback!'>fail_due_to_callback!</span><span class='lparen'>(</span><span class='id identifier rubyid_person'>person</span><span class='comma'>,</span> <span class='symbol'>:create!</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>method</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The method being called.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Errors/Callback.html" title="Mongoid::Errors::Callback (class)">Errors::Callback</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The callback error.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongoid/persistable.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_due_to_callback!'>fail_due_to_callback!</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Errors/Callback.html" title="Mongoid::Errors::Callback (class)">Callback</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Errors/Callback.html#initialize-instance_method" title="Mongoid::Errors::Callback#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fail_due_to_validation!-instance_method">
  
    #<strong>fail_due_to_validation!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Raise an error if validation failed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Raise the validation error.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_fail_due_to_validation!'>fail_due_to_validation!</span><span class='lparen'>(</span><span class='id identifier rubyid_person'>person</span><span class='rparen'>)</span></code></pre>
    
  </div>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Errors/Validations.html" title="Mongoid::Errors::Validations (class)">Errors::Validations</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The validation error.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>4.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongoid/persistable.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fail_due_to_validation!'>fail_due_to_validation!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Errors.html" title="Mongoid::Errors (module)">Errors</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Errors/Validations.html" title="Mongoid::Errors::Validations (class)">Validations</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Errors/Validations.html#initialize-instance_method" title="Mongoid::Errors::Validations#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Apr 27 18:31:31 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>