<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css' />
    <title>Field Definition</title><link rel="shortcut icon" href="https://media.mongodb.org/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index" />

  <meta name="release" content="upcoming"/>
  <meta name="version" content="master"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs-mongoid/blob/master/source/reference/fields.txt"/>
  <meta property="og:image" content="http://s3.amazonaws.com/info-mongodb-com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
  <meta property="og:image:secure_url" content="https://webassets.mongodb.com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
    <link rel="canonical" href="https://docs.mongodb.com/mongoid/current/reference/fields/" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="../_static/css/navbar.min.css?t=nocache" type="text/css" />
    
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/lib/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="https://docs.mongodb.com/osd.xml" title="MongoDB Help"/>
<link rel="search" title="Search" href="../search.html" />
<link rel="top" title="Mongoid Manual" href="../index.html" />
<link rel="up" title="Reference" href="../reference.html" />
<link rel="next" title="Inheritance" href="inheritance.html" />
<link rel="prev" title="Documents" href="documents.html" /></head>
<body data-project="mongoid" data-project-title="Mongoid Manual" data-branch="master" data-enable-marian=1 data-eol="">
  <!-- Google Tag Manager -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-GDFN"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
  {'gtm.start':new Date().getTime(),event:'gtm.js'}
  );var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-GDFN');
  </script>
  <!-- End Google Tag Manager -->
   <script>
     window.googleSearchCx = "014132741538533607290:xl0kbqanc9y"
     window.googleSearchPlaceholder = "Search Mongoid"
     window.googleSearchResultsUrl = "http://docs.mongodb.com/mongoid/master/search/"
   </script><div class="content" >

   <div id="left-column">
         <aside id="sidebar" class="sidebar">
             
  <div class="sphinxsidebar" id="sphinxsidebar">
    <div id="sphinxsidebarwrapper" class="sphinxsidebarwrapper"><a href="javascript:void(0)" class="closeNav" id="closeNav">Close &times;</a>


<h3>
  <a href="../index.html">Mongoid Manual</a>
</h3>


    <div class="btn-group version-sidebar">
      
        <button type="button" class="version-button dropdown-toggle" data-toggle="dropdown">
          
          
          master (upcoming)<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          
            
            <li class="active">
            
              <a href="#" data-path="mongoid/current">
                
                master (upcoming)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.3">
                
                Version 7.3 (current)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.2">
                
                Version 7.2
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.1">
                
                Version 7.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.0">
                
                Version 7.0
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.4">
                
                Version 6.4
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.3">
                
                Version 6.3
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.2">
                
                Version 6.2
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.1">
                
                Version 6.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/5.4">
                
                Version 5.4
              </a>
            </li>
          
        </ul>
      
    </div>


<ul class="current"><li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li><li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul><li class="toctree-l2"><a class="reference internal" href="../tutorials/getting-started-sinatra.html">Getting Started (Sinatra)</a></li><li class="toctree-l2"><a class="reference internal" href="../tutorials/getting-started-rails.html">Getting Started (Rails)</a></li></ul></li><li class="toctree-l1 current"><a class="reference internal" href="../reference.html">Reference</a><ul class="current"><li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li><li class="toctree-l2"><a class="reference internal" href="persistence-configuration.html">Persistence Configuration</a></li><li class="toctree-l2"><a class="reference internal" href="documents.html">Documents</a></li><li class="toctree-l2 current"><a class="reference internal current" href="">Field Definition</a></li><li class="toctree-l2"><a class="reference internal" href="inheritance.html">Inheritance</a></li><li class="toctree-l2"><a class="reference internal" href="crud.html">CRUD Operations</a></li><li class="toctree-l2"><a class="reference internal" href="queries.html">Queries</a></li><li class="toctree-l2"><a class="reference internal" href="text-search.html">Text Search</a></li><li class="toctree-l2"><a class="reference internal" href="map-reduce.html">Map/Reduce</a></li><li class="toctree-l2"><a class="reference internal" href="associations.html">Associations</a></li><li class="toctree-l2"><a class="reference internal" href="nested-attributes.html">Nested Attributes</a></li><li class="toctree-l2"><a class="reference internal" href="callbacks.html">Callbacks</a></li><li class="toctree-l2"><a class="reference internal" href="validation.html">Validation</a></li><li class="toctree-l2"><a class="reference internal" href="indexes.html">Indexes</a></li><li class="toctree-l2"><a class="reference internal" href="sharding.html">Sharding</a></li><li class="toctree-l2"><a class="reference internal" href="sessions.html">Sessions</a></li><li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a></li><li class="toctree-l2"><a class="reference internal" href="rails.html">Rails Integration</a></li></ul></li><li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a><ul><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-7.3.html">Mongoid 7.3</a></li><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-7.2.html">Mongoid 7.2</a></li><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-7.1.html">Mongoid 7.1</a></li><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-7.0.html">Mongoid 7.0</a></li><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-6.html">Mongoid 6</a></li><li class="toctree-l2"><a class="reference internal" href="../release-notes/mongoid-5.html">Mongoid 5</a></li></ul></li><li class="toctree-l1"><a class="reference external" href="https://docs.mongodb.com/mongoid/master/api/">API</a></li><li class="toctree-l1"><a class="reference internal" href="../additional-resources.html">Additional Resources</a></li><li class="toctree-l1"><a class="reference internal" href="../ecosystem.html">Ecosystem</a></li></ul>
    </div>
  </div>
           
         </aside>

   </div>

    <div id="main-column" class="main-column">

    <span id="showNav" class="showNav">Navigation</span>

      
      
        <div class="document">
            <div class="documentwrapper"><div class="bodywrapper">
              <div class="body" data-pagename="reference/fields">

                
  <div class="bc">
    
      <ul>
          <li><a href="../reference.html">Reference</a><span class="bcpoint"> > </span></li>
            <li>Field Definition</li> 
      </ul>
    
    
  </div>
                
                  <div class="section" id="field-definition">
<span id="fields"></span><h1>Field Definition<a class="headerlink" href="#field-definition" title="Permalink to this headline">¶</a></h1>
<div class="contents singlecol local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><a class="reference internal" href="#the-stringifiedsymbol-type" id="id3">The StringifiedSymbol Type</a></li>
<li><a class="reference internal" href="#bson-symbol-type" id="id4">BSON Symbol Type</a></li>
<li><a class="reference internal" href="#hash-fields" id="id5">Hash Fields</a></li>
<li><a class="reference internal" href="#time-fields" id="id6">Time Fields</a></li>
<li><a class="reference internal" href="#date-fields" id="id7">Date Fields</a></li>
<li><a class="reference internal" href="#datetime-fields" id="id8">DateTime Fields</a></li>
<li><a class="reference internal" href="#regular-expression-fields" id="id9">Regular Expression Fields</a></li>
<li><a class="reference internal" href="#defaults" id="id10">Defaults</a></li>
<li><a class="reference internal" href="#specifying-storage-field-names" id="id11">Specifying Storage Field Names</a></li>
<li><a class="reference internal" href="#field-aliases" id="id12">Field Aliases</a><ul>
<li><a class="reference internal" href="#unaliasing-id" id="id13">Unaliasing <code class="docutils literal notranslate"><span class="pre">id</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-fields" id="id14">Custom Fields</a></li>
<li><a class="reference internal" href="#reserved-names" id="id15">Reserved Names</a></li>
<li><a class="reference internal" href="#field-redefinition" id="id16">Field Redefinition</a></li>
<li><a class="reference internal" href="#custom-ids" id="id17">Custom Ids</a></li>
<li><a class="reference internal" href="#special-characters-in-field-names" id="id18">Special Characters in Field Names</a></li>
<li><a class="reference internal" href="#fallbacks" id="id19">Fallbacks</a></li>
<li><a class="reference internal" href="#querying" id="id20">Querying</a></li>
<li><a class="reference internal" href="#indexing" id="id21">Indexing</a></li>
</ul>
</div>
<p>Even though MongoDB is a schemaless database and allows data to be stored
as strings, Mongoid permits the application to declare the type of data
stored in the various fields of a document. Field type declarations affect
the following:</p>
<p>1. When assigning values to fields, the values are converted to the
specified type.</p>
<p>2. When persisting data to MongoDB, the data is sent in an appropriate
type, permitting richer data manipulation within MongoDB or by other
tools.</p>
<p>3. When querying documents, query parameters are converted to the specified
type before being sent to MongoDB.</p>
<p>4. When retrieving documents from the database, field values are converted
to the specified type.</p>
<p>Field type definitions determine how Mongoid behaves when constructing the
queries, retrieving and writing fields from the database. Changing the field
definitions in a model class does not alter data already stored in
MongoDB. To update type or contents of fields of existing documents,
the field must be re-saved to the database. Note that, due to Mongoid
tracking which attributes on a model change and only saving the changed ones,
it may be necessary to explicitly write a field value when changing the
type of an existing field without changing the stored values.</p>
<p>Consider a simple class for modeling a person in an application. A person may
have a first name, last name, and middle name. We can define these attributes
on a person by using the <code class="docutils literal notranslate"><span class="pre">field</span></code> macro.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:middle_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Below is a list of valid types for fields.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Array</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BigDecimal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Boolean</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DateTime</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Float</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Hash</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Integer</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BSON::ObjectId</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BSON::Binary</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Range</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Regexp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Set</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">String</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Symbol</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Time</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TimeWithZone</span></code></li>
</ul>
<p>If you decide not to specify the type of field with the definition, Mongoid will treat
it as an object and not try to typecast it when sending the values to the database.
This can be advantageous as the lack of attempted conversion will yield a slight
performance gain. However some types are not supported if not defined as fields.
You can safely omit type specifications when:</p>
<ul class="simple">
<li>You’re not using a web front end and values are already properly cast.</li>
<li>All of your fields are strings.</li>
</ul>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span>
  <span class="n">field</span> <span class="ss">:middle_name</span>
  <span class="n">field</span> <span class="ss">:last_name</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Types that are not supported as dynamic attributes since they cannot be cast are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">BigDecimal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DateTime</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Range</span></code></li>
</ul>
<div class="section" id="the-stringifiedsymbol-type">
<span id="stringified-symbol"></span><h2>The StringifiedSymbol Type<a class="headerlink" href="#the-stringifiedsymbol-type" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> field type is the recommended field type for storing
values that should be exposed as symbols to Ruby applications. When using the <code class="docutils literal notranslate"><span class="pre">Symbol</span></code> field type,
Mongoid defaults to storing values as BSON symbols. For more information on the
BSON symbol type, see <a class="reference internal" href="#bson-symbol"><span class="std std-ref">here</span></a>.
However, the BSON symbol type is deprecated and is difficult to work with in programming languages
without native symbol types, so the <code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> type allows the use of symbols
while ensuring interoperability with other drivers. The <code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> type stores all data
on the database as strings, while exposing values to the application as symbols.</p>
<p>An example usage is shown below:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Post</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">StringifiedSymbol</span>
<span class="k">end</span>

<span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">status</span><span class="p">:</span> <span class="ss">:hello</span><span class="p">)</span>
<span class="c1"># status is stored as &quot;hello&quot; on the database, but returned as a Symbol</span>
<span class="n">post</span><span class="o">.</span><span class="n">status</span>
<span class="c1"># =&gt; :hello</span>

<span class="c1"># String values can be assigned also:</span>
<span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">status</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="c1"># status is stored as &quot;hello&quot; on the database, but returned as a Symbol</span>
<span class="n">post</span><span class="o">.</span><span class="n">status</span>
<span class="c1"># =&gt; :hello</span>
</pre></div>
</div>
</div>
<p>All non-string values will be stringified upon being sent to the database (via <code class="docutils literal notranslate"><span class="pre">to_s</span></code>), and
all values will be converted to symbols when returned to the application. Values that cannot be
converted directly to symbols, such as integers and arrays, will first be converted to strings and
then symbols before being returned to the application.</p>
<p>For example, setting an integer as <code class="docutils literal notranslate"><span class="pre">status</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">status</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">status</span>
<span class="c1"># =&gt; :&quot;42&quot;</span>
</pre></div>
</div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> type is applied to a field that contains BSON symbols, the values
will be stored as strings instead of BSON symbols on the next save. This permits transparent lazy
migration from fields that currently store either strings or BSON symbols in the database to the
<code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> field type.</p>
</div>
<div class="section" id="bson-symbol-type">
<span id="bson-symbol"></span><h2>BSON Symbol Type<a class="headerlink" href="#bson-symbol-type" title="Permalink to this headline">¶</a></h2>
<p>New applications should use the <a class="reference internal" href="#stringified-symbol"><span class="std std-ref">StringifiedSymbol field type</span></a>
to store Ruby symbols in the database. The <code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> field type
provides maximum compatibility with other applications and programming languages
and has the same behavior in all circumstances.</p>
<p>Mongoid also provides the deprecated <code class="docutils literal notranslate"><span class="pre">Symbol</span></code> field type for serializing
Ruby symbols to BSON symbols. Because the BSON specification deprecated the
BSON symbol type, the <cite>bson</cite> gem will serialize Ruby symbols into BSON strings
when used on its own. However, in order to maintain backwards compatibility
with older datasets, the <cite>mongo</cite> gem overrides this behavior to serialize Ruby
symbols as BSON symbols. This is necessary to be able to specify queries for
documents which contain BSON symbols as fields.</p>
<p>To override the default behavior and configure the <code class="docutils literal notranslate"><span class="pre">mongo</span></code> gem (and thereby
Mongoid as well) to encode symbol values as strings, include the following code
snippet in your project:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Symbol</span>
  <span class="k">def</span> <span class="nf">bson_type</span>
    <span class="no">BSON</span><span class="o">::</span><span class="nb">String</span><span class="o">::</span><span class="no">BSON_TYPE</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hash-fields">
<h2>Hash Fields<a class="headerlink" href="#hash-fields" title="Permalink to this headline">¶</a></h2>
<p>When using a field of type Hash, be wary of adhering to the
<a class="reference external" href="http://docs.mongodb.org/manual/reference/limits/#naming-restrictions">legal key names for mongoDB</a>,
or else the values will not store properly.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span>
  <span class="n">field</span> <span class="ss">:url</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Hash</span>

  <span class="c1"># will update the fields properly and save the values</span>
  <span class="k">def</span> <span class="nf">set_vals</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Daniel&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;home_page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://www.homepage.com&#39;</span><span class="p">}</span>
    <span class="n">save</span>
  <span class="k">end</span>

  <span class="c1"># all data will fail to save due to the illegal hashkey</span>
  <span class="k">def</span> <span class="nf">set_vals_fail</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Daniel&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;home.page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://www.homepage.com&#39;</span><span class="p">}</span>
    <span class="n">save</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="time-fields">
<h2>Time Fields<a class="headerlink" href="#time-fields" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Time</span></code> fields store values as <code class="docutils literal notranslate"><span class="pre">Time</span></code> instances in the <a class="reference internal" href="configuration.html#time-zones"><span class="std std-ref">configured
time zone</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Date</span></code> and <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> instances are converted to <code class="docutils literal notranslate"><span class="pre">Time</span></code> instances upon
assignment to a <code class="docutils literal notranslate"><span class="pre">Time</span></code> field:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Voter</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:registered_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span>
<span class="k">end</span>

<span class="no">Voter</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">registered_at</span><span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Voter _id: 5fdd80392c97a618f07ba344, registered_at: 2020-12-18 05:00:00 UTC&gt;</span>
</pre></div>
</div>
</div>
<p>In the above example, the value was interpreted as the beginning of today in
local time, because the application was not configured to use UTC times.</p>
</div>
<div class="section" id="date-fields">
<h2>Date Fields<a class="headerlink" href="#date-fields" title="Permalink to this headline">¶</a></h2>
<p>Mongoid allows assignment of values of several types to <code class="docutils literal notranslate"><span class="pre">Date</span></code> fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code> - the provided date is stored as is.</li>
<li><code class="docutils literal notranslate"><span class="pre">Time</span></code>, <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>, <code class="docutils literal notranslate"><span class="pre">ActiveSupport::TimeWithZone</span></code> - the date component
of the value is taken in the value’s time zone.</li>
<li><code class="docutils literal notranslate"><span class="pre">String</span></code> - the date specified in the string is used.</li>
<li><code class="docutils literal notranslate"><span class="pre">Integer</span></code>, <code class="docutils literal notranslate"><span class="pre">Float</span></code> - the value is taken to be a UTC timestamp which is
converted to the <a class="reference internal" href="configuration.html#time-zones"><span class="std std-ref">configured time zone</span></a> (note that
<code class="docutils literal notranslate"><span class="pre">Mongoid.use_utc</span></code> has no effect on this conversion), then the date is
taken from the resulting time.</li>
</ul>
<p>In other words, if a date is specified in the value, that date is used without
first converting the value to the configured time zone.</p>
<p>As a date &amp; time to date conversion is lossy (it discards the time component),
especially if an application operates with times in different time zones it is
recommended to explicitly convert <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">Time</span></code> and <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>
objects to <code class="docutils literal notranslate"><span class="pre">Date</span></code> objects before assigning the values to fields of type
<code class="docutils literal notranslate"><span class="pre">Date</span></code>.</p>
</div>
<div class="section" id="datetime-fields">
<h2>DateTime Fields<a class="headerlink" href="#datetime-fields" title="Permalink to this headline">¶</a></h2>
<p>MongoDB stores all times as UTC timestamps. When assigning a value to a
<code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field, or when querying a <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field, Mongoid
converts the passed in value to a UTC <code class="docutils literal notranslate"><span class="pre">Time</span></code> before sending it to the
MongoDB server.</p>
<p><code class="docutils literal notranslate"><span class="pre">Time</span></code>, <code class="docutils literal notranslate"><span class="pre">ActiveSupport::TimeWithZone</span></code> and <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> objects embed
time zone information, and the value persisted is the specified moment in
time, in UTC. When the value is retrieved, the time zone in which it is
returned is defined by the <a class="reference internal" href="configuration.html#time-zones"><span class="std std-ref">configured time zone settings</span></a>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ticket</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:opened_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">DateTime</span>
<span class="k">end</span>

<span class="no">Mongoid</span><span class="o">.</span><span class="n">use_activesupport_time_zone</span> <span class="o">=</span> <span class="kp">true</span>
<span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;Berlin&#39;</span>

<span class="n">ticket</span> <span class="o">=</span> <span class="no">Ticket</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">opened_at</span><span class="p">:</span> <span class="s1">&#39;2018-02-18 07:00:08 -0500&#39;</span><span class="p">)</span>

 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 13:00:08 +0100</span>
 <span class="n">ticket</span>
 <span class="c1"># =&gt; #&lt;Ticket _id: 5c13d4b9026d7c4e7870bb2f, opened_at: 2018-02-18 12:00:08 UTC&gt;</span>

 <span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;America/New_York&#39;</span>
 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 07:00:08 -0500</span>

 <span class="no">Mongoid</span><span class="o">.</span><span class="n">use_utc</span> <span class="o">=</span> <span class="kp">true</span>
 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 12:00:08 +0000</span>
</pre></div>
</div>
</div>
<p>Mongoid also supports casting integers and floats to <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>. When
doing so, the integers/floats are assumed to be Unix timestamps (in UTC):</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="mi">1544803974</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Fri, 14 Dec 2018 16:12:54 +0000</span>
</pre></div>
</div>
</div>
<p>If a string is used as a <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field value, the behavior depends on
whether the string includes a time zone. If no time zone is specified,
the <a class="reference internal" href="configuration.html#time-zones"><span class="std std-ref">default Mongoid time zone</span></a> is used:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;America/New_York&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="s1">&#39;Mar 4, 2018 10:00:00&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Sun, 04 Mar 2018 15:00:00 +0000</span>
</pre></div>
</div>
</div>
<p>If a time zone is specfied, it is respected:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="s1">&#39;Mar 4, 2018 10:00:00 +01:00&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Sun, 04 Mar 2018 09:00:00 +0000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="regular-expression-fields">
<span id="id1"></span><h2>Regular Expression Fields<a class="headerlink" href="#regular-expression-fields" title="Permalink to this headline">¶</a></h2>
<p>MongoDB supports storing regular expressions in documents, and querying using
regular expressions. Of note for Ruby applications, MongoDB uses
<a class="reference external" href="http://pcre.org/">Perl-compatible regular expressions (PCRE)</a>
and Ruby uses <a class="reference external" href="https://github.com/k-takata/Onigmo">Onigmo</a>, which is a
fork of <a class="reference external" href="https://github.com/kkos/oniguruma">Oniguruma regular expression engine</a>.
The two regular expression implementations generally provide equivalent
functionality but have several important syntax differences.</p>
<p>When a field is declared to be of type Regexp, Mongoid converts Ruby regular
expressions to BSON regular expressions and stores the result in MongoDB.
Retrieving the field from the database produces a <code class="docutils literal notranslate"><span class="pre">BSON::Regexp::Raw</span></code>
instance:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Token</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:pattern</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Regexp</span>
<span class="k">end</span>

<span class="n">token</span> <span class="o">=</span> <span class="no">Token</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">pattern</span><span class="p">:</span> <span class="sr">/hello.world/m</span><span class="p">)</span>
<span class="n">token</span><span class="o">.</span><span class="n">pattern</span>
<span class="c1"># =&gt; /hello.world/m</span>

<span class="n">token</span><span class="o">.</span><span class="n">reload</span>
<span class="n">token</span><span class="o">.</span><span class="n">pattern</span>
<span class="c1"># =&gt; #&lt;BSON::Regexp::Raw:0x0000555f505e4a20 @pattern=&quot;hello.world&quot;, @options=&quot;ms&quot;&gt;</span>
</pre></div>
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">#compile</span></code> method on <code class="docutils literal notranslate"><span class="pre">BSON::Regexp::Raw</span></code> to get back the Ruby regular
expression:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">token</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">compile</span>
<span class="c1"># =&gt; /hello.world/m</span>
</pre></div>
</div>
</div>
<p>Note that, if the regular expression was not originally a Ruby one, calling
<code class="docutils literal notranslate"><span class="pre">#compile</span></code> on it may produce a different regular expression. For example,
the following is a PCRE matching a string that ends in “hello”:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">BSON</span><span class="o">::</span><span class="no">Regexp</span><span class="o">::</span><span class="no">Raw</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello$&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;BSON::Regexp::Raw:0x0000555f51441640 @pattern=&quot;hello$&quot;, @options=&quot;s&quot;&gt;</span>
</pre></div>
</div>
</div>
<p>Compiling this regular expression produces a Ruby regular expression that
matches strings containing “hello” before a newline, besides strings ending in
“hello”:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">BSON</span><span class="o">::</span><span class="no">Regexp</span><span class="o">::</span><span class="no">Raw</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello$&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span> <span class="o">=~</span> <span class="s2">&quot;hello</span><span class="se">\n</span><span class="s2">world&quot;</span>
<span class="c1"># =&gt; 0</span>
</pre></div>
</div>
</div>
<p>This is because the meaning of <code class="docutils literal notranslate"><span class="pre">$</span></code> is different between PCRE and Ruby
regular expressions.</p>
</div>
<div class="section" id="defaults">
<h2>Defaults<a class="headerlink" href="#defaults" title="Permalink to this headline">¶</a></h2>
<p>A field can be configured to have a default value. The default value can be
fixed, as in the following example:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Order</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The default value can also be specified as a <code class="docutils literal notranslate"><span class="pre">Proc</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Order</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:fulfill_by</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="mi">3</span><span class="o">.</span><span class="n">days</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Default values that are not <code class="docutils literal notranslate"><span class="pre">Proc</span></code> instances are evaluated at class load
time, meaning the following two definitions are not equivalent:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="ss">:submitted_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
<span class="n">field</span> <span class="ss">:submitted_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<p class="last">The second definition is most likely the desired one, which causes the
time of submission to be set to the current time at the moment of
document instantiation.</p>
</div>
<p>To set a default which depends on the document’s state, use <code class="docutils literal notranslate"><span class="pre">self</span></code>
inside the <code class="docutils literal notranslate"><span class="pre">Proc</span></code> instance which would evaluate to the document instance
being operated on:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="ss">:fulfill_by</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span>
  <span class="c1"># Order should be fulfilled in 2 business hours.</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">7</span><span class="o">..</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">submitted_at</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">submitted_at</span> <span class="o">+</span> <span class="mi">4</span><span class="o">.</span><span class="n">hours</span>
  <span class="k">elsif</span> <span class="p">(</span><span class="mi">9</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">submitted_at</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">submitted_at</span> <span class="o">+</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span>
  <span class="k">else</span>
    <span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">submitted_at</span> <span class="o">+</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="ss">hour</span><span class="p">:</span> <span class="mi">11</span><span class="p">)</span>
  <span class="k">end</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>When defining a default value as a <code class="docutils literal notranslate"><span class="pre">Proc</span></code>, Mongoid will apply the default
after all other attributes are set. To have the default be applied before
the other attributes are set, use the <code class="docutils literal notranslate"><span class="pre">pre_processed:</span> <span class="pre">true</span></code> field option:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="ss">:fulfill_by</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="mi">3</span><span class="o">.</span><span class="n">days</span> <span class="p">},</span>
  <span class="ss">pre_processed</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="specifying-storage-field-names">
<span id="storage-field-names"></span><h2>Specifying Storage Field Names<a class="headerlink" href="#specifying-storage-field-names" title="Permalink to this headline">¶</a></h2>
<p>One of the drawbacks of having a schemaless database is that MongoDB must
store all field information along with every document, meaning that it
takes up a lot of storage space in RAM and on disk. A common pattern to limit
this is to alias fields to a small number of characters, while keeping the
domain in the application expressive. Mongoid allows you to do this and
reference the fields in the domain via their long names in getters, setters,
and criteria while performing the conversion for you.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:n</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">attributes</span> <span class="c1"># { &quot;n&quot; =&gt; &quot;Placebo&quot; }</span>

<span class="n">criteria</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">criteria</span><span class="o">.</span><span class="n">selector</span> <span class="c1"># { &quot;n&quot; =&gt; &quot;Placebo&quot; }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="field-aliases">
<span id="id2"></span><h2>Field Aliases<a class="headerlink" href="#field-aliases" title="Permalink to this headline">¶</a></h2>
<p>It is possible to define field aliases. The value will be stored in the
destination field but can be accessed from either the destination field or
from the aliased field:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">alias_attribute</span> <span class="ss">:n</span><span class="p">,</span> <span class="ss">:name</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">n</span><span class="p">:</span> <span class="s1">&#39;Astral Projection&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Band _id: 5fc1c1ee2c97a64accbeb5e1, name: &quot;Astral Projection&quot;&gt;</span>

<span class="n">band</span><span class="o">.</span><span class="n">attributes</span>
<span class="c1"># =&gt; {&quot;_id&quot;=&gt;BSON::ObjectId(&#39;5fc1c1ee2c97a64accbeb5e1&#39;), &quot;name&quot;=&gt;&quot;Astral Projection&quot;}</span>

<span class="n">band</span><span class="o">.</span><span class="n">n</span>
<span class="c1"># =&gt; &quot;Astral Projection&quot;</span>
</pre></div>
</div>
</div>
<p>Aliases can be removed from model classes using the <code class="docutils literal notranslate"><span class="pre">unalias_attribute</span></code>
method.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="n">unalias_attribute</span> <span class="ss">:n</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="unaliasing-id">
<span id="unalias-id"></span><h3>Unaliasing <code class="docutils literal notranslate"><span class="pre">id</span></code><a class="headerlink" href="#unaliasing-id" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">unalias_attribute</span></code> can be used to remove the predefined <code class="docutils literal notranslate"><span class="pre">id</span></code> alias.
This is useful for storing different values in <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">_id</span></code> fields:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">unalias_attribute</span> <span class="ss">:id</span>
  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="no">Band</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;42&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Band _id: 5fc1c3f42c97a6590684046c, id: &quot;42&quot;&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="custom-fields">
<h2>Custom Fields<a class="headerlink" href="#custom-fields" title="Permalink to this headline">¶</a></h2>
<p>You can define custom types in Mongoid and determine how they are serialized and deserialized.
You simply need to provide three methods on it for Mongoid to call to convert your object to
and from MongoDB friendly values.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Profile</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:location</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Point</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Point</span>

  <span class="kp">attr_reader</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>

  <span class="c1"># Converts an object of this instance into a database friendly value.</span>
  <span class="k">def</span> <span class="nf">mongoize</span>
    <span class="o">[</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">]</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>

    <span class="c1"># Get the object as it was stored in the database, and instantiate</span>
    <span class="c1"># this custom class from it.</span>
    <span class="k">def</span> <span class="nf">demongoize</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">object</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Takes any possible object and converts it to how it would be</span>
    <span class="c1"># stored in the database.</span>
    <span class="k">def</span> <span class="nf">mongoize</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="k">case</span> <span class="n">object</span>
      <span class="k">when</span> <span class="no">Point</span> <span class="k">then</span> <span class="n">object</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">when</span> <span class="no">Hash</span> <span class="k">then</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">object</span><span class="o">[</span><span class="ss">:x</span><span class="o">]</span><span class="p">,</span> <span class="n">object</span><span class="o">[</span><span class="ss">:y</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">else</span> <span class="n">object</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Converts the object that was supplied to a criteria and converts it</span>
    <span class="c1"># into a database friendly form.</span>
    <span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="k">case</span> <span class="n">object</span>
      <span class="k">when</span> <span class="no">Point</span> <span class="k">then</span> <span class="n">object</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">else</span> <span class="n">object</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The instance method <code class="docutils literal notranslate"><span class="pre">mongoize</span></code> takes an instance of your object, and converts it
into how it will be stored in the database. In our example above, we want to store our
point object as an array in the form <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">x,</span> <span class="pre">y</span> <span class="pre">]</span></code>.</p>
<p>The class method <code class="docutils literal notranslate"><span class="pre">demongoize</span></code> takes an object as how it was stored in the database,
and is responsible for instantiating an object of your custom type. In this case, we
take an array and instantiate a <code class="docutils literal notranslate"><span class="pre">Point</span></code> from it.</p>
<p>The class method <code class="docutils literal notranslate"><span class="pre">mongoize</span></code> takes an object that you would use to set on your model
from your application code, and create the object as it would be stored in the database.
This is for cases where you are not passing your model instances of your custom type in the setter:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">venue</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span> <span class="c1"># This uses the mongoize instance method.</span>
<span class="n">venue</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="o">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span> <span class="o">]</span><span class="p">)</span> <span class="c1"># This uses the mongoize class method.</span>
</pre></div>
</div>
</div>
<p>The class method <code class="docutils literal notranslate"><span class="pre">evolve</span></code> takes an object, and determines how it is to be transformed
for use in criteria. For example we may want to write a query like so:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="no">Venue</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that when accessing custom fields from the document, you will get a new instance
of that object with each call to the getter. This is because Mongoid is generating a new
object from the raw attributes on each access.</p>
<p>We need the point object in the criteria to be transformed to a Mongo friendly value when
it is not as well, <code class="docutils literal notranslate"><span class="pre">evolve</span></code> is the method that takes care of this. We check if the passed
in object is a <code class="docutils literal notranslate"><span class="pre">Point</span></code> first, in case we also want to be able to pass in ordinary arrays instead.</p>
</div>
<div class="section" id="reserved-names">
<h2>Reserved Names<a class="headerlink" href="#reserved-names" title="Permalink to this headline">¶</a></h2>
<p>Attempting to define a field on a document that conflicts with a reserved
method name in Mongoid will raise an error. The list of reserved names can
be obtained by invoking the <code class="docutils literal notranslate"><span class="pre">Mongoid.destructive_fields</span></code> method.</p>
</div>
<div class="section" id="field-redefinition">
<h2>Field Redefinition<a class="headerlink" href="#field-redefinition" title="Permalink to this headline">¶</a></h2>
<p>By default Mongoid allows redefining fields on a model. To raise an error
when a field is redefined, set the <code class="docutils literal notranslate"><span class="pre">duplicate_fields_exception</span></code>
<a class="reference internal" href="configuration.html#configuration-options"><span class="std std-ref">configuration option</span></a> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>With the option set to true, the following example will raise an error:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:name</span>

  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>To define the field anyway, use the <code class="docutils literal notranslate"><span class="pre">overwrite:</span> <span class="pre">true</span></code> option:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:name</span>

  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">overwrite</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-ids">
<span id="custom-id"></span><h2>Custom Ids<a class="headerlink" href="#custom-ids" title="Permalink to this headline">¶</a></h2>
<p>By default, Mongoid defines the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field on documents to contain a
<code class="docutils literal notranslate"><span class="pre">BSON::ObjcetId</span></code> value which is automatically generated by Mongoid.</p>
<p>It is possible to replace the <code class="docutils literal notranslate"><span class="pre">_id</span></code> field definition to change the type
of the <code class="docutils literal notranslate"><span class="pre">_id</span></code> values or have different default values:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:_id</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="nb">name</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>It is possible to omit the default entirely:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:_id</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>If the default on <code class="docutils literal notranslate"><span class="pre">_id</span></code> is omitted, and no <code class="docutils literal notranslate"><span class="pre">_id</span></code> value is provided by
your application, Mongoid will persist the document without the <code class="docutils literal notranslate"><span class="pre">_id</span></code>
value. In this case, if the document is a top-level document, an <code class="docutils literal notranslate"><span class="pre">_id</span></code>
value will be assigned by the server; if the document is an embedded document,
no <code class="docutils literal notranslate"><span class="pre">_id</span></code> value will be assigned. Mongoid will not automatically retrieve
this value, if assigned, when the document is persisted - you
must obtain the persisted value (and the complete persisted document) using
other means:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">create!</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Band _id: , &gt;</span>
<span class="n">band</span><span class="o">.</span><span class="n">id</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="n">band</span><span class="o">.</span><span class="n">reload</span>
<span class="c1"># raises Mongoid::Errors::DocumentNotFound</span>
<span class="no">Band</span><span class="o">.</span><span class="n">last</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Band _id: 5fc681c22c97a6791f324b99, &gt;</span>
</pre></div>
</div>
</div>
<p>Omitting <code class="docutils literal notranslate"><span class="pre">_id</span></code> fields is more common in <a class="reference internal" href="associations.html#omit-id"><span class="std std-ref">embedded documents</span></a>.</p>
<p>Mongoid also defines the <code class="docutils literal notranslate"><span class="pre">id</span></code> field aliased to <code class="docutils literal notranslate"><span class="pre">_id</span></code>. The <code class="docutils literal notranslate"><span class="pre">id</span></code>
alias can <a class="reference internal" href="#unalias-id"><span class="std std-ref">be removed</span></a> if desired (such as to integrate
with systems that use the <code class="docutils literal notranslate"><span class="pre">id</span></code> field to store value different from <code class="docutils literal notranslate"><span class="pre">_id</span></code>.</p>
<p>By default, Mongoid requires all fields that may be set on a document to
be explicitly defined using <code class="docutils literal notranslate"><span class="pre">field</span></code> declarations. Mongoid also supports
creating fields on the fly from an arbitrary hash or documents stored in
the database. When a model uses fields not explicitly defined, such fields
are called <em>dynamic fields</em>.</p>
<p>To enable dynamic fields, include <code class="docutils literal notranslate"><span class="pre">Mongoid::Attributes::Dynamic</span></code> module
in the model:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Attributes</span><span class="o">::</span><span class="no">Dynamic</span>
<span class="k">end</span>

<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; &quot;Bob&quot;</span>
</pre></div>
</div>
</div>
<p>It is possible to use <code class="docutils literal notranslate"><span class="pre">field</span></code> declarations and dynamic fields in the same
model class. Attributes for which there is a <code class="docutils literal notranslate"><span class="pre">field</span></code> declaration will be
treated according to the <code class="docutils literal notranslate"><span class="pre">field</span></code> declaration, with remaining attributes
being treated as dynamic fields.</p>
<p>Attribute values in the dynamic fields must initially be set by either
passing the attribute hash to the constructor, mass assignment via
<code class="docutils literal notranslate"><span class="pre">attributes=</span></code>, mass assignment via <code class="docutils literal notranslate"><span class="pre">[]=</span></code>, using <code class="docutils literal notranslate"><span class="pre">write_attribute</span></code>,
or they must already be present in the database.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># Raises NoMethodError: undefined method age=</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># OK, initializes attributes from whatever is in the database</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If an attribute is not present in a particular model instance’s attributes
hash, both the reader and the writer for the corresponding field are not
defined, and invoking them raises <code class="docutils literal notranslate"><span class="pre">NoMethodError</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>

<span class="n">bob</span><span class="o">.</span><span class="n">age</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># raises NoMethodError</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span>

<span class="c1"># raises NoMethodError</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>

<span class="n">bob</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; &quot;Bob&quot;</span>
</pre></div>
</div>
</div>
<p>Attributes can always be read using mass attribute access or <code class="docutils literal notranslate"><span class="pre">read_attribute</span></code>
(this appies to models not using dynamic fields as well):</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:age</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># Returns nil - keys are always strings</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="ss">:age</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span>
<span class="c1"># =&gt; 42</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="special-characters-in-field-names">
<h2>Special Characters in Field Names<a class="headerlink" href="#special-characters-in-field-names" title="Permalink to this headline">¶</a></h2>
<p>Mongoid permits dynamic field names to include spaces and punctuation:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MDB&#39;</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; &quot;MDB&quot;</span>

<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="s2">&quot;hello%world&quot;</span><span class="p">,</span> <span class="s1">&#39;MDB&#39;</span><span class="p">)</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:&quot;hello%world&quot;</span><span class="o">]</span>
<span class="c1"># =&gt; &quot;MDB&quot;</span>
</pre></div>
</div>
</div>
<p>Mongoid supports localized fields via <a class="reference external" href="https://github.com/ruby-i18n/i18n">i18n</a>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">localize</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>By telling the field to <code class="docutils literal notranslate"><span class="pre">localize</span></code>, Mongoid will under the covers store the field
as a hash of locale/value pairs, but normal access to it will behave like a string.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">I18n</span><span class="o">.</span><span class="n">default_locale</span> <span class="o">=</span> <span class="ss">:en</span>
<span class="n">product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Marvelous!&quot;</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:de</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Fantastisch!&quot;</span>

<span class="n">product</span><span class="o">.</span><span class="n">attributes</span>
<span class="c1"># { &quot;description&quot; =&gt; { &quot;en&quot; =&gt; &quot;Marvelous!&quot;, &quot;de&quot; =&gt; &quot;Fantastisch!&quot; }</span>
</pre></div>
</div>
</div>
<p>You can get and set all the translations at once by using the corresponding <code class="docutils literal notranslate"><span class="pre">_translations</span></code> method.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">description_translations</span>
<span class="c1"># { &quot;en&quot; =&gt; &quot;Marvelous!&quot;, &quot;de&quot; =&gt; &quot;Fantastisch!&quot; }</span>
<span class="n">product</span><span class="o">.</span><span class="n">description_translations</span> <span class="o">=</span>
  <span class="p">{</span> <span class="s2">&quot;en&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Marvelous!&quot;</span><span class="p">,</span> <span class="s2">&quot;de&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Wunderbar!&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fallbacks">
<h2>Fallbacks<a class="headerlink" href="#fallbacks" title="Permalink to this headline">¶</a></h2>
<p>Mongoid integrates with
<a class="reference external" href="https://github.com/ruby-i18n/i18n/wiki/Fallbacks">i18n fallbacks</a>.
To use the fallbacks, the respective functionality must be explicitly enabled.</p>
<p>In a Rails application, set the <code class="docutils literal notranslate"><span class="pre">config.i18n.fallbacks</span></code> configuration setting
to <code class="docutils literal notranslate"><span class="pre">true</span></code> in your environment and specify the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">fallbacks</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="o">.</span><span class="n">after_initialize</span> <span class="k">do</span>
  <span class="no">I18n</span><span class="o">.</span><span class="n">fallbacks</span><span class="o">[</span><span class="ss">:de</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="ss">:en</span><span class="p">,</span> <span class="ss">:es</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>In a non-Rails application, include the fallbacks module into the I18n backend
you are using and specify the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s2">&quot;i18n/backend/fallbacks&quot;</span>
<span class="no">I18n</span><span class="o">::</span><span class="no">Backend</span><span class="o">::</span><span class="no">Simple</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">I18n</span><span class="o">::</span><span class="no">Backend</span><span class="o">::</span><span class="no">Fallbacks</span><span class="p">)</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">fallbacks</span><span class="o">[</span><span class="ss">:de</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="ss">:en</span><span class="p">,</span> <span class="ss">:es</span> <span class="o">]</span>
</pre></div>
</div>
</div>
<p>When fallbacks are enabled, if a translation is not present in the active
language, translations will be looked up in the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:en</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Marvelous!&quot;</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:de</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="c1"># &quot;Marvelous!&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In i18n 1.1, the behavior of fallbacks <a class="reference external" href="https://github.com/ruby-i18n/i18n/pull/415">changed</a>
to always require an explicit list of fallback locales rather than falling
back to the default locale when no fallback locales have been provided.</p>
</div>
</div>
<div class="section" id="querying">
<h2>Querying<a class="headerlink" href="#querying" title="Permalink to this headline">¶</a></h2>
<p>When querying for localized fields using Mongoid’s criteria API, Mongoid will automatically
alter the criteria to match the current locale.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Match all products with Marvelous as the description. Locale is en.</span>
<span class="no">Product</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">description</span><span class="p">:</span> <span class="s2">&quot;Marvelous!&quot;</span><span class="p">)</span>
<span class="c1"># The resulting MongoDB query filter: { &quot;description.en&quot; : &quot;Marvelous!&quot; }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexing">
<h2>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h2>
<p>If you plan to be querying extensively on localized fields, you should index each of the
locales that you plan on searching on.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">localize</span><span class="p">:</span> <span class="kp">true</span>

  <span class="n">index</span> <span class="s2">&quot;description.de&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
  <span class="n">index</span> <span class="s2">&quot;description.en&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>You can tell Mongoid that certain attributes are read-only. This will allow
documents to be created with these attributes, but changes to them will be
ignored when using mass update methods such as <code class="docutils literal notranslate"><span class="pre">update_attributes</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:origin</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>

  <span class="n">attr_readonly</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:origin</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Tool&quot;</span><span class="p">)</span> <span class="c1"># Filters out the name change.</span>
</pre></div>
</div>
</div>
<p>If you explicitly try to update or remove a read-only attribute by itself,
a <code class="docutils literal notranslate"><span class="pre">ReadonlyAttribute</span></code> exception will be raised:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">band</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;Tool&quot;</span><span class="p">)</span> <span class="c1"># Raises the error.</span>
<span class="n">band</span><span class="o">.</span><span class="n">remove_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># Raises the error.</span>
</pre></div>
</div>
</div>
<p>Mongoid supplies a timestamping module in <code class="docutils literal notranslate"><span class="pre">Mongoid::Timestamps</span></code> which
can be included to get basic behavior for <code class="docutils literal notranslate"><span class="pre">created_at</span></code> and
<code class="docutils literal notranslate"><span class="pre">updated_at</span></code> fields.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>You may also choose to only have specific timestamps for creation or
modification.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Created</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Post</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Updated</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>If you want to turn off timestamping for specific calls, use the timeless
method:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">person</span><span class="o">.</span><span class="n">timeless</span><span class="o">.</span><span class="n">save</span>
<span class="no">Person</span><span class="o">.</span><span class="n">timeless</span><span class="o">.</span><span class="n">create!</span>
</pre></div>
</div>
</div>
<p>If you’d like shorter timestamp fields with aliases on them to save space,
you can include the short versions of the modules.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For c_at and u_at.</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Created</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For c_at only.</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Updated</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For u_at only.</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>

                
    <div id="btnv">
      <span class="btn-arrow-left">&larr; &nbsp;</span>
      <a class="btn-prev-text" href="documents.html" title="Previous Section: Documents"><span>Documents</span></a>
      <a class="btn-next-text" href="inheritance.html" title="Next Section: Inheritance"><span>Inheritance</span></a>
      <span class="btn-arrow-right">&nbsp;&rarr;</span>
    </div>
                  <div class="footer">
                    <div class="copyright">
                      <p>&copy; MongoDB, Inc 2008-present. MongoDB, Mongo, and the leaf logo are registered trademarks of MongoDB, Inc.</p>
                    </div>
                  </div>
              </div></div>
            </div>
        </div>
    </div>
    <div class="right-column">
      <div class="wrapper"> 
            <div class="social">
               <a class="slack-icon" href="https://slackpass.io/mongo-db?jmp=docs" title="https://slackpass.io/mongo-db?jmp=docs"><i class="fab fa-slack" aria-hidden="true"></i></a>
               <a class="twitter-icon" href="https://twitter.com/MongoDB" title="https://twitter.com/MongoDB"><i class="fab fa-twitter-square"></i></a>
               <a class="youtube-icon" href="https://www.youtube.com/user/MongoDB" title="https://www.youtube.com/user/MongoDB"><i class="fab fa-youtube-square"></i></a>
               <a class="facebook-icon" href="https://www.facebook.com/mongodb" title="https://www.facebook.com/mongodb"><i class="fab fa-facebook-square"></i></a>
               <a class="stack-overflow-icon" href="https://stackoverflow.com/tags/mongodb/info" title="https://stackoverflow.com/tags/mongodb/info"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a>
            </div>
        

      </div>
    </div>
    
    <div class="clearfix"></div>
  </div><div id="navbar" data-navprops='{"links": [{"url": "https://docs.mongodb.com/manual/","text": "Server"},{"url": "https://docs.mongodb.com/ecosystem/drivers/","text": "Drivers"},{"url": "https://docs.mongodb.com/cloud/","text": "Cloud"},{"url": "https://docs.mongodb.com/tools/","text": "Tools"},{"url": "https://docs.mongodb.com/guides/","text": "Guides","active": true}]}'></div>

  <script src="../_static/navbar.min.js"></script>

  

  <script type="text/javascript">
  // Bootstrap array of links that should trigger a full page reload
  window.docsExcludedNav = [];
  </script></body>
</html>