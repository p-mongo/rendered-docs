<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css' />
    <title>Callbacks</title><link rel="shortcut icon" href="https://media.mongodb.org/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index" />

  <meta name="release" content="upcoming"/>
  <meta name="version" content="master"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs-mongoid/blob/master/source/tutorials/mongoid-callbacks.txt"/>
  <meta property="og:image" content="http://s3.amazonaws.com/info-mongodb-com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
  <meta property="og:image:secure_url" content="https://webassets.mongodb.com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
    <link rel="canonical" href="https://docs.mongodb.com/mongoid/current/tutorials/mongoid-callbacks/" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="../_static/css/navbar.min.css?t=nocache" type="text/css" />
    
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/lib/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="https://docs.mongodb.com/osd.xml" title="MongoDB Help"/>
<!-- <link rel="index" title="Index" href="../genindex.html" /> -->
<link rel="search" title="Search" href="../search.html" />
<link rel="top" title="Mongoid Manual" href="../index.html" />
<link rel="next" title="Validation" href="mongoid-validation.html" />
<link rel="prev" title="Nested Attributes" href="mongoid-nested-attributes.html" /></head>
<body data-project="mongoid" data-project-title="Mongoid Manual" data-branch="master" data-enable-marian=1 data-eol="">
  <!-- Google Tag Manager -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-GDFN"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
  {'gtm.start':new Date().getTime(),event:'gtm.js'}
  );var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-GDFN');
  </script>
  <!-- End Google Tag Manager -->
   <script>
     window.googleSearchCx = "014132741538533607290:xl0kbqanc9y"
     window.googleSearchPlaceholder = "Search Mongoid"
     window.googleSearchResultsUrl = "http://docs.mongodb.com/mongoid/master/search/"
   </script><div class="content" >

   <div id="left-column">
         <aside id="sidebar" class="sidebar">
             
  <div class="sphinxsidebar" id="sphinxsidebar">
    <div id="sphinxsidebarwrapper" class="sphinxsidebarwrapper"><a href="javascript:void(0)" class="closeNav" id="closeNav">Close &times;</a>


<h3>
  <a href="../index.html">Mongoid Manual</a>
</h3>


    <div class="btn-group version-sidebar">
      
        <button type="button" class="version-button dropdown-toggle" data-toggle="dropdown">
          
          
          master (upcoming)<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          
            
            <li class="active">
            
              <a href="#" data-path="mongoid/current">
                
                master (upcoming)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.2">
                
                Version 7.2 (current)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.1">
                
                Version 7.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.0">
                
                Version 7.0
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.4">
                
                Version 6.4
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.3">
                
                Version 6.3
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.2">
                
                Version 6.2
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.1">
                
                Version 6.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/5.4">
                
                Version 5.4
              </a>
            </li>
          
        </ul>
      
    </div>


<ul class="current"><li class="toctree-l1"><a class="reference internal" href="getting-started-sinatra.html">Getting Started (Sinatra)</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-installation.html">Installation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-configuration.html">Configuration</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-documents.html">Documents</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-persistence.html">Persistence</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-queries.html">Queries</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-relations.html">Associations</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-nested-attributes.html">Nested Attributes</a></li><li class="toctree-l1 current"><a class="reference internal current" href="">Callbacks</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-validation.html">Validation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-indexes.html">Indexes</a></li><li class="toctree-l1"><a class="reference internal" href="sharding.html">Sharding</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-sessions.html">Sessions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-transactions.html">Transactions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-rails.html">Rails Integration</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-upgrade.html">Upgrading Mongoid</a></li><li class="toctree-l1"><a class="reference external" href="https://docs.mongodb.com/mongoid/master/api/">API</a></li><li class="toctree-l1"><a class="reference internal" href="../additional-resources.html">Additional Resources</a></li><li class="toctree-l1"><a class="reference internal" href="../ecosystem.html">Ecosystem</a></li></ul>
    </div>
  </div>
           
         </aside>

   </div>

    <div id="main-column" class="main-column">

    <span id="showNav" class="showNav">Navigation</span>

      
      
        <div class="document">
            <div class="documentwrapper"><div class="bodywrapper">
              <div class="body" data-pagename="tutorials/mongoid-callbacks">

                
  <div class="bc">
    
      
    
    
  </div>
                
                  <div class="section" id="callbacks">
<h1>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h1>
<div class="contents singlecol local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><a class="reference internal" href="#document-callbacks" id="id1">Document Callbacks</a></li>
<li><a class="reference internal" href="#association-callbacks" id="id2">Association Callbacks</a></li>
</ul>
</div>
<div class="section" id="document-callbacks">
<h2>Document Callbacks<a class="headerlink" href="#document-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Mongoid supports the following callbacks for <a class="reference internal" href="mongoid-documents.html"><span class="doc">documents</span></a>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">after_initialize</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_build</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_validation</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_validation</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_create</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">around_create</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_create</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_find</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_update</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">around_update</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_update</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_upsert</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">around_upsert</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_upsert</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_save</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">around_save</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_save</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_destroy</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">around_destroy</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_destroy</span></code></li>
</ul>
<p>Callbacks are available on any document, whether it is embedded within
another document or not. Note that to be efficient, Mongoid only fires
the callback of the document that the persistence action was executed on.
This is that Mongoid aims to support large hierarchies and to handle
optimized atomic updates callbacks can’t be firing all over the document
hierarchy.</p>
<p>Note that using callbacks for domain logic is a bad design practice, and can
lead to unexpected errors that are hard to debug when callbacks in
the chain halt execution. It is our recommendation to only use them
for cross-cutting concerns, like queueing up background jobs.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:slug</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>

  <span class="n">before_create</span> <span class="ss">:send_message</span>

  <span class="n">after_save</span> <span class="k">do</span> <span class="o">|</span><span class="n">document</span><span class="o">|</span>
    <span class="c1"># Handle callback here.</span>
  <span class="k">end</span>

  <span class="kp">protected</span>
  <span class="k">def</span> <span class="nf">send_message</span>
    <span class="c1"># Message sending code here.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Callbacks are coming from Active Support, so you can use the new
syntax as well:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>

  <span class="n">set_callback</span><span class="p">(</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:before</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">document</span><span class="o">|</span>
    <span class="c1"># Message sending code here.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="association-callbacks">
<h2>Association Callbacks<a class="headerlink" href="#association-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Mongoid has a set of callbacks that are specific to collection based
associations - these are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">after_add</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">after_remove</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_add</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">before_remove</span></code></li>
</ul>
<p>Each time a document is added or removed from any of the following associations,
the respective callbacks are invoked: <code class="docutils literal notranslate"><span class="pre">embeds_many</span></code>,
<code class="docutils literal notranslate"><span class="pre">has_many</span></code>, and <code class="docutils literal notranslate"><span class="pre">has_and_belongs_to_many</span></code>.</p>
<p>Association callbacks are specified as options on the respective association.
The document added/removed will be passed as the parameter to the specified
callback. Example:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">after_add</span><span class="p">:</span> <span class="ss">:send_email_to_subscribers</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">send_email_to_subscribers</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
  <span class="no">Notifications</span><span class="o">.</span><span class="n">new_post</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>

                
    <div id="btnv">
      <span class="btn-arrow-left">&larr; &nbsp;</span>
      <a class="btn-prev-text" href="mongoid-nested-attributes.html" title="Previous Section: Nested Attributes"><span>Nested Attributes</span></a>
      <a class="btn-next-text" href="mongoid-validation.html" title="Next Section: Validation"><span>Validation</span></a>
      <span class="btn-arrow-right">&nbsp;&rarr;</span>
    </div>
                  <div class="footer">
                    <div class="copyright">
                      <p>&copy; MongoDB, Inc 2008-present. MongoDB, Mongo, and the leaf logo are registered trademarks of MongoDB, Inc.</p>
                    </div>
                  </div>
              </div></div>
            </div>
        </div>
    </div>
    <div class="right-column">
      <div class="wrapper"> 
            <div class="social">
               <a class="slack-icon" href="https://slackpass.io/mongo-db?jmp=docs" title="https://slackpass.io/mongo-db?jmp=docs"><i class="fab fa-slack" aria-hidden="true"></i></a>
               <a class="twitter-icon" href="https://twitter.com/MongoDB" title="https://twitter.com/MongoDB"><i class="fab fa-twitter-square"></i></a>
               <a class="youtube-icon" href="https://www.youtube.com/user/MongoDB" title="https://www.youtube.com/user/MongoDB"><i class="fab fa-youtube-square"></i></a>
               <a class="facebook-icon" href="https://www.facebook.com/mongodb" title="https://www.facebook.com/mongodb"><i class="fab fa-facebook-square"></i></a>
               <a class="stack-overflow-icon" href="https://stackoverflow.com/tags/mongodb/info" title="https://stackoverflow.com/tags/mongodb/info"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a>
            </div>
        

      </div>
    </div>
    
    <div class="clearfix"></div>
  </div><div id="navbar" data-navprops='{"links": [{"url": "https://docs.mongodb.com/manual/","text": "Server"},{"url": "https://docs.mongodb.com/ecosystem/drivers/","text": "Drivers"},{"url": "https://docs.mongodb.com/cloud/","text": "Cloud"},{"url": "https://docs.mongodb.com/tools/","text": "Tools"},{"url": "https://docs.mongodb.com/guides/","text": "Guides","active": true}]}'></div>

  <script src="../_static/navbar.min.js"></script>

  

  <script type="text/javascript">
  // Bootstrap array of links that should trigger a full page reload
  window.docsExcludedNav = [];
  </script></body>
</html>