<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css' /><title>Documents &mdash; Mongoid Manual upcoming</title><link rel="shortcut icon" href="https://media.mongodb.org/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index" />

  <meta name="release" content="upcoming"/>
  <meta name="version" content="master"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs-mongoid/blob/master/source/tutorials/mongoid-documents.txt"/>
  <meta property="og:image" content="http://s3.amazonaws.com/info-mongodb-com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
  <meta property="og:image:secure_url" content="https://webassets.mongodb.com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
    <link rel="canonical" href="http://docs.mongodb.com/mongoid/tutorials/mongoid-documents" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="../_static/css/navbar.min.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/lib/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="https://docs.mongodb.com/osd.xml" title="MongoDB Help"/>
<!-- <link rel="index" title="Index" href="../genindex.html" /> -->
<link rel="search" title="Search" href="../search.html" />
<link rel="top" title="Mongoid Manual" href="../index.html" />
<link rel="next" title="Persistence" href="mongoid-persistence.html" />
<link rel="prev" title="Configuration" href="mongoid-configuration.html" /><script type='text/javascript'>
   var gptadslots=[];
   var googletag = googletag || {};
   googletag.cmd = googletag.cmd || [];
   (function(){ var gads = document.createElement('script');
      gads.async = true; gads.type = 'text/javascript';
      var useSSL = 'https:' == document.location.protocol;
      gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
      var node = document.getElementsByTagName('script')[0];
      node.parentNode.insertBefore(gads, node);
   })();
</script>

<script type="text/javascript">
   googletag.cmd.push(function() {

      var pathname = location.href;
      
      if ( (pathname.indexOf("auth") >= 0) || (pathname.indexOf("security") >= 0) ) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/security', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if ( (pathname.indexOf("crud") >= 0) ||  (pathname.indexOf("query") >= 0) || (pathname.indexOf("insert") >= 0) || (pathname.indexOf("update") >= 0) || (pathname.indexOf("remove") >= 0) || (pathname.indexOf("delete") >= 0) || (pathname.indexOf("aggregation") >= 0) ) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/crud', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("shard") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/sharding', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("replica") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/replication', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("model") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/data-modeling', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("administration") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/support', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("install-mongodb-on-windows") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/install-mongodb-on-windows', [160, 600], 'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("tutorial/getting-started") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/docs_server_gettingstarted', [160, 600], 'mongodb-docs-1').addService(googletag.pubads());
      } else {
         //Adslot 1 declaration
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      }
      googletag.pubads().enableSingleRequest();
      googletag.pubads().enableAsyncRendering();
      googletag.enableServices();
   });
</script></head>
<body data-project="mongoid" data-project-title="Mongoid Manual" data-branch="master" data-enable-marian=1>
  <!-- Google Tag Manager -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-JQHP"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
     {'gtm.start': new Date().getTime(),event:'gtm.js'}
   );var f=d.getElementsByTagName(s)[0],
   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
   '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
   })(window,document,'script','dataLayer','GTM-JQHP');</script>
  <!-- End Google Tag Manager -->
<div id="navbar" data-navprops='{"links": [{"url": "https://docs.mongodb.com/manual/","text": "Server"},{"url": "https://docs.mongodb.com/ecosystem/drivers/","text": "Drivers","active": true},{"url": "https://docs.mongodb.com/cloud/","text": "Cloud"},{"url": "https://docs.mongodb.com/tools/","text": "Tools"},{"url": "https://docs.mongodb.com/guides/","text": "Guides"}]}'></div>
    <script src="../_static/navbar.min.js"></script>
  

  <div class="content" >

   <div id="left-column">
         <aside id="sidebar" class="sidebar">
             
  <div class="sphinxsidebar" id="sphinxsidebar">
    <div id="sphinxsidebarwrapper" class="sphinxsidebarwrapper"><a href="javascript:void(0)" class="closeNav" id="closeNav">Close &times;</a>


<h3>
  <a class="index-link" href="../index.html">Mongoid Manual</a>
</h3>


    <div class="btn-group version-sidebar">
      <button type="button" class="version-button dropdown-toggle" data-toggle="dropdown">
        
        
        master (upcoming)<span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        
          
          <li class="active">
          
            <a href="#" data-path="mongoid/current">
              
              master (upcoming)
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/7.1">
              
              Version 7.1 (current)
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/7.0">
              
              Version 7.0
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/6.4">
              
              Version 6.4
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/6.3">
              
              Version 6.3
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/6.2">
              
              Version 6.2
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/6.1">
              
              Version 6.1
            </a>
          </li>
        
          
          <li>
          
            <a class="version-selector" href="#" data-path="mongoid/5.2">
              
              Version 5.2
            </a>
          </li>
        
      </ul>
    </div>


<ul class="current"><li class="toctree-l1"><a class="reference internal" href="getting-started-sinatra.html">Getting Started (Sinatra)</a></li><li class="toctree-l1"><a class="reference internal" href="getting-started-rails.html">Getting Started (Rails)</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-installation.html">Installation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-configuration.html">Configuration</a></li><li class="toctree-l1 current"><a class="reference internal current" href="">Documents</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-persistence.html">Persistence</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-queries.html">Queries</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-relations.html">Associations</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-nested-attributes.html">Nested Attributes</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-callbacks.html">Callbacks</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-validation.html">Validation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-indexes.html">Indexes</a></li><li class="toctree-l1"><a class="reference internal" href="sharding.html">Sharding</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-sessions.html">Sessions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-transactions.html">Transactions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-rails.html">Rails Integration</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-upgrade.html">Upgrading Mongoid</a></li><li class="toctree-l1"><a class="reference external" href="https://docs.mongodb.com/mongoid/7.0/api/">API</a></li></ul>


    </div>
  </div>
           
         </aside>

   </div>

    <div id="main-column" class="main-column">

    <span id="showNav" class="showNav">Navigation</span>

      
        <div class="document">
            <div class="documentwrapper"><div class="bodywrapper">
              <div class="body" data-pagename="tutorials/mongoid-documents">

                
  <div class="bc">
    
      
    
    
  </div>
                
                  <div class="section" id="documents">
<span id="mongoid-documents-6-0-0"></span><h1>Documents<a class="headerlink" href="#documents" title="Permalink to this headline">¶</a></h1>
<div class="contents singlecol local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><a class="reference internal" href="#storage" id="id1">Storage</a></li>
<li><a class="reference internal" href="#fields" id="id2">Fields</a><ul>
<li><a class="reference internal" href="#updating-container-fields" id="id3">Updating Container Fields</a></li>
<li><a class="reference internal" href="#accessing-field-values" id="id4">Accessing Field Values</a></li>
<li><a class="reference internal" href="#hash-fields" id="id5">Hash Fields</a></li>
<li><a class="reference internal" href="#date-fields" id="id6">Date Fields</a></li>
<li><a class="reference internal" href="#datetime-fields" id="id7">DateTime Fields</a></li>
<li><a class="reference internal" href="#regular-expression-fields" id="id8">Regular Expression Fields</a></li>
<li><a class="reference internal" href="#defaults" id="id9">Defaults</a></li>
<li><a class="reference internal" href="#aliasing-fields" id="id10">Aliasing Fields</a></li>
<li><a class="reference internal" href="#custom-fields" id="id11">Custom Fields</a></li>
<li><a class="reference internal" href="#reserved-names" id="id12">Reserved Names</a></li>
<li><a class="reference internal" href="#custom-ids" id="id13">Custom Ids</a></li>
<li><a class="reference internal" href="#a-note-about-the-bson-symbol-type" id="id14">A Note about the BSON Symbol type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-fields" id="id15">Dynamic Fields</a><ul>
<li><a class="reference internal" href="#special-characters-in-field-names" id="id16">Special Characters in Field Names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#localized-fields" id="id17">Localized Fields</a><ul>
<li><a class="reference internal" href="#fallbacks" id="id18">Fallbacks</a></li>
<li><a class="reference internal" href="#querying" id="id19">Querying</a></li>
<li><a class="reference internal" href="#indexing" id="id20">Indexing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dirty-tracking" id="id21">Dirty Tracking</a><ul>
<li><a class="reference internal" href="#viewing-changes" id="id22">Viewing Changes</a></li>
<li><a class="reference internal" href="#resetting-changes" id="id23">Resetting Changes</a></li>
<li><a class="reference internal" href="#notes-on-persistence" id="id24">Notes On Persistence</a></li>
<li><a class="reference internal" href="#viewing-previous-changes" id="id25">Viewing Previous Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#read-only-attributes" id="id26">Read-Only Attributes</a></li>
<li><a class="reference internal" href="#inheritance" id="id27">Inheritance</a><ul>
<li><a class="reference internal" href="#querying-subclasses" id="id28">Querying Subclasses</a></li>
<li><a class="reference internal" href="#associations" id="id29">Associations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#timestamping" id="id30">Timestamping</a></li>
</ul>
</div>
<p>Documents are the core objects in Mongoid and any object that is to be persisted to the
database must include <code class="docutils literal notranslate"><span class="pre">Mongoid::Document</span></code>. The representation of a Document in MongoDB
is a BSON object that is very similar to a Ruby hash or JSON object. Documents can be stored
in their own collections in the database, or can be embedded in other Documents n levels deep.</p>
<div class="section" id="storage">
<h2>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h2>
<p>Mongoid by default stores documents in a collection that is the pluralized form of the class name.
For the following <code class="docutils literal notranslate"><span class="pre">Person</span></code> class, the collection the document would get stored in would be named <code class="docutils literal notranslate"><span class="pre">people</span></code>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Model class names cannot end with “s”, because it will be considered as the pluralized form of
the word. For example “Status” would be considered as the plural form of “Statu”,
which will cause a few known problems.</p>
<p>This is a limitation of the <code class="docutils literal notranslate"><span class="pre">ActiveSupport::Inflector#classify</span></code> which Mongoid uses to convert
from filenames and collection names to class names. You can overcome this by specifying a custom
inflection rule for your model class. For example, the following code will take care of the model
named <code class="docutils literal notranslate"><span class="pre">Status</span></code>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="o">.</span><span class="n">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="o">.</span><span class="n">singular</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The collection for the model’s documents can be changed at the class level if you would like
them persisted elsewhere. You can also change the database and client the model gets persisted
in from the defaults.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">store_in</span> <span class="ss">collection</span><span class="p">:</span> <span class="s2">&quot;citizens&quot;</span><span class="p">,</span> <span class="ss">database</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="ss">client</span><span class="p">:</span> <span class="s2">&quot;secondary&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">store_in</span></code> macro can also take lambdas - a common case for this is multi-tenant applications.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">store_in</span> <span class="ss">database</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">[</span><span class="ss">:database</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>When a document is stored in the database the ruby object will get serialized into BSON
and have a structure like so:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="no">ObjectId</span><span class="p">(</span><span class="s2">&quot;4d3ed089fb60ab534684b7e9&quot;</span><span class="p">),</span>
  <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Sir&quot;</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="no">ObjectId</span><span class="p">(</span><span class="s2">&quot;4d3ed089fb60ab534684b7ff&quot;</span><span class="p">),</span>
    <span class="s2">&quot;first_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Durran&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;addresses&quot;</span> <span class="p">:</span> <span class="o">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="no">ObjectId</span><span class="p">(</span><span class="s2">&quot;4d3ed089fb60ab534684b7e0&quot;</span><span class="p">),</span>
      <span class="s2">&quot;city&quot;</span> <span class="p">:</span> <span class="s2">&quot;Berlin&quot;</span><span class="p">,</span>
      <span class="s2">&quot;country&quot;</span> <span class="p">:</span> <span class="s2">&quot;Deutschland&quot;</span>
    <span class="p">}</span>
  <span class="o">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>Even though MongoDB is a schemaless database and allows data to be stored
as strings, Mongoid permits the application to declare the type of data
stored in the various fields of a document. Field type declarations affect
the following:</p>
<p>1. When assigning values to fields, the values are converted to the
specified type.</p>
<p>2. When persisting data to MongoDB, the data is sent in an appropriate
type, permitting richer data manipulation within MongoDB or by other
tools.</p>
<p>3. When querying documents, query parameters are converted to the specified
type before being sent to MongoDB.</p>
<p>4. When retrieving documents from the database, field values are converted
to the specified type.</p>
<p>Field type definitions determine how Mongoid behaves when constructing the
queries, retrieving and writing fields from the database. Changing the field
definitions in a model class does not alter data already stored in
MongoDB. To update type or contents of fields of existing documents,
the field must be re-saved to the database. Note that, due to Mongoid
tracking which attributes on a model change and only saving the changed ones,
it may be necessary to explicitly write a field value when changing the
type of an existing field without changing the stored values.</p>
<p>Consider a simple class for modeling a person in an application. A person may
have a first name, last name, and middle name. We can define these attributes
on a person by using the <code class="docutils literal notranslate"><span class="pre">field</span></code> macro.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:middle_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Below is a list of valid types for fields.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Array</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BigDecimal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Boolean</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DateTime</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Float</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Hash</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Integer</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BSON::ObjectId</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">BSON::Binary</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Range</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Regexp</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Set</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">String</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Symbol</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Time</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TimeWithZone</span></code></li>
</ul>
<p>If you decide not to specify the type of field with the definition, Mongoid will treat
it as an object and not try to typecast it when sending the values to the database.
This can be advantageous as the lack of attempted conversion will yield a slight
performance gain. However some types are not supported if not defined as fields.
You can safely omit type specifications when:</p>
<ul class="simple">
<li>You’re not using a web front end and values are already properly cast.</li>
<li>All of your fields are strings.</li>
</ul>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span>
  <span class="n">field</span> <span class="ss">:middle_name</span>
  <span class="n">field</span> <span class="ss">:last_name</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Types that are not supported as dynamic attributes since they cannot be cast are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">BigDecimal</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DateTime</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Range</span></code></li>
</ul>
<div class="section" id="updating-container-fields">
<h3>Updating Container Fields<a class="headerlink" href="#updating-container-fields" title="Permalink to this headline">¶</a></h3>
<p>Be aware that, until
<a class="reference external" href="https://jira.mongodb.org/browse/MONGOID-2951">MONGOID-2951</a>
is resolved, all fields including container ones must be assigned to for
their values to be persisted to the database.</p>
<p>For example, adding to a set like this does not work:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:tours</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Set</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">new</span>
<span class="n">band</span><span class="o">.</span><span class="n">tours</span>
<span class="c1"># =&gt; #&lt;Set: {}&gt;</span>

<span class="n">band</span><span class="o">.</span><span class="n">tours</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;London&#39;</span>
<span class="c1"># =&gt; #&lt;Set: {&quot;London&quot;}&gt;</span>
<span class="n">band</span><span class="o">.</span><span class="n">tours</span>
<span class="c1"># =&gt; #&lt;Set: {}&gt;</span>
</pre></div>
</div>
</div>
<p>Instead, the field value must be modified outside of the model and assigned
back to the model as follows:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:tours</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Set</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">new</span>

<span class="n">tours</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">tours</span>
<span class="c1"># =&gt; #&lt;Set: {}&gt;</span>

<span class="n">tours</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;London&#39;</span>
<span class="c1"># =&gt; #&lt;Set: {&quot;London&quot;}&gt;</span>

<span class="n">band</span><span class="o">.</span><span class="n">tours</span> <span class="o">=</span> <span class="n">tours</span>
<span class="c1"># =&gt; #&lt;Set: {&quot;London&quot;}&gt;</span>

<span class="n">band</span><span class="o">.</span><span class="n">tours</span>
<span class="c1"># =&gt; #&lt;Set: {&quot;London&quot;}&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="accessing-field-values">
<h3>Accessing Field Values<a class="headerlink" href="#accessing-field-values" title="Permalink to this headline">¶</a></h3>
<p>When a field is defined, Mongoid provides several different ways of accessing the field.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the value of the first_name field</span>
<span class="n">person</span><span class="o">.</span><span class="n">first_name</span>
<span class="n">person</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span>
<span class="n">person</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">)</span>


<span class="c1"># Set the value for the first_name field</span>
<span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s2">&quot;Jean&quot;</span>
<span class="n">person</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Jean&quot;</span>
<span class="n">person</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">,</span> <span class="s2">&quot;Jean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can define getters/setters that will be called when using the dot notation.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:first_name</span>

  <span class="c1"># custom getter</span>
  <span class="k">def</span> <span class="nf">first_name</span>
    <span class="s2">&quot;My name is Johnny&quot;</span>
  <span class="k">end</span>

  <span class="c1"># custom setter</span>
  <span class="k">def</span> <span class="nf">first_name</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">p</span> <span class="s1">&#39;Setting.. &#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">p</span> <span class="s1">&#39;.. done!&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Like this:</span>
<span class="n">person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span>
<span class="c1"># Setting..</span>
<span class="c1"># .. done!</span>

<span class="n">person</span><span class="o">.</span><span class="n">first_name</span>                  <span class="c1"># My name is Johnny</span>
<span class="n">person</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span>                <span class="c1"># John</span>
<span class="n">person</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">)</span> <span class="c1"># John</span>
</pre></div>
</div>
</div>
<p>In cases where you want to set multiple field values at once, there are a few different ways
of handling this as well.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the field values as a hash.</span>
<span class="n">person</span><span class="o">.</span><span class="n">attributes</span>

<span class="c1"># Set the field values in the document.</span>
<span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">first_name</span><span class="p">:</span> <span class="s2">&quot;Jean-Baptiste&quot;</span><span class="p">,</span> <span class="ss">middle_name</span><span class="p">:</span> <span class="s2">&quot;Emmanuel&quot;</span><span class="p">)</span>
<span class="n">person</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">first_name</span><span class="p">:</span> <span class="s2">&quot;Jean-Baptiste&quot;</span><span class="p">,</span> <span class="ss">middle_name</span><span class="p">:</span> <span class="s2">&quot;Emmanuel&quot;</span> <span class="p">}</span>
<span class="n">person</span><span class="o">.</span><span class="n">write_attributes</span><span class="p">(</span>
  <span class="ss">first_name</span><span class="p">:</span> <span class="s2">&quot;Jean-Baptiste&quot;</span><span class="p">,</span>
  <span class="ss">middle_name</span><span class="p">:</span> <span class="s2">&quot;Emmanuel&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hash-fields">
<h3>Hash Fields<a class="headerlink" href="#hash-fields" title="Permalink to this headline">¶</a></h3>
<p>When using a field of type Hash, be wary of adhering to the
<a class="reference external" href="http://docs.mongodb.org/manual/reference/limits/#naming-restrictions">legal key names for mongoDB</a>,
or else the values will not store properly.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:first_name</span>
  <span class="n">field</span> <span class="ss">:url</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Hash</span>

  <span class="c1"># will update the fields properly and save the values</span>
  <span class="k">def</span> <span class="nf">set_vals</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Daniel&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;home_page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://www.homepage.com&#39;</span><span class="p">}</span>
    <span class="n">save</span>
  <span class="k">end</span>

  <span class="c1"># all data will fail to save due to the illegal hashkey</span>
  <span class="k">def</span> <span class="nf">set_vals_fail</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;Daniel&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;home.page&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://www.homepage.com&#39;</span><span class="p">}</span>
    <span class="n">save</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="date-fields">
<h3>Date Fields<a class="headerlink" href="#date-fields" title="Permalink to this headline">¶</a></h3>
<p>Mongoid allows assignment of values of several types to <code class="docutils literal notranslate"><span class="pre">Date</span></code> fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Date</span></code> - the provided date is stored as is.</li>
<li><code class="docutils literal notranslate"><span class="pre">Time</span></code>, <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>, <code class="docutils literal notranslate"><span class="pre">ActiveSupport::TimeWithZone</span></code> - the date component
of the value is taken in the value’s time zone.</li>
<li><code class="docutils literal notranslate"><span class="pre">String</span></code> - the date specified in the string is used.</li>
<li><code class="docutils literal notranslate"><span class="pre">Integer</span></code>, ‘’Float`` - the value is taken to be a UTC timestamp which is
converted to the <a class="reference internal" href="mongoid-configuration.html#time-zones"><span class="std std-ref">configured time zone</span></a> (note that
<code class="docutils literal notranslate"><span class="pre">Mongoid.use_utc</span></code> has no effect on this conversion), then the date is
taken from the resulting time.</li>
</ul>
<p>In other words, if a date is specified in the value, that date is used without
first converting the value to the configured time zone.</p>
<p>As a date &amp; time to date conversion is lossy (it discards the time component),
especially if an application operates with times in different time zones it is
recommended to explicitly convert <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">Time</span></code> and <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>
objects to <code class="docutils literal notranslate"><span class="pre">Date</span></code> objects before assigning the values to fields of type
<code class="docutils literal notranslate"><span class="pre">Date</span></code>.</p>
</div>
<div class="section" id="datetime-fields">
<h3>DateTime Fields<a class="headerlink" href="#datetime-fields" title="Permalink to this headline">¶</a></h3>
<p>MongoDB stores all times as UTC timestamps. When assigning a value to a
<code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field, or when querying a <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field, Mongoid
converts the passed in value to a UTC <code class="docutils literal notranslate"><span class="pre">Time</span></code> before sending it to the
MongoDB server.</p>
<p><code class="docutils literal notranslate"><span class="pre">Time</span></code>, <code class="docutils literal notranslate"><span class="pre">ActiveSupport::TimeWithZone</span></code> and <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> objects embed
time zone information, and the value persisted is the specified moment in
time, in UTC. When the value is retrieved, the time zone in which it is
returned is defined by the <a class="reference internal" href="mongoid-configuration.html#time-zones"><span class="std std-ref">configured time zone settings</span></a>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ticket</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:opened_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">DateTime</span>
<span class="k">end</span>

<span class="no">Mongoid</span><span class="o">.</span><span class="n">use_activesupport_time_zone</span> <span class="o">=</span> <span class="kp">true</span>
<span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;Berlin&#39;</span>

<span class="n">ticket</span> <span class="o">=</span> <span class="no">Ticket</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">opened_at</span><span class="p">:</span> <span class="s1">&#39;2018-02-18 07:00:08 -0500&#39;</span><span class="p">)</span>

 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 13:00:08 +0100</span>
 <span class="n">ticket</span>
 <span class="c1"># =&gt; #&lt;Ticket _id: 5c13d4b9026d7c4e7870bb2f, opened_at: 2018-02-18 12:00:08 UTC&gt;</span>

 <span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;America/New_York&#39;</span>
 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 07:00:08 -0500</span>

 <span class="no">Mongoid</span><span class="o">.</span><span class="n">use_utc</span> <span class="o">=</span> <span class="kp">true</span>
 <span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
 <span class="c1"># =&gt; Sun, 18 Feb 2018 12:00:08 +0000</span>
</pre></div>
</div>
</div>
<p>Mongoid also supports casting integers and floats to <code class="docutils literal notranslate"><span class="pre">DateTime</span></code>. When
doing so, the integers/floats are assumed to be Unix timestamps (in UTC):</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="mi">1544803974</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Fri, 14 Dec 2018 16:12:54 +0000</span>
</pre></div>
</div>
</div>
<p>If a string is used as a <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> field value, the behavior depends on
whether the string includes a time zone. If no time zone is specified,
the <a class="reference internal" href="mongoid-configuration.html#time-zones"><span class="std std-ref">default Mongoid time zone</span></a> is used:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Time</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="s1">&#39;America/New_York&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="s1">&#39;Mar 4, 2018 10:00:00&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Sun, 04 Mar 2018 15:00:00 +0000</span>
</pre></div>
</div>
</div>
<p>If a time zone is specfied, it is respected:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span> <span class="o">=</span> <span class="s1">&#39;Mar 4, 2018 10:00:00 +01:00&#39;</span>
<span class="n">ticket</span><span class="o">.</span><span class="n">opened_at</span>
<span class="c1"># =&gt; Sun, 04 Mar 2018 09:00:00 +0000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="regular-expression-fields">
<h3>Regular Expression Fields<a class="headerlink" href="#regular-expression-fields" title="Permalink to this headline">¶</a></h3>
<p>MongoDB supports storing regular expressions in documents, and querying using
regular expressions. Of note for Ruby applications, MongoDB uses
<a class="reference external" href="http://pcre.org/">Perl-compatible regular expressions (PCRE)</a>
and Ruby uses <a class="reference external" href="https://github.com/k-takata/Onigmo">Onigmo</a>, which is a
fork of <a class="reference external" href="https://github.com/kkos/oniguruma">Oniguruma regular expression engine</a>.
The two regular expression implementations generally provide equivalent
functionality but have some important syntax differences.</p>
<p>When a field is declared to be of type Regexp, Mongoid converts Ruby regular
expressions to BSON regular expressions and stores the result in MongoDB.
Retrieving the field from the database produces a <code class="docutils literal notranslate"><span class="pre">BSON::Regexp::Raw</span></code>
instance:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Token</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:pattern</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Regexp</span>
<span class="k">end</span>

<span class="n">token</span> <span class="o">=</span> <span class="no">Token</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">pattern</span><span class="p">:</span> <span class="sr">/hello.world/m</span><span class="p">)</span>
<span class="n">token</span><span class="o">.</span><span class="n">pattern</span>
<span class="c1"># =&gt; /hello.world/m</span>

<span class="n">token</span><span class="o">.</span><span class="n">reload</span>
<span class="n">token</span><span class="o">.</span><span class="n">pattern</span>
<span class="c1"># =&gt; #&lt;BSON::Regexp::Raw:0x0000555f505e4a20 @pattern=&quot;hello.world&quot;, @options=&quot;ms&quot;&gt;</span>
</pre></div>
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">#compile</span></code> method on <code class="docutils literal notranslate"><span class="pre">BSON::Regexp::Raw</span></code> to get back the Ruby regular
expression:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">token</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">compile</span>
<span class="c1"># =&gt; /hello.world/m</span>
</pre></div>
</div>
</div>
<p>Note that, if the regular expression was not originally a Ruby one, calling
<code class="docutils literal notranslate"><span class="pre">#compile</span></code> on it may produce a different regular expression. For example,
the following is a PCRE matching a string that ends in “hello”:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">BSON</span><span class="o">::</span><span class="no">Regexp</span><span class="o">::</span><span class="no">Raw</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello$&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;BSON::Regexp::Raw:0x0000555f51441640 @pattern=&quot;hello$&quot;, @options=&quot;s&quot;&gt;</span>
</pre></div>
</div>
</div>
<p>Compiling this regular expression produces a Ruby regular expression that
matches strings containing “hello” before a newline, besides strings ending in
“hello”:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">BSON</span><span class="o">::</span><span class="no">Regexp</span><span class="o">::</span><span class="no">Raw</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello$&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span> <span class="o">=~</span> <span class="s2">&quot;hello</span><span class="se">\n</span><span class="s2">world&quot;</span>
<span class="c1"># =&gt; 0</span>
</pre></div>
</div>
</div>
<p>This is because the meaning of <code class="docutils literal notranslate"><span class="pre">$</span></code> is different between PCRE and Ruby
regular expressions.</p>
</div>
<div class="section" id="defaults">
<h3>Defaults<a class="headerlink" href="#defaults" title="Permalink to this headline">¶</a></h3>
<p>You can tell a field in Mongoid to always have a default value if nothing has been provided.
Defaults are either static values or lambdas/procs.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:blood_alcohol_level</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Float</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">40</span>
  <span class="n">field</span> <span class="ss">:last_drink</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="mi">10</span><span class="o">.</span><span class="n">minutes</span><span class="o">.</span><span class="n">ago</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Be wary that default values that are not defined as lambdas or procs are evaluated
at class load time, so the following 2 definitions are not equivalent.
(One would probably prefer the second, which is evaluated at document creation time.)</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="ss">:dob</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
<span class="n">field</span> <span class="ss">:dob</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<p>If you want to set a default with a dependency on the document’s state, self inside a lambda
or proc evaluates to the document instance.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">field</span> <span class="ss">:intoxicated_at</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Time</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">new_record?</span> <span class="p">?</span> <span class="mi">2</span><span class="o">.</span><span class="n">hours</span><span class="o">.</span><span class="n">ago</span> <span class="p">:</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<p>When defining a default value as a proc, Mongoid will apply the default after all other
attributes are set. If you want this to happen before the other attributes, set <code class="docutils literal notranslate"><span class="pre">pre_processed:</span> <span class="pre">true</span></code>.</p>
</div>
<div class="section" id="aliasing-fields">
<h3>Aliasing Fields<a class="headerlink" href="#aliasing-fields" title="Permalink to this headline">¶</a></h3>
<p>One of the drawbacks of having a schemaless database is that MongoDB must store all field
information along with every document, meaning that it takes up a lot of storage space in RAM
and on disk. A common pattern to limit this is to alias fields to a small number of characters,
while keeping the domain in the application expressive. Mongoid allows you to do this and
reference the fields in the domain via their long names in getters, setters, and criteria while
performing the conversion for you.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:n</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">attributes</span> <span class="c1"># { &quot;n&quot; =&gt; &quot;Placebo&quot; }</span>

<span class="n">criteria</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">criteria</span><span class="o">.</span><span class="n">selector</span> <span class="c1"># { &quot;n&quot; =&gt; &quot;Placebo&quot; }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-fields">
<h3>Custom Fields<a class="headerlink" href="#custom-fields" title="Permalink to this headline">¶</a></h3>
<p>You can define custom types in Mongoid and determine how they are serialized and deserialized.
You simply need to provide three methods on it for Mongoid to call to convert your object to
and from MongoDB friendly values.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Profile</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:location</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Point</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Point</span>

  <span class="kp">attr_reader</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>

  <span class="c1"># Converts an object of this instance into a database friendly value.</span>
  <span class="k">def</span> <span class="nf">mongoize</span>
    <span class="o">[</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">]</span>
  <span class="k">end</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>

    <span class="c1"># Get the object as it was stored in the database, and instantiate</span>
    <span class="c1"># this custom class from it.</span>
    <span class="k">def</span> <span class="nf">demongoize</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">object</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="c1"># Takes any possible object and converts it to how it would be</span>
    <span class="c1"># stored in the database.</span>
    <span class="k">def</span> <span class="nf">mongoize</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="k">case</span> <span class="n">object</span>
      <span class="k">when</span> <span class="no">Point</span> <span class="k">then</span> <span class="n">object</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">when</span> <span class="no">Hash</span> <span class="k">then</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">object</span><span class="o">[</span><span class="ss">:x</span><span class="o">]</span><span class="p">,</span> <span class="n">object</span><span class="o">[</span><span class="ss">:y</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">else</span> <span class="n">object</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># Converts the object that was supplied to a criteria and converts it</span>
    <span class="c1"># into a database friendly form.</span>
    <span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
      <span class="k">case</span> <span class="n">object</span>
      <span class="k">when</span> <span class="no">Point</span> <span class="k">then</span> <span class="n">object</span><span class="o">.</span><span class="n">mongoize</span>
      <span class="k">else</span> <span class="n">object</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>The instance method <code class="docutils literal notranslate"><span class="pre">mongoize</span></code> takes an instance of your object, and converts it
into how it will be stored in the database. In our example above, we want to store our
point object as an array in the form <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">x,</span> <span class="pre">y</span> <span class="pre">]</span></code>.</p>
<p>The class method <code class="docutils literal notranslate"><span class="pre">demongoize</span></code> takes an object as how it was stored in the database,
and is responsible for instantiating an object of your custom type. In this case, we
take an array and instantiate a <code class="docutils literal notranslate"><span class="pre">Point</span></code> from it.</p>
<p>The class method <code class="docutils literal notranslate"><span class="pre">mongoize</span></code> takes an object that you would use to set on your model
from your application code, and create the object as it would be stored in the database.
This is for cases where you are not passing your model instances of your custom type in the setter:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">venue</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span> <span class="c1"># This uses the mongoize instance method.</span>
<span class="n">venue</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="o">[</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span> <span class="o">]</span><span class="p">)</span> <span class="c1"># This uses the mongoize class method.</span>
</pre></div>
</div>
</div>
<p>The class method <code class="docutils literal notranslate"><span class="pre">evolve</span></code> takes an object, and determines how it is to be transformed
for use in criteria. For example we may want to write a query like so:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">point</span> <span class="o">=</span> <span class="no">Point</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="no">Venue</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">location</span><span class="p">:</span> <span class="n">point</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that when accessing custom fields from the document, you will get a new instance
of that object with each call to the getter. This is because Mongoid is generating a new
object from the raw attributes on each access.</p>
<p>We need the point object in the criteria to be transformed to a Mongo friendly value when
it is not as well, <code class="docutils literal notranslate"><span class="pre">evolve</span></code> is the method that takes care of this. We check if the passed
in object is a <code class="docutils literal notranslate"><span class="pre">Point</span></code> first, in case we also want to be able to pass in ordinary arrays instead.</p>
</div>
<div class="section" id="reserved-names">
<h3>Reserved Names<a class="headerlink" href="#reserved-names" title="Permalink to this headline">¶</a></h3>
<p>If you define a field on your document that conflicts with a reserved method name in Mongoid,
the configuration will raise an error. For a list of these you may look at
<code class="docutils literal notranslate"><span class="pre">Mongoid.destructive_fields</span></code>.</p>
</div>
<div class="section" id="custom-ids">
<h3>Custom Ids<a class="headerlink" href="#custom-ids" title="Permalink to this headline">¶</a></h3>
<p>For cases when you do not want to have <code class="docutils literal notranslate"><span class="pre">BSON::ObjectId</span></code> ids, you can override Mongoid’s
<code class="docutils literal notranslate"><span class="pre">_id</span></code> field and set them to whatever you like.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:_id</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="nb">name</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-note-about-the-bson-symbol-type">
<h3>A Note about the BSON Symbol type<a class="headerlink" href="#a-note-about-the-bson-symbol-type" title="Permalink to this headline">¶</a></h3>
<p>Because the BSON specification deprecated the BSON symbol type, the <cite>bson</cite> gem will serialize Ruby
symbols into BSON strings when used on its own. However, in order to maintain backwards
compatibility with older datasets, the <cite>mongo</cite> gem overrides this behavior to serialize Ruby symbols as
BSON symbols. This is necessary to be able to specify queries for documents which contain BSON
symbols as fields.</p>
<p>Although Mongoid allows applications to define fields with the Symbol type, this could present
problems when using other MongoDB tools that have removed support for the type. Because of this,
new applications should not specify model fields with the Symbol type but instead use the String
type. Existing applications with Symbol model fields may convert those fields to Strings using one
of the following methods:</p>
<ul class="simple">
<li>Eager migration: Eager migration: write a script or rake task that queries each document and
updates any symbols it finds to strings. This will take a long time for larger data sets, and
unless the application can handle two different schemas existing in the data at once, it will
need to be taken offline while the script runs.</li>
<li>Lazy migration: rather than updating all of the documents at once, each document received from a
query  should be reinserted if it contains a symbol; since the BSON received will have already
turned the symbols into strings, this will update the document as necessary. This can be done
by simply calling the <code class="docutils literal notranslate"><span class="pre">save</span></code> method. Note that this method will only convert documents that
are accessed by the application, eventually eager migration may be needed to convert the
remaining documents that haven’t been accessed.</li>
</ul>
</div>
</div>
<div class="section" id="dynamic-fields">
<h2>Dynamic Fields<a class="headerlink" href="#dynamic-fields" title="Permalink to this headline">¶</a></h2>
<p>By default, Mongoid requires all fields that may be set on a document to
be explicitly defined using <code class="docutils literal notranslate"><span class="pre">field</span></code> declarations. Mongoid also supports
creating fields on the fly from an arbitrary hash or documents stored in
the database. When a model uses fields not explicitly defined, such fields
are called <em>dynamic fields</em>.</p>
<p>To enable dynamic fields, include <code class="docutils literal notranslate"><span class="pre">Mongoid::Attributes::Dynamic</span></code> module
in the model:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Attributes</span><span class="o">::</span><span class="no">Dynamic</span>
<span class="k">end</span>

<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; &quot;Bob&quot;</span>
</pre></div>
</div>
</div>
<p>It is possible to use <code class="docutils literal notranslate"><span class="pre">field</span></code> declarations and dynamic fields in the same
model class. Attributes for which there is a <code class="docutils literal notranslate"><span class="pre">field</span></code> declaration will be
treated according to the <code class="docutils literal notranslate"><span class="pre">field</span></code> declaration, with remaining attributes
being treated as dynamic fields.</p>
<p>Attribute values in the dynamic fields must initially be set by either
passing the attribute hash to the constructor, mass assignment via
<code class="docutils literal notranslate"><span class="pre">attributes=</span></code>, mass assignment via <code class="docutils literal notranslate"><span class="pre">[]=</span></code>, using <code class="docutils literal notranslate"><span class="pre">write_attribute</span></code>,
or they must already be present in the database.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># Raises NoMethodError: undefined method age=</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># OK</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">)</span>

<span class="c1"># OK, initializes attributes from whatever is in the database</span>
<span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If an attribute is not present in a particular model instance’s attributes
hash, both the reader and the writer for the corresponding field are not
defined, and invoking them raises <code class="docutils literal notranslate"><span class="pre">NoMethodError</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>

<span class="n">bob</span><span class="o">.</span><span class="n">age</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># raises NoMethodError</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span>

<span class="c1"># raises NoMethodError</span>
<span class="n">bob</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span>

<span class="n">bob</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; &quot;Bob&quot;</span>
</pre></div>
</div>
</div>
<p>Attributes can always be read using mass attribute access or <code class="docutils literal notranslate"><span class="pre">read_attribute</span></code>
(this appies to models not using dynamic fields as well):</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">age</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:age</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;name&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="s1">&#39;age&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># Returns nil - keys are always strings</span>
<span class="n">bob</span><span class="o">.</span><span class="n">attributes</span><span class="o">[</span><span class="ss">:age</span><span class="o">]</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
<span class="c1"># =&gt; nil</span>

<span class="c1"># OK - string access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; 42</span>

<span class="c1"># OK - symbol access</span>
<span class="n">bob</span><span class="o">.</span><span class="n">read_attribute</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span>
<span class="c1"># =&gt; 42</span>
</pre></div>
</div>
</div>
<div class="section" id="special-characters-in-field-names">
<h3>Special Characters in Field Names<a class="headerlink" href="#special-characters-in-field-names" title="Permalink to this headline">¶</a></h3>
<p>Mongoid permits dynamic field names to include spaces and punctuation:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">bob</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MDB&#39;</span><span class="p">)</span>
<span class="n">bob</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; &quot;MDB&quot;</span>

<span class="n">bob</span><span class="o">.</span><span class="n">write_attribute</span><span class="p">(</span><span class="s2">&quot;hello%world&quot;</span><span class="p">,</span> <span class="s1">&#39;MDB&#39;</span><span class="p">)</span>
<span class="n">bob</span><span class="o">[</span><span class="ss">:&quot;hello%world&quot;</span><span class="o">]</span>
<span class="c1"># =&gt; &quot;MDB&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="localized-fields">
<h2>Localized Fields<a class="headerlink" href="#localized-fields" title="Permalink to this headline">¶</a></h2>
<p>Mongoid supports localized fields via <a class="reference external" href="https://github.com/ruby-i18n/i18n">i18n</a>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">localize</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>By telling the field to <code class="docutils literal notranslate"><span class="pre">localize</span></code>, Mongoid will under the covers store the field
as a hash of locale/value pairs, but normal access to it will behave like a string.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">I18n</span><span class="o">.</span><span class="n">default_locale</span> <span class="o">=</span> <span class="ss">:en</span>
<span class="n">product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Marvelous!&quot;</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:de</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Fantastisch!&quot;</span>

<span class="n">product</span><span class="o">.</span><span class="n">attributes</span>
<span class="c1"># { &quot;description&quot; =&gt; { &quot;en&quot; =&gt; &quot;Marvelous!&quot;, &quot;de&quot; =&gt; &quot;Fantastisch!&quot; }</span>
</pre></div>
</div>
</div>
<p>You can get and set all the translations at once by using the corresponding <code class="docutils literal notranslate"><span class="pre">_translations</span></code> method.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">description_translations</span>
<span class="c1"># { &quot;en&quot; =&gt; &quot;Marvelous!&quot;, &quot;de&quot; =&gt; &quot;Fantastisch!&quot; }</span>
<span class="n">product</span><span class="o">.</span><span class="n">description_translations</span> <span class="o">=</span>
  <span class="p">{</span> <span class="s2">&quot;en&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Marvelous!&quot;</span><span class="p">,</span> <span class="s2">&quot;de&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Wunderbar!&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fallbacks">
<h3>Fallbacks<a class="headerlink" href="#fallbacks" title="Permalink to this headline">¶</a></h3>
<p>Mongoid integrates with
<a class="reference external" href="https://github.com/ruby-i18n/i18n/wiki/Fallbacks">i18n fallbacks</a>.
To use the fallbacks, the respective functionality must be explicitly enabled.</p>
<p>In a Rails application, set the <code class="docutils literal notranslate"><span class="pre">config.i18n.fallbacks</span></code> configuration setting
to <code class="docutils literal notranslate"><span class="pre">true</span></code> in your environment and specify the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">fallbacks</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">config</span><span class="o">.</span><span class="n">after_initialize</span> <span class="k">do</span>
  <span class="no">I18n</span><span class="o">.</span><span class="n">fallbacks</span><span class="o">[</span><span class="ss">:de</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="ss">:en</span><span class="p">,</span> <span class="ss">:es</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>In a non-Rails application, include the fallbacks module into the I18n backend
you are using and specify the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s2">&quot;i18n/backend/fallbacks&quot;</span>
<span class="no">I18n</span><span class="o">::</span><span class="no">Backend</span><span class="o">::</span><span class="no">Simple</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:include</span><span class="p">,</span> <span class="no">I18n</span><span class="o">::</span><span class="no">Backend</span><span class="o">::</span><span class="no">Fallbacks</span><span class="p">)</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">fallbacks</span><span class="o">[</span><span class="ss">:de</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="ss">:en</span><span class="p">,</span> <span class="ss">:es</span> <span class="o">]</span>
</pre></div>
</div>
</div>
<p>When fallbacks are enabled, if a translation is not present in the active
language, translations will be looked up in the fallback languages:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:en</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Marvelous!&quot;</span>
<span class="no">I18n</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="ss">:de</span>
<span class="n">product</span><span class="o">.</span><span class="n">description</span> <span class="c1"># &quot;Marvelous!&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In i18n 1.1, the behavior of fallbacks <a class="reference external" href="https://github.com/ruby-i18n/i18n/pull/415">changed</a>
to always require an explicit list of fallback locales rather than falling
back to the default locale when no fallback locales have been provided.</p>
</div>
</div>
<div class="section" id="querying">
<h3>Querying<a class="headerlink" href="#querying" title="Permalink to this headline">¶</a></h3>
<p>When querying for localized fields using Mongoid’s criteria API, Mongoid will automatically
alter the criteria to match the current locale.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Match all products with Marvelous as the description. Locale is en.</span>
<span class="no">Product</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">description</span><span class="p">:</span> <span class="s2">&quot;Marvelous!&quot;</span><span class="p">)</span>
<span class="c1"># The resulting MongoDB query filter: { &quot;description.en&quot; : &quot;Marvelous!&quot; }</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="indexing">
<h3>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h3>
<p>If you plan to be querying extensively on localized fields, you should index each of the
locales that you plan on searching on.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">localize</span><span class="p">:</span> <span class="kp">true</span>

  <span class="n">index</span> <span class="s2">&quot;description.de&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
  <span class="n">index</span> <span class="s2">&quot;description.en&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dirty-tracking">
<h2>Dirty Tracking<a class="headerlink" href="#dirty-tracking" title="Permalink to this headline">¶</a></h2>
<p>Mongoid supports tracking of changed or “dirty” fields with an API that mirrors that of
Active Model. If a defined field has been modified in a model the model will be marked as
dirty and some additional behavior comes into play.</p>
<div class="section" id="viewing-changes">
<h3>Viewing Changes<a class="headerlink" href="#viewing-changes" title="Permalink to this headline">¶</a></h3>
<p>There are various ways to view what has been altered on a model. Changes are recorded
from the time a document is instantiated, either as a new document or via loading from
the database up to the time it is saved. Any persistence operation clears the changes.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">first</span>
<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Alan Garner&quot;</span>

<span class="c1"># Check to see if the document has changed.</span>
<span class="n">person</span><span class="o">.</span><span class="n">changed?</span> <span class="c1"># true</span>

<span class="c1"># Get an array of the names of the changed fields.</span>
<span class="n">person</span><span class="o">.</span><span class="n">changed</span> <span class="c1"># [ :name ]</span>

<span class="c1"># Get a hash of the old and changed values for each field.</span>
<span class="n">person</span><span class="o">.</span><span class="n">changes</span> <span class="c1"># { &quot;name&quot; =&gt; [ &quot;Alan Parsons&quot;, &quot;Alan Garner&quot; ] }</span>

<span class="c1"># Check if a specific field has changed.</span>
<span class="n">person</span><span class="o">.</span><span class="n">name_changed?</span> <span class="c1"># true</span>

<span class="c1"># Get the changes for a specific field.</span>
<span class="n">person</span><span class="o">.</span><span class="n">name_change</span> <span class="c1"># [ &quot;Alan Parsons&quot;, &quot;Alan Garner&quot; ]</span>

<span class="c1"># Get the previous value for a field.</span>
<span class="n">person</span><span class="o">.</span><span class="n">name_was</span> <span class="c1"># &quot;Alan Parsons&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="resetting-changes">
<h3>Resetting Changes<a class="headerlink" href="#resetting-changes" title="Permalink to this headline">¶</a></h3>
<p>You can reset changes of a field to its previous value by calling the reset method.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">first</span>
<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Alan Garner&quot;</span>

<span class="c1"># Reset the changed name back to the original</span>
<span class="n">person</span><span class="o">.</span><span class="n">reset_name!</span>
<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="c1"># &quot;Alan Parsons&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="notes-on-persistence">
<h3>Notes On Persistence<a class="headerlink" href="#notes-on-persistence" title="Permalink to this headline">¶</a></h3>
<p>Mongoid uses dirty tracking as the core of its persistence operations. It looks at the
changes on a document and atomically updates only what has changed, unlike other frameworks
that write the entire document on each save. If no changes have been made, Mongoid will
not hit the database on a call to <code class="docutils literal notranslate"><span class="pre">Model#save</span></code>.</p>
</div>
<div class="section" id="viewing-previous-changes">
<h3>Viewing Previous Changes<a class="headerlink" href="#viewing-previous-changes" title="Permalink to this headline">¶</a></h3>
<p>After a document has been persisted, you can see what the changes were previously by
calling <code class="docutils literal notranslate"><span class="pre">Model#previous_changes</span></code>.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">first</span>
<span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Alan Garner&quot;</span>
<span class="n">person</span><span class="o">.</span><span class="n">save</span> <span class="c1"># Clears out current changes.</span>

<span class="c1"># View the previous changes.</span>
<span class="n">person</span><span class="o">.</span><span class="n">previous_changes</span> <span class="c1"># { &quot;name&quot; =&gt; [ &quot;Alan Parsons&quot;, &quot;Alan Garner&quot; ] }</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-only-attributes">
<span id="read-only"></span><h2>Read-Only Attributes<a class="headerlink" href="#read-only-attributes" title="Permalink to this headline">¶</a></h2>
<p>You can tell Mongoid that certain attributes are read-only. This will allow
documents to be created with these attributes, but changes to them will be
ignored when using mass update methods such as <code class="docutils literal notranslate"><span class="pre">update_attributes</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">field</span> <span class="ss">:origin</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>

  <span class="n">attr_readonly</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:origin</span>
<span class="k">end</span>

<span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Placebo&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Tool&quot;</span><span class="p">)</span> <span class="c1"># Filters out the name change.</span>
</pre></div>
</div>
</div>
<p>If you explicitly try to update or remove a read-only attribute by itself,
a <code class="docutils literal notranslate"><span class="pre">ReadonlyAttribute</span></code> exception will be raised:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">band</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">&quot;Tool&quot;</span><span class="p">)</span> <span class="c1"># Raises the error.</span>
<span class="n">band</span><span class="o">.</span><span class="n">remove_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># Raises the error.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="inheritance">
<h2>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h2>
<p>Mongoid supports inheritance in both top level and embedded documents. When
a child document inherits from a parent document, the parent document’s
fields, associations, validations and scopes are copied to the child document.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Canvas</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
  <span class="n">embeds_many</span> <span class="ss">:shapes</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Browser</span> <span class="o">&lt;</span> <span class="no">Canvas</span>
  <span class="n">field</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Integer</span>
  <span class="n">scope</span> <span class="ss">:recent</span><span class="p">,</span> <span class="n">where</span><span class="p">(</span><span class="ss">:version</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Firefox</span> <span class="o">&lt;</span> <span class="no">Browser</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Shape</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Integer</span>
  <span class="n">field</span> <span class="ss">:y</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Integer</span>
  <span class="n">embedded_in</span> <span class="ss">:canvas</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Circle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
  <span class="n">field</span> <span class="ss">:radius</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Float</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
  <span class="n">field</span> <span class="ss">:width</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Float</span>
  <span class="n">field</span> <span class="ss">:height</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">Float</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>In the above example, <code class="docutils literal notranslate"><span class="pre">Canvas</span></code>, <code class="docutils literal notranslate"><span class="pre">Browser</span></code> and <code class="docutils literal notranslate"><span class="pre">Firefox</span></code> will all save in the canvases
collection. An additional attribute <code class="docutils literal notranslate"><span class="pre">_type</span></code> is stored in order to make sure when loaded
from the database the correct document is returned. This also holds true for the embedded
documents <code class="docutils literal notranslate"><span class="pre">Circle</span></code>, <code class="docutils literal notranslate"><span class="pre">Rectangle</span></code>, and <code class="docutils literal notranslate"><span class="pre">Shape</span></code>.</p>
<div class="section" id="querying-subclasses">
<h3>Querying Subclasses<a class="headerlink" href="#querying-subclasses" title="Permalink to this headline">¶</a></h3>
<p>Querying for subclasses is handled in the normal manner, and although the documents are
all in the same collection, queries will only return documents of the correct type,
similar to Single Table Inheritance in ActiveRecord.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns Canvas documents and subclasses</span>
<span class="no">Canvas</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Paper&quot;</span><span class="p">)</span>
<span class="c1"># Returns only Firefox documents</span>
<span class="no">Firefox</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Window 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="associations">
<h3>Associations<a class="headerlink" href="#associations" title="Permalink to this headline">¶</a></h3>
<p>You can add any type of subclass to a has one or has many association, through either normal
setting or through the build and create methods on the association:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">firefox</span> <span class="o">=</span> <span class="no">Firefox</span><span class="o">.</span><span class="n">new</span>
<span class="c1"># Builds a Shape object</span>
<span class="n">firefox</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">build</span><span class="p">({</span> <span class="ss">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">y</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
<span class="c1"># Builds a Circle object</span>
<span class="n">firefox</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">build</span><span class="p">({</span> <span class="ss">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">y</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="no">Circle</span><span class="p">)</span>
<span class="c1"># Creates a Rectangle object</span>
<span class="n">firefox</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">create</span><span class="p">({</span> <span class="ss">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">y</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="no">Rectangle</span><span class="p">)</span>

<span class="n">rect</span> <span class="o">=</span> <span class="no">Rectangle</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="ss">height</span><span class="p">:</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">firefox</span><span class="o">.</span><span class="n">shapes</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="timestamping">
<h2>Timestamping<a class="headerlink" href="#timestamping" title="Permalink to this headline">¶</a></h2>
<p>Mongoid supplies a timestamping module in <code class="docutils literal notranslate"><span class="pre">Mongoid::Timestamps</span></code> which
can be included to get basic behavior for <code class="docutils literal notranslate"><span class="pre">created_at</span></code> and
<code class="docutils literal notranslate"><span class="pre">updated_at</span></code> fields.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>You may also choose to only have specific timestamps for creation or
modification.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Created</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Post</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Updated</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>If you want to turn off timestamping for specific calls, use the timeless
method:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">person</span><span class="o">.</span><span class="n">timeless</span><span class="o">.</span><span class="n">save</span>
<span class="no">Person</span><span class="o">.</span><span class="n">timeless</span><span class="o">.</span><span class="n">create!</span>
</pre></div>
</div>
</div>
<p>If you’d like shorter timestamp fields with aliases on them to save space,
you can include the short versions of the modules.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For c_at and u_at.</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Created</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For c_at only.</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Timestamps</span><span class="o">::</span><span class="no">Updated</span><span class="o">::</span><span class="no">Short</span> <span class="c1"># For u_at only.</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>

                
    <div id="btnv">
      <span class="btn-arrow-left">&larr; &nbsp;</span>
      <a class="btn-prev-text" href="mongoid-configuration.html" title="Previous Section: Configuration"><span>Configuration</span></a>
      <a class="btn-next-text" href="mongoid-persistence.html" title="Next Section: Persistence"><span>Persistence</span></a>
      <span class="btn-arrow-right">&nbsp;&rarr;</span>
    </div>
                  <div class="footer">
                    <div class="copyright">
                      <p>&copy; MongoDB, Inc 2008-present. MongoDB, Mongo, and the leaf logo are registered trademarks of MongoDB, Inc.</p>
                    </div>
                  </div>
              </div></div>
            </div>
        </div>
    </div>
    <div class="right-column">
      <div class="wrapper"> <div id='mongodb-docs-1'>
   <script type='text/javascript'>
      googletag.cmd.push(function() { googletag.display('mongodb-docs-1'); });
   </script>
</div>
            <div class="social">
               <a class="slack-icon" href="https://slackpass.io/mongo-db?jmp=docs" title="https://slackpass.io/mongo-db?jmp=docs"><i class="fab fa-slack" aria-hidden="true"></i></a>
               <a class="twitter-icon" href="https://twitter.com/MongoDB" title="https://twitter.com/MongoDB"><i class="fab fa-twitter-square"></i></a>
               <a class="youtube-icon" href="https://www.youtube.com/user/MongoDB" title="https://www.youtube.com/user/MongoDB"><i class="fab fa-youtube-square"></i></a>
               <a class="facebook-icon" href="https://www.facebook.com/mongodb" title="https://www.facebook.com/mongodb"><i class="fab fa-facebook-square"></i></a>
               <a class="stack-overflow-icon" href="https://stackoverflow.com/tags/mongodb/info" title="https://stackoverflow.com/tags/mongodb/info"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a>
            </div>
        

      </div>
    </div>
    
      <div id="rating-panel"></div>
    
    <div class="clearfix"></div>
  </div>
  

  <script type="text/javascript">
  // Bootstrap array of links that should trigger a full page reload
  window.docsExcludedNav = [];
  </script></body>
</html>