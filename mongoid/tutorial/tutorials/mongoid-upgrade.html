<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
  <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css' /><title>Upgrading Mongoid &mdash; Mongoid Manual upcoming</title><link rel="shortcut icon" href="https://media.mongodb.org/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index" />

  <meta name="release" content="upcoming"/>
  <meta name="version" content="master"/>
  <meta name="DC.Source" content="https://github.com/mongodb/docs-mongoid/blob/master/source/tutorials/mongoid-upgrade.txt"/>
  <meta property="og:image" content="http://s3.amazonaws.com/info-mongodb-com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
  <meta property="og:image:secure_url" content="https://webassets.mongodb.com/_com_assets/cms/mongodb-for-giant-ideas-bbab5c3cf8.png">
    <link rel="canonical" href="http://docs.mongodb.com/mongoid/tutorials/mongoid-upgrade" />
  
   <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
   <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
   <link rel="stylesheet" href="../_static/css/navbar.min.css?t=nocache" type="text/css" />
    
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/lib/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="https://docs.mongodb.com/osd.xml" title="MongoDB Help"/>
<!-- <link rel="index" title="Index" href="../genindex.html" /> -->
<link rel="search" title="Search" href="../search.html" />
<link rel="top" title="Mongoid Manual" href="../index.html" />
<link rel="next" title="Additional Resources" href="../additional-resources.html" />
<link rel="prev" title="Rails Integration" href="mongoid-rails.html" /><script type='text/javascript'>
   var gptadslots=[];
   var googletag = googletag || {};
   googletag.cmd = googletag.cmd || [];
   (function(){ var gads = document.createElement('script');
      gads.async = true; gads.type = 'text/javascript';
      var useSSL = 'https:' == document.location.protocol;
      gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
      var node = document.getElementsByTagName('script')[0];
      node.parentNode.insertBefore(gads, node);
   })();
</script>

<script type="text/javascript">
   googletag.cmd.push(function() {

      var pathname = location.href;
      
      if ( (pathname.indexOf("auth") >= 0) || (pathname.indexOf("security") >= 0) ) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/security', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if ( (pathname.indexOf("crud") >= 0) ||  (pathname.indexOf("query") >= 0) || (pathname.indexOf("insert") >= 0) || (pathname.indexOf("update") >= 0) || (pathname.indexOf("remove") >= 0) || (pathname.indexOf("delete") >= 0) || (pathname.indexOf("aggregation") >= 0) ) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/crud', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("shard") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/sharding', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("replica") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/replication', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("model") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/data-modeling', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("administration") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/support', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("install-mongodb-on-windows") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/install-mongodb-on-windows', [160, 600], 'mongodb-docs-1').addService(googletag.pubads());
      } else if (pathname.indexOf("tutorial/getting-started") >= 0) {
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org/docs_server_gettingstarted', [160, 600], 'mongodb-docs-1').addService(googletag.pubads());
      } else {
         //Adslot 1 declaration
         gptadslots[1]= googletag.defineSlot('/40039723/docs.mongodb.org', [[160,600],[243,202],[293,244]],'mongodb-docs-1').addService(googletag.pubads());
      }
      googletag.pubads().enableSingleRequest();
      googletag.pubads().enableAsyncRendering();
      googletag.enableServices();
   });
</script></head>
<body data-project="mongoid" data-project-title="Mongoid Manual" data-branch="master" data-enable-marian=1 data-eol="">
  <!-- Google Tag Manager -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-GDFN"
                    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
  {'gtm.start':new Date().getTime(),event:'gtm.js'}
  );var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-GDFN');
  </script>
  <!-- End Google Tag Manager --><div class="content" >

   <div id="left-column">
         <aside id="sidebar" class="sidebar">
             
  <div class="sphinxsidebar" id="sphinxsidebar">
    <div id="sphinxsidebarwrapper" class="sphinxsidebarwrapper"><a href="javascript:void(0)" class="closeNav" id="closeNav">Close &times;</a>


<h3>
  <a class="index-link" href="../index.html">Mongoid Manual</a>
</h3>


    <div class="btn-group version-sidebar">
      
        <button type="button" class="version-button dropdown-toggle" data-toggle="dropdown">
          
          
          master (upcoming)<span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          
            
            <li class="active">
            
              <a href="#" data-path="mongoid/current">
                
                master (upcoming)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.2">
                
                Version 7.2 (current)
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.1">
                
                Version 7.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/7.0">
                
                Version 7.0
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.4">
                
                Version 6.4
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.3">
                
                Version 6.3
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.2">
                
                Version 6.2
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/6.1">
                
                Version 6.1
              </a>
            </li>
          
            
            <li>
            
              <a class="version-selector" href="#" data-path="mongoid/5.4">
                
                Version 5.4
              </a>
            </li>
          
        </ul>
      
    </div>


<ul class="current"><li class="toctree-l1"><a class="reference internal" href="getting-started-sinatra.html">Getting Started (Sinatra)</a></li><li class="toctree-l1"><a class="reference internal" href="getting-started-rails.html">Getting Started (Rails)</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-installation.html">Installation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-configuration.html">Configuration</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-documents.html">Documents</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-persistence.html">Persistence</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-queries.html">Queries</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-relations.html">Associations</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-nested-attributes.html">Nested Attributes</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-callbacks.html">Callbacks</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-validation.html">Validation</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-indexes.html">Indexes</a></li><li class="toctree-l1"><a class="reference internal" href="sharding.html">Sharding</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-sessions.html">Sessions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-transactions.html">Transactions</a></li><li class="toctree-l1"><a class="reference internal" href="mongoid-rails.html">Rails Integration</a></li><li class="toctree-l1 current"><a class="reference internal current" href="">Upgrading Mongoid</a></li><li class="toctree-l1"><a class="reference external" href="https://docs.mongodb.com/mongoid/master/api/">API</a></li><li class="toctree-l1"><a class="reference internal" href="../additional-resources.html">Additional Resources</a></li><li class="toctree-l1"><a class="reference internal" href="../ecosystem.html">Ecosystem</a></li></ul>


    </div>
  </div>
           
         </aside>

   </div>

    <div id="main-column" class="main-column">

    <span id="showNav" class="showNav">Navigation</span>

      
      
        <div class="document">
            <div class="documentwrapper"><div class="bodywrapper">
              <div class="body" data-pagename="tutorials/mongoid-upgrade">

                
  <div class="bc">
    
      
    
    
  </div>
                
                  <div class="section" id="upgrading-mongoid">
<h1>Upgrading Mongoid<a class="headerlink" href="#upgrading-mongoid" title="Permalink to this headline">¶</a></h1>
<div class="contents singlecol local topic" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><a class="reference internal" href="#upgrading-to-mongoid-7-3" id="id1">Upgrading to Mongoid 7.3</a><ul>
<li><a class="reference internal" href="#boolean-removed" id="id2"><code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> Removed</a></li>
<li><a class="reference internal" href="#selector-key-stringification" id="id3">Selector Key Stringification</a></li>
<li><a class="reference internal" href="#condition-combination-using-eq" id="id4">Condition Combination Using <code class="docutils literal notranslate"><span class="pre">$eq</span></code></a></li>
<li><a class="reference internal" href="#new-embedded-matching-operators" id="id5">New Embedded Matching Operators</a></li>
<li><a class="reference internal" href="#unaliasing-id-field" id="id6">Unaliasing <code class="docutils literal notranslate"><span class="pre">id</span></code> Field</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-mongoid-7-2" id="id7">Upgrading to Mongoid 7.2</a><ul>
<li><a class="reference internal" href="#embedded-document-matching" id="id8">Embedded Document Matching</a></li>
<li><a class="reference internal" href="#count-and-estimated-count-methods" id="id9"><code class="docutils literal notranslate"><span class="pre">count</span></code> and <code class="docutils literal notranslate"><span class="pre">estimated_count</span></code> Methods</a></li>
<li><a class="reference internal" href="#any-on-has-many-associations" id="id10"><code class="docutils literal notranslate"><span class="pre">any?</span></code> on <code class="docutils literal notranslate"><span class="pre">has_many</span></code> Associations</a></li>
<li><a class="reference internal" href="#stringifiedsymbol-field-type" id="id11"><code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> Field Type</a></li>
<li><a class="reference internal" href="#changing-the-discriminator-key" id="id12">Changing the Discriminator Key</a></li>
<li><a class="reference internal" href="#changing-the-discriminator-value" id="id13">Changing the Discriminator Value</a></li>
<li><a class="reference internal" href="#shard-key-used-for-reloading" id="id14">Shard Key Used For Reloading</a></li>
<li><a class="reference internal" href="#query-cache-moved-to-driver" id="id15">Query Cache Moved to Driver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-mongoid-7-1" id="id16">Upgrading to Mongoid 7.1</a><ul>
<li><a class="reference internal" href="#condition-combination" id="id17">Condition Combination</a></li>
<li><a class="reference internal" href="#logical-operations" id="id18">Logical Operations</a></li>
<li><a class="reference internal" href="#merge-strategies" id="id19">Merge Strategies</a></li>
<li><a class="reference internal" href="#required-condition-arguments" id="id20">Required Condition Arguments</a></li>
<li><a class="reference internal" href="#generated-queries" id="id21">Generated Queries</a></li>
<li><a class="reference internal" href="#ruby-version-support" id="id22">Ruby Version Support</a></li>
<li><a class="reference internal" href="#changes-in-mongoid-7-1-0" id="id23">Changes in Mongoid 7.1.0</a></li>
<li><a class="reference internal" href="#changes-in-mongoid-7-1-1" id="id24">Changes in Mongoid 7.1.1</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrading-to-mongoid-7-0" id="id25">Upgrading to Mongoid 7.0</a></li>
<li><a class="reference internal" href="#upgrading-to-mongoid-6" id="id26">Upgrading to Mongoid 6</a></li>
<li><a class="reference internal" href="#upgrading-to-mongoid-5" id="id27">Upgrading to Mongoid 5</a></li>
</ul>
</div>
<p>This page describes significant changes and improvements in Mongoid releases.
The complete list of releases is available <a class="reference external" href="https://github.com/mongodb/mongoid/releases">on GitHub</a> and <a class="reference external" href="https://jira.mongodb.org/projects/MONGOID?selectedItem=com.atlassian.jira.jira-projects-plugin:release-page">in JIRA</a>;
please consult GitHub releases for detailed release notes and JIRA for
the complete list of issues fixed in each release, including bug fixes.</p>
<div class="section" id="upgrading-to-mongoid-7-3">
<h2>Upgrading to Mongoid 7.3<a class="headerlink" href="#upgrading-to-mongoid-7-3" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe significant changes in Mongoid 7.3.</p>
<div class="section" id="boolean-removed">
<h3><code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> Removed<a class="headerlink" href="#boolean-removed" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> Mongoid 7.3 removes the global <code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> class.</p>
<p>This change should have no impact on classes that simply use <code class="docutils literal notranslate"><span class="pre">Boolean</span></code>
fields, as the <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> class is aliased from <code class="docutils literal notranslate"><span class="pre">Mongoid::Fields</span></code>
(which is included in <code class="docutils literal notranslate"><span class="pre">Mongoid::Document</span></code>). The following field definition
continues to work in 7.3 as it did in 7.2:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">field</span> <span class="ss">:verified</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Boolean</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>However, code that is not executed in the context of a class including
<code class="docutils literal notranslate"><span class="pre">Mongoid::Document</span></code> may need to explicitly qualify <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> references.
The following snippet fails with Mongoid 7.3 due to <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> being
unqualified:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
<span class="k">end</span>

<span class="no">User</span><span class="o">.</span><span class="n">field</span> <span class="ss">:verified</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Boolean</span>
</pre></div>
</div>
</div>
<p>To fix it, use the fully-qualified <code class="docutils literal notranslate"><span class="pre">Mongoid::Boolean</span></code> class:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">User</span><span class="o">.</span><span class="n">field</span> <span class="ss">:verified</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
</pre></div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">class_eval</span></code> is executed in the scope of the caller, not in
the scope of the class being modified. Thus even when using <code class="docutils literal notranslate"><span class="pre">class_eval</span></code>
it is necessary to fully qualify <code class="docutils literal notranslate"><span class="pre">Mongoid::Boolean</span></code>:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">User</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
  <span class="n">field</span> <span class="ss">:verified</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Additionally, in Mongoid 7.2 <code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> and <code class="docutils literal notranslate"><span class="pre">Mongoid::Boolean</span></code> were
different classes. In Mongoid 7.3 there is only one class which is
<code class="docutils literal notranslate"><span class="pre">Mongoid::Boolean</span></code>.</p>
<p>It is possible to restore the global <code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> class by executing in
your application:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Boolean</span> <span class="o">=</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
</pre></div>
</div>
</div>
<p>Note that this aliases <code class="docutils literal notranslate"><span class="pre">Mongoid::Boolean</span></code> to <code class="docutils literal notranslate"><span class="pre">::Boolean</span></code> such that there
is still only a single Boolean class:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># With Mongoid 7.3:</span>
<span class="no">Boolean</span> <span class="o">=</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
<span class="no">Boolean</span> <span class="o">==</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
<span class="c1"># =&gt; true</span>

<span class="c1"># With Mongoid 7.2:</span>
<span class="no">Boolean</span> <span class="o">==</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Boolean</span>
<span class="c1"># =&gt; false</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="selector-key-stringification">
<h3>Selector Key Stringification<a class="headerlink" href="#selector-key-stringification" title="Permalink to this headline">¶</a></h3>
<p>Minor change: Mongoid now converts symbol keys to string keys in the
<code class="docutils literal notranslate"><span class="pre">Criteria</span></code> selectors. This applies to operators as well as hash literals.</p>
<p>Mongoid 7.3 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{&quot;$in&quot;=&gt;[2020]}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>

<span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">tag</span><span class="p">:</span> <span class="p">{</span><span class="ss">city</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;tag&quot;=&gt;{&quot;city&quot;=&gt;1}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.2 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{:$in=&gt;[2020]}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>

<span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">tag</span><span class="p">:</span> <span class="p">{</span><span class="ss">city</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;tag&quot;=&gt;{:city=&gt;1}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="condition-combination-using-eq">
<h3>Condition Combination Using <code class="docutils literal notranslate"><span class="pre">$eq</span></code><a class="headerlink" href="#condition-combination-using-eq" title="Permalink to this headline">¶</a></h3>
<p>Minor change: when using the <code class="docutils literal notranslate"><span class="pre">where</span></code>, <code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, and <code class="docutils literal notranslate"><span class="pre">nor</span></code> methods
on <code class="docutils literal notranslate"><span class="pre">Criteria</span></code> objects and providing multiple conditions on the same field
in the same argument using the symbol operator syntax, conditions may be
combined using <code class="docutils literal notranslate"><span class="pre">$eq</span></code> instead of <code class="docutils literal notranslate"><span class="pre">$and</span></code>.</p>
<p>Mongoid 7.3 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2020</span><span class="p">,</span> <span class="ss">:year</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">1960</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{&quot;$eq&quot;=&gt;2020, &quot;$gt&quot;=&gt;1960}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.2 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2020</span><span class="p">,</span> <span class="ss">:year</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">1960</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;2020, &quot;$and&quot;=&gt;[{&quot;year&quot;=&gt;{&quot;$gt&quot;=&gt;1960}}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>When using the <code class="docutils literal notranslate"><span class="pre">not</span></code> method with multiple conditions provided in the same
argument, the conditions are kept together and negated as a group.</p>
<p>Mongoid 7.3 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2020</span><span class="p">,</span> <span class="ss">:year</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">1960</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;$and&quot;=&gt;[{&quot;$nor&quot;=&gt;[{&quot;year&quot;=&gt;{&quot;$eq&quot;=&gt;2020, &quot;$gt&quot;=&gt;1960}}]}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.2 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2020</span><span class="p">,</span> <span class="ss">:year</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">1960</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{&quot;$ne&quot;=&gt;2020}, &quot;$and&quot;=&gt;[{&quot;$nor&quot;=&gt;[{&quot;year&quot;=&gt;{&quot;$gt&quot;=&gt;1960}}]}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="new-embedded-matching-operators">
<h3>New Embedded Matching Operators<a class="headerlink" href="#new-embedded-matching-operators" title="Permalink to this headline">¶</a></h3>
<p>Mongoid 7.3 adds support for bitwise operators, <code class="docutils literal notranslate"><span class="pre">$comment</span></code>, <code class="docutils literal notranslate"><span class="pre">$mod</span></code> and
<code class="docutils literal notranslate"><span class="pre">$type</span></code> operators when <a class="reference internal" href="mongoid-relations.html#embedded-matching"><span class="std std-ref">embedded matching</span></a>.</p>
</div>
<div class="section" id="unaliasing-id-field">
<h3>Unaliasing <code class="docutils literal notranslate"><span class="pre">id</span></code> Field<a class="headerlink" href="#unaliasing-id-field" title="Permalink to this headline">¶</a></h3>
<p>It is now possible to <a class="reference internal" href="mongoid-documents.html#unalias-id"><span class="std std-ref">remove the id alias in models</span></a>,
to make <code class="docutils literal notranslate"><span class="pre">id</span></code> a regular field.</p>
</div>
</div>
<div class="section" id="upgrading-to-mongoid-7-2">
<h2>Upgrading to Mongoid 7.2<a class="headerlink" href="#upgrading-to-mongoid-7-2" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe significant changes in Mongoid 7.2.</p>
<div class="section" id="embedded-document-matching">
<h3>Embedded Document Matching<a class="headerlink" href="#embedded-document-matching" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> In Mongoid 7.2 <a class="reference internal" href="mongoid-relations.html#embedded-matching"><span class="std std-ref">embedded matchers</span></a>
were largely rewritten. Most queries should produce the same results as in
previous versions of Mongoid but a number of cases changed behavior to make
Mongoid behave the same way MongoDB server behaves. Note that the changes,
for the most part, affect queries using manually constructed MQL expressions;
Mongoid query methods generate MQL that is generally not affected by the
changes in embedded matching.</p>
<p>To illustrate the differences, the examples below use the following model
definitions:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Job</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="n">embeds_many</span> <span class="ss">:tasks</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Task</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Attributes</span><span class="o">::</span><span class="no">Dynamic</span>

  <span class="n">embedded_in</span> <span class="ss">:job</span>
<span class="k">end</span>

<span class="n">job</span> <span class="o">=</span> <span class="no">Job</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">tasks</span><span class="p">:</span> <span class="o">[</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Clean house&#39;</span><span class="p">,</span> <span class="ss">pattern</span><span class="p">:</span> <span class="sr">/test/</span><span class="p">,</span> <span class="ss">hours</span><span class="p">:</span> <span class="mi">12</span><span class="p">),</span>
<span class="o">]</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The changes in behavior are as follows:</p>
<div class="section" id="eq-and-regular-expression-values">
<h4><code class="docutils literal notranslate"><span class="pre">$eq</span></code> and Regular Expression Values<a class="headerlink" href="#eq-and-regular-expression-values" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">$eq</span></code> now performs exact matching when given regular a expression argument.
Previously, both operators used regular expression matching, which caused
Mongoid to not find documents where the field being matched was a regular
expression itself:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="sr">/house/</span><span class="p">})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2:</span>
<span class="c1"># =&gt; nil</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">pattern</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="sr">/test/</span><span class="p">})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; nil</span>
</pre></div>
</div>
</div>
<p>To perform a regular expression match, provide the regular expression directly
without an operator:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="sr">/house/</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ne-and-regular-expression-values">
<h4><code class="docutils literal notranslate"><span class="pre">$ne</span></code> and Regular Expression Values<a class="headerlink" href="#ne-and-regular-expression-values" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">$ne</span></code> no longer accepts regular expression arguments, which is the behavior
of MongoDB server:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$ne&#39;</span><span class="p">:</span> <span class="sr">/apartment/</span><span class="p">})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2: raises Mongoid::Errors::InvalidQuery</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
</pre></div>
</div>
</div>
<p>To perform a negated regular expression match, use the <code class="docutils literal notranslate"><span class="pre">not</span></code> method on a
symbol key:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:name</span><span class="o">.</span><span class="n">not</span> <span class="o">=&gt;</span> <span class="sr">/house/</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; nil</span>
<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:name</span><span class="o">.</span><span class="n">not</span> <span class="o">=&gt;</span> <span class="sr">/office/</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eq-ne-and-range-values">
<h4><code class="docutils literal notranslate"><span class="pre">$eq</span></code>, <code class="docutils literal notranslate"><span class="pre">$ne</span></code> and Range Values<a class="headerlink" href="#eq-ne-and-range-values" title="Permalink to this headline">¶</a></h4>
<p>Range values are no longer accepted by <code class="docutils literal notranslate"><span class="pre">$eq</span></code> and <code class="docutils literal notranslate"><span class="pre">$ne</span></code> operators.
This change should not be visible to applications since Mongoid generally
expands Range values to a <code class="docutils literal notranslate"><span class="pre">$gte</span></code>/<code class="docutils literal notranslate"><span class="pre">$lte</span></code> pair before they get to the
embedded matchers.</p>
<p>To query using a range, use the following syntax which works in Mongoid 7.2
as well as previous versions:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="mi">10</span><span class="o">..</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;hours&quot;=&gt;{&quot;$gte&quot;=&gt;10, &quot;$lte&quot;=&gt;15}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Task</span>
<span class="c1">#   embedded: true&gt;</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="mi">10</span><span class="o">..</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dd4c2c97a6465e8a4ffa, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.1 accepted Range values as operator arguments, but generated
queries that would never match documents. For example, the following
expression was accepted but never matched any documents:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="o">..</span><span class="mi">15</span><span class="p">})</span>
<span class="c1"># =&gt;</span>
<span class="c1"># #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;hours&quot;=&gt;{:$in=&gt;{&quot;$gte&quot;=&gt;10, &quot;$lte&quot;=&gt;15}}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Task</span>
<span class="c1">#   embedded: true&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.2 raises <code class="docutils literal notranslate"><span class="pre">Mongoid::Errors::InvalidQuery</span></code> in this case.</p>
</div>
<div class="section" id="elemmatch">
<h4><code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code><a class="headerlink" href="#elemmatch" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code> now supports specifying operators as top-level fields:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">mixed_tasks_job</span> <span class="o">=</span> <span class="no">Job</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">tasks</span><span class="p">:</span> <span class="o">[</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Clean house&#39;</span><span class="p">,</span> <span class="ss">hours</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="ss">supplies</span><span class="p">:</span> <span class="o">[</span><span class="p">{</span><span class="ss">broom</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span><span class="o">]</span><span class="p">),</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Clean office&#39;</span><span class="p">,</span> <span class="ss">hours</span><span class="p">:</span> <span class="o">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="o">]</span><span class="p">),</span>
<span class="o">]</span><span class="p">)</span>

<span class="n">mixed_tasks_job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$elemMatch&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$lt&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8c7202c97a6465e8a4ff3, name: &quot;Clean office&quot;, hours: [8, 16]&gt;</span>
<span class="c1"># Mongoid 7.1: error</span>
</pre></div>
</div>
</div>
<p>Implicit matching under <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code> has been fixed and now works:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">mixed_tasks_job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">supplies</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$elemMatch&#39;</span><span class="p">:</span> <span class="p">{</span><span class="ss">broom</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8c9162c97a6465e8a4ff6, name: &quot;Clean house&quot;, hours: 12, supplies: [{:broom=&gt;1}]&gt;</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; nil</span>
</pre></div>
</div>
</div>
<p>For compatibility with MongoDB server, <code class="docutils literal notranslate"><span class="pre">$elemMatch</span></code> requires a <code class="docutils literal notranslate"><span class="pre">Hash</span></code>
argument. Use <code class="docutils literal notranslate"><span class="pre">$eq</span></code> or <code class="docutils literal notranslate"><span class="pre">$regex</span></code> to perform equality comparisons or
regular expression matches, respectively:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">mixed_tasks_job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$elemMatch&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2: raises Mongoid::Errors::InvalidQuery</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; nil</span>

<span class="n">mixed_tasks_job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">hours</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$elemMatch&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}})</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8ca0b2c97a6465e8a4ff9, name: &quot;Clean office&quot;, hours: [8, 16]&gt;</span>
<span class="c1"># Mongoid 7.1: error</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="and-nor-or-and-empty-argument-arrays">
<h4><code class="docutils literal notranslate"><span class="pre">$and</span></code>, <code class="docutils literal notranslate"><span class="pre">$nor</span></code>, <code class="docutils literal notranslate"><span class="pre">$or</span></code> and Empty Argument Arrays<a class="headerlink" href="#and-nor-or-and-empty-argument-arrays" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">$and</span></code>, <code class="docutils literal notranslate"><span class="pre">$nor</span></code> and <code class="docutils literal notranslate"><span class="pre">$or</span></code> operators now raise an exception when given
empty arrays as arguments. This only applies to raw MQL query expressions;
the corresponding Mongoid <a class="reference internal" href="mongoid-queries.html#logical-operations"><span class="std std-ref">query methods</span></a>
continue to permit being called without arguments. In previous versions
of Mongoid, <code class="docutils literal notranslate"><span class="pre">$and</span></code> would match when given an empty array of conditions
and <code class="docutils literal notranslate"><span class="pre">$nor</span></code> and <code class="docutils literal notranslate"><span class="pre">$or</span></code> would not match when given empty arrays of
conditions.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;$and&#39;</span><span class="p">:</span> <span class="o">[]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2: raises Mongoid::Errors::InvalidQuery</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;$nor&#39;</span><span class="p">:</span> <span class="o">[]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2: raises Mongoid::Errors::InvalidQuery</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; nil</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;$or&#39;</span><span class="p">:</span> <span class="o">[]</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2: raises Mongoid::Errors::InvalidQuery</span>
<span class="c1"># Mongoid 7.1:</span>
<span class="c1"># =&gt; nil</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">and</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">nor</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>

<span class="n">job</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">or</span><span class="o">.</span><span class="n">first</span>
<span class="c1"># Mongoid 7.2 and 7.1:</span>
<span class="c1"># =&gt; #&lt;Task _id: 5ef8dc3e2c97a645ec86bb33, name: &quot;Clean house&quot;, pattern: /test/, hours: 12&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="count-and-estimated-count-methods">
<h3><code class="docutils literal notranslate"><span class="pre">count</span></code> and <code class="docutils literal notranslate"><span class="pre">estimated_count</span></code> Methods<a class="headerlink" href="#count-and-estimated-count-methods" title="Permalink to this headline">¶</a></h3>
<p>Minor change: the <code class="docutils literal notranslate"><span class="pre">count</span></code> method on model classes and <code class="docutils literal notranslate"><span class="pre">Criteria</span></code> objects
is now using the <code class="docutils literal notranslate"><span class="pre">count_documents</span></code> driver helper. This makes <code class="docutils literal notranslate"><span class="pre">count</span></code>
seamlessly work in transactions.</p>
<p>Model classes now also have the <code class="docutils literal notranslate"><span class="pre">estimated_count</span></code> method to obtain an
approximate number of documents in the collection. This method is roughly
equivalent to the <code class="docutils literal notranslate"><span class="pre">count</span></code> method in Mongoid 7.1 and earlier, except
<code class="docutils literal notranslate"><span class="pre">estimated_count</span></code> does not accept filter conditions.</p>
<p>The new behavior is further described in the <a class="reference internal" href="mongoid-queries.html#additional-query-methods"><span class="std std-ref">Additional Query Methods</span></a> section.</p>
</div>
<div class="section" id="any-on-has-many-associations">
<h3><code class="docutils literal notranslate"><span class="pre">any?</span></code> on <code class="docutils literal notranslate"><span class="pre">has_many</span></code> Associations<a class="headerlink" href="#any-on-has-many-associations" title="Permalink to this headline">¶</a></h3>
<p>Minor change: the <a class="reference internal" href="mongoid-relations.html#has-many-any"><span class="std std-ref">any? method on has_many associations</span></a>
was optimized to only retrieve the _id field when querying the database,
instead of loading the entire association.</p>
</div>
<div class="section" id="stringifiedsymbol-field-type">
<h3><code class="docutils literal notranslate"><span class="pre">StringifiedSymbol</span></code> Field Type<a class="headerlink" href="#stringifiedsymbol-field-type" title="Permalink to this headline">¶</a></h3>
<p>New feature: the <a class="reference internal" href="mongoid-documents.html#stringified-symbol"><span class="std std-ref">StringifiedSymbol field type</span></a>
was added for storing Ruby symbol values in MongoDB in a manner interoperable
with other programming languages.</p>
</div>
<div class="section" id="changing-the-discriminator-key">
<h3>Changing the Discriminator Key<a class="headerlink" href="#changing-the-discriminator-key" title="Permalink to this headline">¶</a></h3>
<p>New feature: Mongoid now supports <a class="reference internal" href="mongoid-documents.html#discriminator-key"><span class="std std-ref">changing the default discriminator key</span></a> from the default <code class="docutils literal notranslate"><span class="pre">_type</span></code> when using inheritance.
This can be done by setting the <code class="docutils literal notranslate"><span class="pre">discriminator_key</span></code> field on the parent class
or globally. To set the discriminator key on the parent class:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Shape</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">discriminator_key</span> <span class="o">=</span> <span class="s2">&quot;shape_type&quot;</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Circle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>To set the discrminator key globally:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Mongoid</span><span class="o">.</span><span class="n">discriminator_key</span> <span class="o">=</span> <span class="s2">&quot;global_discriminator&quot;</span>

<span class="k">class</span> <span class="nc">Shape</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Circle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="changing-the-discriminator-value">
<h3>Changing the Discriminator Value<a class="headerlink" href="#changing-the-discriminator-value" title="Permalink to this headline">¶</a></h3>
<p>New feature: Mongoid now also supports <a class="reference internal" href="mongoid-documents.html#discriminator-value"><span class="std std-ref">changing the discriminator value</span></a> from the default value, which is the class name.
The discriminator value can be changed by setting the <code class="docutils literal notranslate"><span class="pre">discriminator_value</span></code>
on that class:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Shape</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Circle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">discriminator_value</span> <span class="o">=</span> <span class="s2">&quot;round thing&quot;</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Rectangle</span> <span class="o">&lt;</span> <span class="no">Shape</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="shard-key-used-for-reloading">
<h3>Shard Key Used For Reloading<a class="headerlink" href="#shard-key-used-for-reloading" title="Permalink to this headline">¶</a></h3>
<p>Minor change: When sharding is used, Mongoid 7.2 expects the shard key declared
in models to match the shard key in the database for the respective collections.
In Mongoid 7.2 model reloading (either explicit via the <code class="docutils literal notranslate"><span class="pre">reload</span></code> method
or implicit as part of persistence operations) uses the shard key, if one is
defined, in the <code class="docutils literal notranslate"><span class="pre">find</span></code> command in addition to the <code class="docutils literal notranslate"><span class="pre">id</span></code> field value.
This improves the performance of document reloading, and consequently some
persistence operations, in sharded clusters, especially those with
<a class="reference external" href="https://docs.atlas.mongodb.com/global-clusters/">geographically distributed shards</a>.</p>
<p>Consider a class <code class="docutils literal notranslate"><span class="pre">Band</span></code> whose documents are sharded by the <code class="docutils literal notranslate"><span class="pre">name</span></code> key.</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Band</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>

  <span class="n">shard_key</span> <span class="ss">:name</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p>Example Mongoid 7.2 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Destiny&#39;s Child&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">reload</span>
<span class="c1"># Command logs: { &quot;find&quot;=&gt;&quot;bands&quot;, &quot;filter&quot;=&gt;{ &quot;_id&quot;=&gt;BSON::ObjectId(&#39;...&#39;) &quot;name&quot;=&gt;&quot;Destiny&#39;s Child&quot; } }</span>
</pre></div>
</div>
</div>
<p>Example Mongoid 7.1 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="no">Band</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Destiny&#39;s Child&quot;</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">reload</span>
<span class="c1"># Command logs: { &quot;find&quot;=&gt;&quot;bands&quot;, &quot;filter&quot;=&gt;{&quot;_id&quot;=&gt;BSON::ObjectId(&#39;...&#39;) } }</span>
</pre></div>
</div>
</div>
<p>Mongoid provides <a class="reference internal" href="sharding.html#sharding-management"><span class="std std-ref">sharding management Rake tasks</span></a>
to shard collections according to shard keys declared in models.</p>
</div>
<div class="section" id="query-cache-moved-to-driver">
<h3>Query Cache Moved to Driver<a class="headerlink" href="#query-cache-moved-to-driver" title="Permalink to this headline">¶</a></h3>
<p>Minor change: Ruby driver version 2.14.0 implements a new and improved query
cache. When using driver version 2.14.0 or newer, Mongoid will use the driver’s
query cache to cache query results.</p>
<p>The driver query cache introduces the following improvements:</p>
<ul class="simple">
<li>Caching multi-batch query results</li>
<li>Taking a query’s read concern and read preference into account when deciding
when to return cached results</li>
<li>Invalidating the cache after bulk write operations and aggregation operations
with <code class="docutils literal notranslate"><span class="pre">$out</span></code> and <code class="docutils literal notranslate"><span class="pre">$merge</span></code> pipeline stages</li>
<li>Invalidating the cache after transaction commit and abort operations</li>
<li>Improved performance of queries with limits</li>
<li>Caching aggregation results</li>
<li>More efficient query cache invalidation</li>
</ul>
<p>Mongoid’s query cache, which will now be referred to as the “legacy query cache,”
has been deprecated. Mongoid will retain the legacy query cache for use with
older versions of the driver.</p>
<p>The interface for enabling and disabling the query cache in Mongoid has not
changed. When using driver versions 2.14.0 and newer, this interface will
enable or disable the query cache in the driver.</p>
<p>The driver query cache is more correct and more effective than the legacy
Mongoid query cache. If you plan to use the query cache, it is recommended
that you upgrade to driver version 2.14.</p>
<p>To read more about the query cache improvements made in the driver, see
<a class="reference external" href="https://docs.mongodb.com/ruby-driver/current/tutorials/query-cache/">the Ruby driver documentation</a>.</p>
<p>To read more about using the query cache with Mongoid and the limitations
of the legacy query cache, see <a class="reference internal" href="mongoid-queries.html#query-cache"><span class="std std-ref">the query cache documentation</span></a>.</p>
</div>
</div>
<div class="section" id="upgrading-to-mongoid-7-1">
<h2>Upgrading to Mongoid 7.1<a class="headerlink" href="#upgrading-to-mongoid-7-1" title="Permalink to this headline">¶</a></h2>
<p>The following sections describe significant changes in Mongoid 7.1.</p>
<div class="section" id="condition-combination">
<h3>Condition Combination<a class="headerlink" href="#condition-combination" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> In Mongoid 7.1, when condition methods are invoked on a
Criteria object, they always add new conditions to the existing conditions in
the Criteria object. Previously new conditions could have replaced existing
conditions in some circumstances.</p>
<p>Example Mongoid 7.1 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;_id&quot;=&gt;1, &quot;$and&quot;=&gt;[{&quot;_id&quot;=&gt;2}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Corresponding Mongoid 7.0 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;_id&quot;=&gt;2}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p><strong>Known issue:</strong> When using Ruby 2.6 and lower, when adding multiple conditions
on the same field using the same operator, the operator must be given as a
string, not as a symbol. The following invocations fail:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">({</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">}},</span> <span class="p">{</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">}})</span>
<span class="c1"># Traceback (most recent call last):</span>
<span class="c1">#         2: from (irb):10</span>
<span class="c1">#         1: from (irb):10:in `rescue in irb_binding&#39;</span>
<span class="c1"># NoMethodError (undefined method `start_with?&#39; for :$in:Symbol)</span>

<span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span>
<span class="c1"># Traceback (most recent call last):</span>
<span class="c1">#         2: from (irb):11</span>
<span class="c1">#         1: from (irb):11:in `rescue in irb_binding&#39;</span>
<span class="c1"># NoMethodError (undefined method `start_with?&#39; for :$in:Symbol)</span>
</pre></div>
</div>
</div>
<p>Use string keys instead:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1"># Band.and({year: {&#39;$in&#39; =&gt; [2020]}}, {year: {&#39;$in&#39; =&gt; [2020]}})</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{&quot;$in&quot;=&gt;[2020]}, &quot;$and&quot;=&gt;[{&quot;year&quot;=&gt;{&quot;$in&quot;=&gt;[2020]}}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>

<span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2020</span><span class="o">]</span><span class="p">})</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;{&quot;$in&quot;=&gt;[2020]}, &quot;$and&quot;=&gt;[{&quot;year&quot;=&gt;{&quot;$in&quot;=&gt;[2020]}}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>This issue is rectified in Mongoid 7.3.</p>
</div>
<div class="section" id="logical-operations">
<h3>Logical Operations<a class="headerlink" href="#logical-operations" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> In Mongoid 7.1 logical operator methods <code class="docutils literal notranslate"><span class="pre">or</span></code> and
<code class="docutils literal notranslate"><span class="pre">nor</span></code> treat the receiver as one of the operands. This behavior matches that
of ActiveRecord. Previously, <code class="docutils literal notranslate"><span class="pre">or</span></code> and <code class="docutils literal notranslate"><span class="pre">nor</span></code> added their parameters as
additional conditions to the receiver.</p>
<p>Example Mongoid 7.1 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">or</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;$or&quot;=&gt;[{&quot;name&quot;=&gt;&quot;One&quot;}, {&quot;name&quot;=&gt;&quot;Two&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Corresponding Mongoid 7.0 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">or</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;name&quot;=&gt;&quot;One&quot;, &quot;$or&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Two&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>To add <code class="docutils literal notranslate"><span class="pre">or</span></code> or <code class="docutils literal notranslate"><span class="pre">nor</span></code> parameters to the existing query without disjuncting
the existing query, create a separate scope:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="no">Band</span><span class="o">.</span><span class="n">or</span><span class="p">({</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Three&#39;</span><span class="p">}))</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;name&quot;=&gt;&quot;One&quot;, &quot;$and&quot;=&gt;[{&quot;$or&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Two&quot;}, {&quot;name&quot;=&gt;&quot;Three&quot;}]}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Alternatively, use <code class="docutils literal notranslate"><span class="pre">any_of</span></code> which behaves as <code class="docutils literal notranslate"><span class="pre">or</span></code> did in Mongoid 7.0:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">any_of</span><span class="p">({</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Three&#39;</span><span class="p">})</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;name&quot;=&gt;&quot;One&quot;, &quot;$or&quot;=&gt;[{&quot;name&quot;=&gt;&quot;Two&quot;}, {&quot;name&quot;=&gt;&quot;Three&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>For more information, please review the <a class="reference internal" href="mongoid-queries.html#logical-operations"><span class="std std-ref">logical operations</span></a> section of the documentation.</p>
</div>
<div class="section" id="merge-strategies">
<h3>Merge Strategies<a class="headerlink" href="#merge-strategies" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> In Mongoid 7.1, <a class="reference internal" href="mongoid-queries.html#merge-strategies"><span class="std std-ref">Merge strategies</span></a>
must be explicitly requested. Previously, <code class="docutils literal notranslate"><span class="pre">all</span></code> defaulted to the
union strategy and <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">nin</span></code> defaulted to the intersect strategy.
In Mongoid 7.1, there is no merge strategy applied by default.</p>
<p>Example Mongoid 7.1 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;a&quot;=&gt;{&quot;$all&quot;=&gt;[1]}, &quot;$and&quot;=&gt;[{&quot;a&quot;=&gt;{&quot;$all&quot;=&gt;[2]}}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Default Mongoid 7.0 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;a&quot;=&gt;{&quot;$all&quot;=&gt;[1, 2]}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>To achieve the same behavior in Mongoid 7.1, the desired merge strategy must be
explicitly requested:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;a&quot;=&gt;{&quot;$all&quot;=&gt;[1, 2]}}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="required-condition-arguments">
<h3>Required Condition Arguments<a class="headerlink" href="#required-condition-arguments" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> <code class="docutils literal notranslate"><span class="pre">nil</span></code> arguments to Criteria methods are no longer
accepted. For example, the following invocation is now an error:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Breaking change:</strong> Most Criteria methods (other than logical operations)
can no longer be called without arguments. For example, the following
invocation is now an error:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">in</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">or</span></code>, <code class="docutils literal notranslate"><span class="pre">nor</span></code>, <code class="docutils literal notranslate"><span class="pre">not</span></code>, <code class="docutils literal notranslate"><span class="pre">any_of</span></code> and <code class="docutils literal notranslate"><span class="pre">where</span></code> can be called
without arguments.</p>
</div>
<div class="section" id="generated-queries">
<h3>Generated Queries<a class="headerlink" href="#generated-queries" title="Permalink to this headline">¶</a></h3>
<p>Minor change: Mongoid 7.1 will simplify the Criteria selectors where possible
by eliding unnecessary logical operators, typically <code class="docutils literal notranslate"><span class="pre">$and</span></code>.</p>
<p>Example Mongoid 7.1 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;2000, &quot;name&quot;=&gt;&quot;One&quot;}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Corresponding Mongoid 7.0 behavior:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;2000, &quot;$and&quot;=&gt;[{&quot;name&quot;=&gt;&quot;One&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Mongoid 7.1 also takes steps to produce the same selector shapes when
semantically the same query is constructed using different code paths. For
example, the following two approaches result in the same generated selector:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="sr">/ne/</span><span class="p">)</span><span class="o">.</span><span class="n">and</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">)</span>

<span class="no">Band</span><span class="o">.</span><span class="n">and</span><span class="p">({</span><span class="nb">name</span><span class="p">:</span> <span class="sr">/ne/</span><span class="p">},</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">})</span>

<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;name&quot;=&gt;/ne/, &quot;$and&quot;=&gt;[{&quot;name&quot;=&gt;&quot;One&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ruby-version-support">
<h3>Ruby Version Support<a class="headerlink" href="#ruby-version-support" title="Permalink to this headline">¶</a></h3>
<p>As of version 7.1, Mongoid supports Ruby 2.3+ and JRuby 9.2.
Support for Ruby 2.2 and JRuby 9.1 has been dropped.</p>
</div>
<div class="section" id="changes-in-mongoid-7-1-0">
<h3>Changes in Mongoid 7.1.0<a class="headerlink" href="#changes-in-mongoid-7-1-0" title="Permalink to this headline">¶</a></h3>
<p>Improvement: <a class="reference internal" href="mongoid-persistence.html#atomic-operation-grouping"><span class="std std-ref">Multiple atomic operations can now be grouped</span></a> to be executed as a single atomic operation.</p>
<p>Improvement: <a class="reference internal" href="sharding.html#shard-keys"><span class="std std-ref">Shard key declarations</span></a> now support hashed
shard keys, and a Rake task to shard collection has been added to the
<a class="reference internal" href="sharding.html#sharding-management"><span class="std std-ref">sharding management Rake tasks</span></a>.</p>
</div>
<div class="section" id="changes-in-mongoid-7-1-1">
<h3>Changes in Mongoid 7.1.1<a class="headerlink" href="#changes-in-mongoid-7-1-1" title="Permalink to this headline">¶</a></h3>
<p><strong>Breaking change:</strong> The behavior of <a class="reference internal" href="mongoid-queries.html#any-of"><span class="std std-ref">any_of</span></a> was reverted to
its Mongoid 7.0 behavior. As was the case in Mongoid 7.0, <code class="docutils literal notranslate"><span class="pre">any_of</span></code> now
does not treat the receiver as one of its operands:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">1990</span><span class="p">)</span><span class="o">.</span><span class="n">any_of</span><span class="p">({</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">})</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;year&quot;=&gt;1990, &quot;$or&quot;=&gt;[{&quot;name&quot;=&gt;&quot;One&quot;}, {&quot;name&quot;=&gt;&quot;Two&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">or</span></code> behaves the same way in Mongoid 7.1.1 and 7.1.0:</p>
<div class="button-code-block">
<div class="button-row">
<a class="code-button--copy code-button" role="button">
copy</a>
</div>
<div class="copyable-code-block highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Band</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">year</span><span class="p">:</span> <span class="mi">1990</span><span class="p">)</span><span class="o">.</span><span class="n">or</span><span class="p">({</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;One&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Two&#39;</span><span class="p">})</span>
<span class="c1"># =&gt; #&lt;Mongoid::Criteria</span>
<span class="c1">#   selector: {&quot;$or&quot;=&gt;[{&quot;year&quot;=&gt;1990}, {&quot;name&quot;=&gt;&quot;One&quot;}, {&quot;name&quot;=&gt;&quot;Two&quot;}]}</span>
<span class="c1">#   options:  {}</span>
<span class="c1">#   class:    Band</span>
<span class="c1">#   embedded: false&gt;</span>
</pre></div>
</div>
</div>
<p>Minor change: The value of <code class="docutils literal notranslate"><span class="pre">include_root_in_json</span></code> is now properly respected
throughout the model hierarchy. Previously the values set on model classes
were ignored.</p>
<p>Improvement: <code class="docutils literal notranslate"><span class="pre">Model.where</span></code> can now be called with no arguments.</p>
<p>Improvement: Polymorphic <code class="docutils literal notranslate"><span class="pre">belongs_to</span></code> associations can now be eagerly loaded.</p>
</div>
</div>
<div class="section" id="upgrading-to-mongoid-7-0">
<h2>Upgrading to Mongoid 7.0<a class="headerlink" href="#upgrading-to-mongoid-7-0" title="Permalink to this headline">¶</a></h2>
<p>Significant improvements and changes in Mongoid 7.0 are listed below.
Please note that improvements that have been backported to Mongoid 6.x are
not included in this list.</p>
<p>The behavior of <a class="reference internal" href="mongoid-documents.html#read-only"><span class="std std-ref">read-only attributes</span></a> now matches that of
ActiveRecord.</p>
<p>Referenced associations now support all <a class="reference internal" href="mongoid-relations.html#dependent-behavior"><span class="std std-ref">dependent behaviors</span></a>
that <a class="reference external" href="http://guides.rubyonrails.org/association_basics.html">ActiveRecord supports</a>.</p>
<p><a class="reference internal" href="mongoid-relations.html#unwind-dsl"><span class="std std-ref">$unwind</span></a> operator support added to the <a class="reference internal" href="mongoid-relations.html#aggregation-pipeline-builder-dsl"><span class="std std-ref">aggregation
pipeline builder DSL</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">background_indexing</span></code> Mongoid <a class="reference internal" href="mongoid-configuration.html#configuration-options"><span class="std std-ref">configuration option</span></a> added.</p>
<p>Mongoid 7.0 requires MongoDB server 2.6 or newer, Ruby 2.2.2 or higher and
supports Rails 5.1-6.0.</p>
<p>New in version 7.0.3: Embedded matchers now support the <code class="docutils literal notranslate"><span class="pre">$eq</span></code> operator.</p>
<p>New in version 7.0.5: Mongoid now officially supports Rails 6.0.</p>
</div>
<div class="section" id="upgrading-to-mongoid-6">
<h2>Upgrading to Mongoid 6<a class="headerlink" href="#upgrading-to-mongoid-6" title="Permalink to this headline">¶</a></h2>
<p>Mongoid 6 is compatible with Rails 5 and requires Ruby 2.2.2 or higher.</p>
<p>Please see the list of behavior changes for version
<a class="reference external" href="https://github.com/mongodb/mongoid/releases/tag/v6.0.0.rc0">6.0.0.rc0</a>
and version
<a class="reference external" href="https://github.com/mongodb/mongoid/releases/tag/v6.0.0.beta">6.0.0.beta</a>
for specific changes that might be required in your code.</p>
</div>
<div class="section" id="upgrading-to-mongoid-5">
<h2>Upgrading to Mongoid 5<a class="headerlink" href="#upgrading-to-mongoid-5" title="Permalink to this headline">¶</a></h2>
<p>The underlying driver has changed from Moped to the official MongoDB Ruby driver.
For all users dropping down to the driver level for operations, please see the driver
documentation for help with that API.</p>
<p>All Mongoid configuration options have changed, as the underlying driver has changed
from Moped to the official MongoDB Ruby driver. Please see the
<a class="reference internal" href="mongoid-configuration.html#mongoid-configuration"><span class="std std-ref">configuration section</span></a> for a detailed description
of all the new options.</p>
<p>All references to session are now replaced with client. This includes the <code class="docutils literal notranslate"><span class="pre">mongoid.yml</span></code>
configuration, <code class="docutils literal notranslate"><span class="pre">store_in</span></code> options, and all exceptions and modules with Session in the name.</p>
<p><code class="docutils literal notranslate"><span class="pre">find_and_modify</span></code> has been removed and replaced with 3 options: <code class="docutils literal notranslate"><span class="pre">find_one_and_update</span></code>,
<code class="docutils literal notranslate"><span class="pre">find_one_and_delete</span></code> and <code class="docutils literal notranslate"><span class="pre">find_one_and_replace</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">text_search</span></code> has been removed as it is now a $text option in a query from
MongoDB 2.6 onward.</p>
<p><code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> no longer add an <code class="docutils literal notranslate"><span class="pre">_id</span></code> sort when no sorting options have been
provided. In order to guarantee that a document is the first or last, it needs to now
contain an explicit sort.</p>
<p>Mongoid 5 supports MongoDB 2.4 and higher only - MongoDB 2.2 is no longer
supported.</p>
</div>
</div>

                
    <div id="btnv">
      <span class="btn-arrow-left">&larr; &nbsp;</span>
      <a class="btn-prev-text" href="mongoid-rails.html" title="Previous Section: Rails Integration"><span>Rails Integration</span></a>
      <a class="btn-next-text" href="../additional-resources.html" title="Next Section: Additional Resources"><span>Additional Resources</span></a>
      <span class="btn-arrow-right">&nbsp;&rarr;</span>
    </div>
                  <div class="footer">
                    <div class="copyright">
                      <p>&copy; MongoDB, Inc 2008-present. MongoDB, Mongo, and the leaf logo are registered trademarks of MongoDB, Inc.</p>
                    </div>
                  </div>
              </div></div>
            </div>
        </div>
    </div>
    <div class="right-column">
      <div class="wrapper"> <div id='mongodb-docs-1'>
   <script type='text/javascript'>
      googletag.cmd.push(function() { googletag.display('mongodb-docs-1'); });
   </script>
</div>
            <div class="social">
               <a class="slack-icon" href="https://slackpass.io/mongo-db?jmp=docs" title="https://slackpass.io/mongo-db?jmp=docs"><i class="fab fa-slack" aria-hidden="true"></i></a>
               <a class="twitter-icon" href="https://twitter.com/MongoDB" title="https://twitter.com/MongoDB"><i class="fab fa-twitter-square"></i></a>
               <a class="youtube-icon" href="https://www.youtube.com/user/MongoDB" title="https://www.youtube.com/user/MongoDB"><i class="fab fa-youtube-square"></i></a>
               <a class="facebook-icon" href="https://www.facebook.com/mongodb" title="https://www.facebook.com/mongodb"><i class="fab fa-facebook-square"></i></a>
               <a class="stack-overflow-icon" href="https://stackoverflow.com/tags/mongodb/info" title="https://stackoverflow.com/tags/mongodb/info"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a>
            </div>
        

      </div>
    </div>
    
      <div id="rating-panel"></div>
    
    <div class="clearfix"></div>
  </div>
<div id="navbar" data-navprops='{"links": [{"url": "https://docs.mongodb.com/manual/","text": "Server"},{"url": "https://docs.mongodb.com/drivers/","text": "Drivers","active": true},{"url": "https://docs.mongodb.com/cloud/","text": "Cloud"},{"url": "https://docs.mongodb.com/tools/","text": "Tools"},{"url": "https://docs.mongodb.com/guides/","text": "Guides"}]}'></div>

  <script src="../_static/navbar.min.js"></script>

  

  <script type="text/javascript">
  // Bootstrap array of links that should trigger a full page reload
  window.docsExcludedNav = [];
  </script></body>
</html>