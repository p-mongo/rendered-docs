<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Mongo::Cluster::Topology
  
    &mdash; mongo-2.12.0.rc0
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::Cluster::Topology";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span>
     &raquo; 
    <span class="title">Topology</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Mongo::Cluster::Topology
  
  
  
</h1>
<div class="box_info">
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd><span class='object_link'><a href="" title="Mongo::Cluster::Topology (module)">Topology</a></span></dd>
  </dl>
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="" title="Mongo::Cluster::Topology (module)">Topology</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/cluster/topology.rb<span class="defines">,<br />
  lib/mongo/cluster/topology.rb,<br /> lib/mongo/cluster/topology/base.rb,<br /> lib/mongo/cluster/topology/single.rb,<br /> lib/mongo/cluster/topology/sharded.rb,<br /> lib/mongo/cluster/topology/unknown.rb,<br /> lib/mongo/cluster/topology/no_replica_set_options.rb,<br /> lib/mongo/cluster/topology/replica_set_no_primary.rb,<br /> lib/mongo/cluster/topology/replica_set_with_primary.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Defines behavior for getting servers.</p>

<p>Topologies are associated with their clusters - for example, a ReplicaSet topology contains the replica set name. A topology object therefore cannot be used with multiple cluster objects.</p>

<p>At the same time, topology objects do not know anything about specific <strong>servers</strong> in a cluster, despite what their constructor may suggest. Which means, in particular, that topology change events require the application to maintain cluster references on its own if it wants to track server changes within a replica set.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Topology/NoReplicaSetOptions.html" title="Mongo::Cluster::Topology::NoReplicaSetOptions (module)">NoReplicaSetOptions</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Topology/Base.html" title="Mongo::Cluster::Topology::Base (class)">Base</a></span>, <span class='object_link'><a href="Topology/ReplicaSetNoPrimary.html" title="Mongo::Cluster::Topology::ReplicaSetNoPrimary (class)">ReplicaSetNoPrimary</a></span>, <span class='object_link'><a href="Topology/ReplicaSetWithPrimary.html" title="Mongo::Cluster::Topology::ReplicaSetWithPrimary (class)">ReplicaSetWithPrimary</a></span>, <span class='object_link'><a href="Topology/Sharded.html" title="Mongo::Cluster::Topology::Sharded (class)">Sharded</a></span>, <span class='object_link'><a href="Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span>, <span class='object_link'><a href="Topology/Unknown.html" title="Mongo::Cluster::Topology::Unknown (class)">Unknown</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="OPTIONS-constant" class="">OPTIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>The various topologies for server selection.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='label'>replica_set:</span> <span class='const'><span class='object_link'><a href="Topology/ReplicaSetNoPrimary.html" title="Mongo::Cluster::Topology::ReplicaSetNoPrimary (class)">ReplicaSetNoPrimary</a></span></span><span class='comma'>,</span>
  <span class='label'>sharded:</span> <span class='const'><span class='object_link'><a href="Topology/Sharded.html" title="Mongo::Cluster::Topology::Sharded (class)">Sharded</a></span></span><span class='comma'>,</span>
  <span class='label'>direct:</span> <span class='const'><span class='object_link'><a href="Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span></span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initial-instance_method" title="#initial (instance method)">#<strong>initial</strong>(cluster, monitoring, options)  &#x21d2; ReplicaSet, ... </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Get the initial cluster topology for the provided options.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="initial-instance_method">
  
    #<strong>initial</strong>(cluster, monitoring, options)  &#x21d2; <tt>ReplicaSet</tt>, ... 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Get the initial cluster topology for the provided options.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the initial cluster topology.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Mongo::Cluster::Topology (module)">Topology</a></span></span><span class='period'>.</span><span class='id identifier rubyid_initial'>initial</span><span class='lparen'>(</span><span class='label'>topology:</span> <span class='symbol'>:replica_set</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cluster</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cluster.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>monitoring</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The monitoring.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cluster options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:direct_connection</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to connect directly to the specified seed, bypassing topology discovery. Exactly one seed must be provided.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:connect</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated - use :direct_connection option instead of this option. The connection method to use. This forces the cluster to behave in the specified way instead of auto-discovering. One of :direct, :replica_set, :sharded</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:replica_set</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The name of the replica set to connect to. Servers not in this replica set will be ignored.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ReplicaSet</tt>, <tt><span class='object_link'><a href="Topology/Sharded.html" title="Mongo::Cluster::Topology::Sharded (class)">Sharded</a></span></tt>, <tt><span class='object_link'><a href="Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The topology.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster/topology.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initial'>initial</span><span class='lparen'>(</span><span class='id identifier rubyid_cluster'>cluster</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cls'>cls</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:direct_connection</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>!=</span> <span class='symbol'>:direct</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Conflicting topology options: direct_connection=true and connect=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='const'><span class='object_link'><a href="Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:direct_connection</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>==</span> <span class='symbol'>:direct</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Conflicting topology options: direct_connection=false and connect=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:connect</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="#OPTIONS-constant" title="Mongo::Cluster::Topology::OPTIONS (constant)">OPTIONS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:connect</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:replica_set</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:replica_set_name</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Topology/ReplicaSetNoPrimary.html" title="Mongo::Cluster::Topology::ReplicaSetNoPrimary (class)">ReplicaSetNoPrimary</a></span></span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="Topology/Unknown.html" title="Mongo::Cluster::Topology::Unknown (class)">Unknown</a></span></span>
  <span class='kw'>end</span>  <span class='comment'># Options here are client/cluster/server options.
</span>  <span class='comment'># In particular the replica set name key is different for
</span>  <span class='comment'># topology.
</span>  <span class='comment'># If replica_set_name is given (as might be internally by driver),
</span>  <span class='comment'># use that key.
</span>  <span class='comment'># Otherwise (e.g. options passed down from client),
</span>  <span class='comment'># move replica_set to replica_set_name.
</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_cls'>cls</span> <span class='op'>&lt;=</span> <span class='const'><span class='object_link'><a href="Topology/ReplicaSetNoPrimary.html" title="Mongo::Cluster::Topology::ReplicaSetNoPrimary (class)">ReplicaSetNoPrimary</a></span></span> <span class='op'>||</span> <span class='id identifier rubyid_cls'>cls</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:replica_set_name</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:replica_set_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:replica_set</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cls'>cls</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_cluster'>cluster</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Apr 16 01:16:48 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.0).
</div>

    </div>
  </body>
</html>