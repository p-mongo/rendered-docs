<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Mongo::BackgroundThread
  
    &mdash; mongo-2.12.0.rc0
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::BackgroundThread";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span>
     &raquo; 
    <span class="title">BackgroundThread</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Mongo::BackgroundThread
  
  
  <span class="private note title">Private</span>
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="Cluster/PeriodicExecutor.html" title="Mongo::Cluster::PeriodicExecutor (class)">Cluster::PeriodicExecutor</a></span>, <span class='object_link'><a href="Server/Monitor.html" title="Mongo::Server::Monitor (class)">Server::Monitor</a></span>, <span class='object_link'><a href="Server/Populator.html" title="Mongo::Server::Populator (class)">Server::Populator</a></span>, <span class='object_link'><a href="Srv/Monitor.html" title="Mongo::Srv::Monitor (class)">Srv::Monitor</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/background_thread.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This module is part of a private API.</strong>
  You should avoid using this module if possible, as it may be removed or be changed in the future.
</p>

<p>The run!, running? and stop! methods used to be part of the public API in some of the classes which now include this module. Therefore these methods must be considered part of the driver&#39;s public API for backwards compatibility reasons. However using these methods outside of the driver is deprecated.</p>


  </div>
</div>
<div class="tags">
  

</div>


  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">Loggable::PREFIX</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run!-instance_method" title="#run! (instance method)">#<strong>run!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start the background thread.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#running%3F-instance_method" title="#running? (instance method)">#<strong>running?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop!-instance_method" title="#stop! (instance method)">#<strong>stop!</strong>  &#x21d2; true | false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stop the background thread and wait for to terminate for a reasonable amount of time.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></span>, <span class='object_link'><a href="Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></span>, <span class='object_link'><a href="Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></span>, <span class='object_link'><a href="Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></span>, <span class='object_link'><a href="Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="run!-instance_method">
  
    #<strong>run!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Start the background thread.</p>

<p>If the thread is already running, this method does nothing.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/background_thread.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run!'>run!</span>
  <span class='kw'>if</span> <span class='ivar'>@stop_requested</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@thread</span>
    <span class='id identifier rubyid_wait_for_stop'>wait_for_stop</span>
    <span class='kw'>if</span> <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>
      <span class='id identifier rubyid_log_warn'>log_warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting a new background thread in </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'>, but the previous background thread is still running</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='ivar'>@stop_requested</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_running?'>running?</span>
    <span class='ivar'>@thread</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_start!'>start!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="running?-instance_method">
  
    #<strong>running?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/background_thread.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_running?'>running?</span>
  <span class='kw'>if</span> <span class='ivar'>@thread</span>
    <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop!-instance_method">
  
    #<strong>stop!</strong>  &#x21d2; <tt>true | false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stop the background thread and wait for to terminate for a reasonable amount of time.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true | false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether the thread was terminated.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/background_thread.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop!'>stop!</span>  <span class='comment'># If the thread was not started, there is nothing to stop.
</span>  <span class='comment'>#
</span>  <span class='comment'># Classes including this module may want to perform additional
</span>  <span class='comment'># cleanup, which they can do by overriding this method.
</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='ivar'>@thread</span>

  <span class='comment'># Background threads generally perform operations in a loop.
</span>  <span class='comment'># This flag is meant to be checked on each iteration of the
</span>  <span class='comment'># working loops and the thread should stop working when this flag
</span>  <span class='comment'># is set.
</span>  <span class='ivar'>@stop_requested</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># Besides setting the flag, a particular class may have additional
</span>  <span class='comment'># ways of signaling the background thread to either stop working or
</span>  <span class='comment'># wake up to check the stop flag, for example, setting a semaphore.
</span>  <span class='comment'># This can be accomplished by providing the pre_stop method.
</span>  <span class='id identifier rubyid_pre_stop'>pre_stop</span>

  <span class='comment'># Now we have requested the graceful termination, and we could wait
</span>  <span class='comment'># for the thread to exit on its own accord. A future version of the
</span>  <span class='comment'># driver may allow a certain amount of time for the thread to quit.
</span>  <span class='comment'># For now, we additionally use the Ruby machinery to request the thread
</span>  <span class='comment'># be terminated, and do so immediately.
</span>  <span class='comment'>#
</span>  <span class='comment'># Note that this may cause the background thread to terminate in
</span>  <span class='comment'># the middle of an operation.
</span>  <span class='ivar'>@thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>

  <span class='id identifier rubyid_wait_for_stop'>wait_for_stop</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Apr  3 19:18:31 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.0).
</div>

    </div>
  </body>
</html>