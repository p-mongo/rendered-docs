<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mongo::Client
  
    &mdash; mongo-2.14.0.beta
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::Client";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span>
     &raquo; 
    <span class="title">Client</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mongo::Client
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mongo::Client</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Forwardable</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/client.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The client is the entry point to the driver and is the main object that will be interacted with.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="CRUD_OPTIONS-constant" class="">CRUD_OPTIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>The options that do not affect the behavior of a cluster and its subcomponents.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='symbol'>:auto_encryption_options</span><span class='comma'>,</span>
  <span class='symbol'>:database</span><span class='comma'>,</span>
  <span class='symbol'>:read</span><span class='comma'>,</span> <span class='symbol'>:read_concern</span><span class='comma'>,</span>
  <span class='symbol'>:write</span><span class='comma'>,</span> <span class='symbol'>:write_concern</span><span class='comma'>,</span>
  <span class='symbol'>:retry_reads</span><span class='comma'>,</span> <span class='symbol'>:max_read_retries</span><span class='comma'>,</span> <span class='symbol'>:read_retry_interval</span><span class='comma'>,</span>
  <span class='symbol'>:retry_writes</span><span class='comma'>,</span> <span class='symbol'>:max_write_retries</span><span class='comma'>,</span>

  <span class='comment'># Options which cannot currently be here:
</span>  <span class='comment'>#
</span>  <span class='comment'># :server_selection_timeout
</span>  <span class='comment'># Server selection timeout is used by cluster constructor to figure out
</span>  <span class='comment'># how long to wait for initial scan in compatibility mode, but once
</span>  <span class='comment'># the cluster is initialized it no longer uses this timeout.
</span>  <span class='comment'># Unfortunately server selector reads server selection timeout out of
</span>  <span class='comment'># the cluster, and this behavior is required by Cluster#next_primary
</span>  <span class='comment'># which takes no arguments. When next_primary is removed we can revsit
</span>  <span class='comment'># using the same cluster object with different server selection timeouts.
</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="VALID_OPTIONS-constant" class="">VALID_OPTIONS =
          <div class="docstring">
  <div class="discussion">
    
<p>Valid client options.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.2</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='symbol'>:app_name</span><span class='comma'>,</span>
  <span class='symbol'>:auth_mech</span><span class='comma'>,</span>
  <span class='symbol'>:auth_mech_properties</span><span class='comma'>,</span>
  <span class='symbol'>:auth_source</span><span class='comma'>,</span>
  <span class='symbol'>:auto_encryption_options</span><span class='comma'>,</span>
  <span class='symbol'>:bg_error_backtrace</span><span class='comma'>,</span>
  <span class='symbol'>:cleanup</span><span class='comma'>,</span>
  <span class='symbol'>:compressors</span><span class='comma'>,</span>
  <span class='symbol'>:direct_connection</span><span class='comma'>,</span>
  <span class='symbol'>:connect</span><span class='comma'>,</span>
  <span class='symbol'>:connect_timeout</span><span class='comma'>,</span>
  <span class='symbol'>:database</span><span class='comma'>,</span>
  <span class='symbol'>:heartbeat_frequency</span><span class='comma'>,</span>
  <span class='symbol'>:id_generator</span><span class='comma'>,</span>
  <span class='symbol'>:local_threshold</span><span class='comma'>,</span>
  <span class='symbol'>:logger</span><span class='comma'>,</span>
  <span class='symbol'>:log_prefix</span><span class='comma'>,</span>
  <span class='symbol'>:max_idle_time</span><span class='comma'>,</span>
  <span class='symbol'>:max_pool_size</span><span class='comma'>,</span>
  <span class='symbol'>:max_read_retries</span><span class='comma'>,</span>
  <span class='symbol'>:max_write_retries</span><span class='comma'>,</span>
  <span class='symbol'>:min_pool_size</span><span class='comma'>,</span>
  <span class='symbol'>:monitoring</span><span class='comma'>,</span>
  <span class='symbol'>:monitoring_io</span><span class='comma'>,</span>
  <span class='symbol'>:password</span><span class='comma'>,</span>
  <span class='symbol'>:platform</span><span class='comma'>,</span>
  <span class='symbol'>:read</span><span class='comma'>,</span>
  <span class='symbol'>:read_concern</span><span class='comma'>,</span>
  <span class='symbol'>:read_retry_interval</span><span class='comma'>,</span>
  <span class='symbol'>:replica_set</span><span class='comma'>,</span>
  <span class='symbol'>:resolv_options</span><span class='comma'>,</span>
  <span class='symbol'>:retry_reads</span><span class='comma'>,</span>
  <span class='symbol'>:retry_writes</span><span class='comma'>,</span>
  <span class='symbol'>:scan</span><span class='comma'>,</span>
  <span class='symbol'>:sdam_proc</span><span class='comma'>,</span>
  <span class='symbol'>:server_selection_timeout</span><span class='comma'>,</span>
  <span class='symbol'>:socket_timeout</span><span class='comma'>,</span>
  <span class='symbol'>:ssl</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_ca_cert</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_ca_cert_object</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_ca_cert_string</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_cert</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_cert_object</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_cert_string</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_key</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_key_object</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_key_pass_phrase</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_key_string</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_verify</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_verify_certificate</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_verify_hostname</span><span class='comma'>,</span>
  <span class='symbol'>:ssl_verify_ocsp_endpoint</span><span class='comma'>,</span>
  <span class='symbol'>:truncate_logs</span><span class='comma'>,</span>
  <span class='symbol'>:user</span><span class='comma'>,</span>
  <span class='symbol'>:wait_queue_timeout</span><span class='comma'>,</span>
  <span class='symbol'>:wrapping_libraries</span><span class='comma'>,</span>
  <span class='symbol'>:write</span><span class='comma'>,</span>
  <span class='symbol'>:write_concern</span><span class='comma'>,</span>
  <span class='symbol'>:zlib_compression_level</span><span class='comma'>,</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="VALID_COMPRESSORS-constant" class="">VALID_COMPRESSORS =
          <div class="docstring">
  <div class="discussion">
    
<p>The compression algorithms supported by the driver.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span> <span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Protocol/Compressed.html" title="Mongo::Protocol::Compressed (class)">Compressed</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Protocol/Compressed.html#ZLIB-constant" title="Mongo::Protocol::Compressed::ZLIB (constant)">ZLIB</a></span></span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">Loggable::PREFIX</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#cluster-instance_method" title="#cluster (instance method)">#<strong>cluster</strong>  &#x21d2; Mongo::Cluster </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Cluster The cluster of servers for the client.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#database-instance_method" title="#database (instance method)">#<strong>database</strong>  &#x21d2; Mongo::Database </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Database The database the client is operating on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#encrypter-instance_method" title="#encrypter (instance method)">#<strong>encrypter</strong>  &#x21d2; Mongo::Crypt::AutoEncrypter </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The object that encapsulates auto-encryption behavior.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Options The configuration options.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; true, false </a>
    

    
      (also: #eql?)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine if this client is equivalent to another object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(collection_name, options = {})  &#x21d2; Mongo::Collection </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a collection object for the provided collection name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Close all connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close_encrypter-instance_method" title="#close_encrypter (instance method)">#<strong>close_encrypter</strong>  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Close encrypter and clean up auto-encryption resources.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cluster_options-instance_method" title="#cluster_options (instance method)">#<strong>cluster_options</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#database_names-instance_method" title="#database_names (instance method)">#<strong>database_names</strong>(filter = {}, opts = {})  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the names of all databases.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_session-instance_method" title="#get_session (instance method)">#<strong>get_session</strong>(options = {})  &#x21d2; Session | nil </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a session to use for operations if possible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hash-instance_method" title="#hash (instance method)">#<strong>hash</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the hash value of the client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(addresses_or_uri, options = nil)  &#x21d2; Client </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Instantiate a new driver client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get an inspection of the client as a string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list_databases-instance_method" title="#list_databases (instance method)">#<strong>list_databases</strong>(filter = {}, name_only = false, opts = {})  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get info for each database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list_mongo_databases-instance_method" title="#list_mongo_databases (instance method)">#<strong>list_mongo_databases</strong>(filter = {}, opts = {})  &#x21d2; Array&lt;Mongo::Database&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a list of Mongo::Database objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_read_retries-instance_method" title="#max_read_retries (instance method)">#<strong>max_read_retries</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_write_retries-instance_method" title="#max_write_retries (instance method)">#<strong>max_write_retries</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Get the maximum number of times the client can retry a write operation when using legacy write retries.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_concern-instance_method" title="#read_concern (instance method)">#<strong>read_concern</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the read concern for this client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_preference-instance_method" title="#read_preference (instance method)">#<strong>read_preference</strong>  &#x21d2; BSON::Document </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the read preference from the options passed to the client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_retry_interval-instance_method" title="#read_retry_interval (instance method)">#<strong>read_retry_interval</strong>  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Get the interval, in seconds, in which read retries when using legacy read retries.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reconnect-instance_method" title="#reconnect (instance method)">#<strong>reconnect</strong>  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reconnect the client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#server_selector-instance_method" title="#server_selector (instance method)">#<strong>server_selector</strong>  &#x21d2; Mongo::ServerSelector </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the server selector.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start_session-instance_method" title="#start_session (instance method)">#<strong>start_session</strong>(options = {})  &#x21d2; Session </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start a session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a summary of the client state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_options-instance_method" title="#update_options (instance method)">#<strong>update_options</strong>(new_options)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Updates this client&#39;s options from new_options, validating all options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use-instance_method" title="#use (instance method)">#<strong>use</strong>(name)  &#x21d2; Mongo::Client </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new client configured to use the database with the provided name, and using the other options configured in this client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#watch-instance_method" title="#watch (instance method)">#<strong>watch</strong>(pipeline = [], options = {})  &#x21d2; ChangeStream </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>As of version 3.6 of the MongoDB server, a “$changeStream“ pipeline stage is supported in the aggregation framework.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(new_options = Options::Redacted.new)  &#x21d2; Mongo::Client </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new client with the passed options merged over the existing options of this client.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_session-instance_method" title="#with_session (instance method)">#<strong>with_session</strong>(options = {}, &amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a session to use for operations if possible and yields it to the provided block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_concern-instance_method" title="#write_concern (instance method)">#<strong>write_concern</strong>  &#x21d2; Mongo::WriteConcern </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the write concern for this client.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></span>, <span class='object_link'><a href="Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></span>, <span class='object_link'><a href="Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></span>, <span class='object_link'><a href="Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></span>, <span class='object_link'><a href="Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(addresses_or_uri, options = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Client (class)">Client</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Instantiate a new driver client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Instantiate a single server or mongos client.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Mongo::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Instantiate a client for a replica set.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Mongo::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27021</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Directly connect to a mongod in a replica set</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Mongo::Client (class)">Client</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:connect</span> <span class='op'>=&gt;</span> <span class='symbol'>:direct</span><span class='rparen'>)</span>
<span class='comment'># without `:connect =&gt; :direct`, Mongo::Client will discover and
</span><span class='comment'># connect to the replica set if given the address of a server in
</span><span class='comment'># a replica set</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>addresses_or_uri</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt; | String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The array of server addresses in the form of host:port or a MongoDB URI connection string.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options to be used by the client. If a MongoDB URI connection string is also provided, these options take precedence over any analogous options present in the URI string.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:app_name</span>
          <span class="type">(<tt>String</tt>, <tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Application name that is printed to the mongod logs upon establishing a connection in server versions &gt;= 3.4.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:auth_mech</span>
          <span class="type">(<tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The authentication mechanism to use. One of :mongodb_cr, :mongodb_x509, :plain, :scram, :scram256</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:auth_mech_properties</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
        <li>
          <span class="name">:auth_source</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The source to authenticate from.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bg_error_backtrace</span>
          <span class="type">(<tt>true | false | nil | Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Experimental. Set to true to log complete backtraces for errors in background threads. Set to false or nil to not log backtraces. Provide a positive integer to log up to that many backtrace lines.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:compressors</span>
          <span class="type">(<tt>Array&lt;String&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A list of potential compressors to use, in order of preference. The driver chooses the first compressor that is also supported by the server. Currently the driver only supports &#39;zlib&#39;.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:direct_connection</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to connect directly to the specified seed, bypassing topology discovery. Exactly one seed must be provided.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:connect</span>
          <span class="type">(<tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated - use :direct_connection option instead of this option. The connection method to use. This forces the cluster to behave in the specified way instead of auto-discovering. One of :direct, :replica_set, :sharded</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:connect_timeout</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The timeout, in seconds, to attempt a connection.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:database</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The database to connect to.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:heartbeat_frequency</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The interval, in seconds, for the server monitor to refresh its description via ismaster.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:id_generator</span>
          <span class="type">(<tt>Object</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A custom object to generate ids for documents. Must respond to #generate.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:local_threshold</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The local threshold boundary in seconds for selecting a near server for an operation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:logger</span>
          <span class="type">(<tt><span class='object_link'><a href="Logger.html" title="Mongo::Logger (class)">Logger</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A custom logger to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:log_prefix</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A custom log prefix to use when logging. This option is experimental and subject to change in a future version of the driver.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_idle_time</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum seconds a socket can remain idle since it has been checked in to the pool.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_pool_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum size of the connection pool.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_read_retries</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum number of read retries when legacy read retries are in use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_write_retries</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum number of write retries when legacy write retries are in use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:min_pool_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The minimum size of the connection pool.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:monitoring</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>If false is given, the client is initialized without global SDAM event subscribers and will not publish SDAM events. Command monitoring and legacy events will still be published, and the driver will still perform SDAM and monitor its cluster in order to perform server selection. Built-in driver logging of SDAM events will be disabled because it is implemented through SDAM event subscription. Client#subscribe will succeed for all event types, but subscribers to SDAM events will not be invoked. Values other than false result in default behavior which is to perform normal SDAM event publication.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:monitoring_io</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent SDAM-related I/O from being done by this client or servers under it. Note: setting this option to false will make the client non-functional. It is intended for use in tests which manually invoke SDAM state transitions.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cleanup</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent endSessions command being sent to the server to clean up server sessions when the cluster is disconnected, and to to not start the periodic executor. If :monitoring_io is false, :cleanup automatically defaults to false as well.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:password</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The user&#39;s password.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:platform</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Platform information to include in the metadata printed to the mongod logs upon establishing a connection in server versions &gt;= 3.4.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:read</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The read preference options. The hash may have the following items:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>
          
        </li>
      
        <li>
          <span class="name">:read_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The read concern option.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:read_retry_interval</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The interval, in seconds, in which reads on a mongos are retried.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:replica_set</span>
          <span class="type">(<tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The name of the replica set to connect to. Servers not in this replica set will be ignored.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:retry_reads</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>If true, modern retryable reads are enabled (which is the default). If false, modern retryable reads are disabled and legacy retryable reads are enabled.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:retry_writes</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Retry writes once when connected to a replica set or sharded cluster versions 3.6 and up. (Default is true.)</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:scan</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to scan all seeds in constructor. The default in driver version 2.x is to do so; driver version 3.x will not scan seeds in constructor. Opt in to the new behavior by setting this option to false. <strong>Note:</strong> setting this option to nil enables scanning seeds in constructor in driver version 2.x. Driver version 3.x will recognize this option but will ignore it and will never scan seeds in the constructor.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:sdam_proc</span>
          <span class="type">(<tt>Proc</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A Proc to invoke with the client as the argument prior to performing server discovery and monitoring. Use this to set up SDAM event listeners to receive events published during client construction.</p>

<p>Note: the client is not fully constructed when sdam_proc is invoked, in particular the cluster is nil at this time. sdam_proc should limit itself to calling #subscribe and #unsubscribe methods on the client only.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:server_selection_timeout</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The timeout in seconds for selecting a server for an operation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:socket_timeout</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The timeout, in seconds, to execute operations on a socket.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to use TLS.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_ca_cert</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The file containing concatenated certificate authority certificates used to validate certs passed from the other end of the connection. Intermediate certificates should NOT be specified in files referenced by this option. One of :ssl_ca_cert, :ssl_ca_cert_string or :ssl_ca_cert_object (in order of priority) is required when using :ssl_verify.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_ca_cert_object</span>
          <span class="type">(<tt>Array&lt;OpenSSL::X509::Certificate&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>An array of OpenSSL::X509::Certificate objects representing the certificate authority certificates used to validate certs passed from the other end of the connection. Intermediate certificates should NOT be specified in files referenced by this option. One of :ssl_ca_cert, :ssl_ca_cert_string or :ssl_ca_cert_object (in order of priority) is required when using :ssl_verify.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_ca_cert_string</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A string containing certificate authority certificate used to validate certs passed from the other end of the connection. This option allows passing only one CA certificate to the driver. Intermediate certificates should NOT be specified in files referenced by this option. One of :ssl_ca_cert, :ssl_ca_cert_string or :ssl_ca_cert_object (in order of priority) is required when using :ssl_verify.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_cert</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The certificate file used to identify the connection against MongoDB. A certificate chain may be passed by specifying the client certificate first followed by any intermediate certificates up to the CA certificate. The file may also contain the certificate&#39;s private key, which will be ignored. This option, if present, takes precedence over the values of :ssl_cert_string and :ssl_cert_object</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_cert_object</span>
          <span class="type">(<tt>OpenSSL::X509::Certificate</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The OpenSSL::X509::Certificate used to identify the connection against MongoDB. Only one certificate may be passed through this option.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_cert_string</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A string containing the PEM-encoded certificate used to identify the connection against MongoDB. A certificate chain may be passed by specifying the client certificate first followed by any intermediate certificates up to the CA certificate. The string may also contain the certificate&#39;s private key, which will be ignored, This option, if present, takes precedence over the value of :ssl_cert_object</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_key</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The private keyfile used to identify the connection against MongoDB. Note that even if the key is stored in the same file as the certificate, both need to be explicitly specified. This option, if present, takes precedence over the values of :ssl_key_string and :ssl_key_object</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_key_object</span>
          <span class="type">(<tt>OpenSSL::PKey</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The private key used to identify the connection against MongoDB</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_key_pass_phrase</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A passphrase for the private key.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_key_string</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A string containing the PEM-encoded private key used to identify the connection against MongoDB. This parameter, if present, takes precedence over the value of option :ssl_key_object</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_verify</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to perform peer certificate validation and hostname verification. Note that the decision of whether to validate certificates will be overridden if :ssl_verify_certificate is set, and the decision of whether to validate hostnames will be overridden if :ssl_verify_hostname is set.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_verify_certificate</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to perform peer certificate validation. This setting overrides :ssl_verify with respect to whether certificate validation is performed.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ssl_verify_hostname</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to perform peer hostname validation. This setting overrides :ssl_verify with respect to whether hostname validation is performed.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:truncate_logs</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to truncate the logs at the default 250 characters.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:user</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The user name.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:wait_queue_timeout</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The time to wait, in seconds, in the connection pool for a connection to be checked in.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:wrapping_libraries</span>
          <span class="type">(<tt>Array&lt;Hash&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Information about libraries such as ODMs that are wrapping the driver, to be added to</p>

<pre class="code ruby"><code class="ruby">metadata sent to the server. Specify the lower level libraries first.
Allowed hash keys: :name, :version, :platform.
</code></pre>
</div>
          
        </li>
      
        <li>
          <span class="name">:write</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated. Equivalent to :write_concern option.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer|String, :wtimeout =&gt; Integer (in milliseconds), :j =&gt; Boolean, :fsync =&gt; Boolean.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:zlib_compression_level</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The Zlib compression level to use, if using compression. See Ruby&#39;s Zlib module for valid levels.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:resolv_options</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Options to pass through to Resolv::DNS constructor for SRV lookups.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:auto_encryption_options</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Auto-encryption related options.</p>
<ul><li>
<p>:key_vault_client =&gt; Client | nil, a client connected to the MongoDB instance containing the encryption key vault</p>
</li><li>
<p>:key_vault_namespace =&gt; String, the namespace of the key vault in the format database.collection</p>
</li><li>
<p>:kms_providers =&gt; Hash, A hash of key management service configuration information. Valid hash keys are :local or :aws. There may be more than one kms provider specified.</p>
</li><li>
<p>:schema_map =&gt; Hash | nil, JSONSchema for one or more collections specifying which fields should be encrypted.</p>
<ul><li>
<p>Note: Schemas supplied in the schema_map only apply to configuring automatic encryption for client side encryption. Other validation rules in the JSON schema will not be enforced by the driver and will result in an error.</p>
</li><li>
<p>Note: Supplying a schema_map provides more security than relying on JSON Schemas obtained from the server. It protects against a malicious server advertising a false JSON Schema, which could trick the client into sending unencrypted data that should be encrypted.</p>
</li></ul>
</li><li>
<p>:bypass_auto_encryption =&gt; Boolean, when true, disables auto encryption; defaults to false.</p>
</li><li>
<p>:extra_options =&gt; Hash | nil, options related to spawning mongocryptd (this part of the API is subject to change).</p>
</li></ul>

<p>Notes on automatic encryption:</p>
<ul><li>
<p>Automatic encryption is an enterprise only feature that only applies to operations on a collection.</p>
</li><li>
<p>Automatic encryption is not supported for operations on a database or view.</p>
</li><li>
<p>Automatic encryption requires the authenticated user to have the listCollections privilege.</p>
</li><li>
<p>At worst, automatic encryption may triple the number of connections used by the Client at any one time.</p>
</li><li>
<p>If automatic encryption fails on an operation, use a MongoClient configured with bypass_auto_encryption: true and use ClientEncryption.encrypt to manually encrypt values.</p>
</li><li>
<p>Enabling Client Side Encryption reduces the maximum write batch size and may have a negative performance impact.</p>
</li></ul>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 433</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='op'>::</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="URI.html" title="Mongo::URI (class)">URI</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="URI.html#get-class_method" title="Mongo::URI.get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="URI.html" title="Mongo::URI (class)">URI</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="URI/SRVProtocol.html" title="Mongo::URI::SRVProtocol (class)">SRVProtocol</a></span></span><span class='rparen'>)</span>
      <span class='comment'># If the URI is an SRV URI, note this so that we can start
</span>      <span class='comment'># SRV polling if the topology is a sharded cluster.
</span>      <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_servers'>servers</span>
    <span class='id identifier rubyid_uri_options'>uri_options</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_client_options'>client_options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='comment'># Special handing for :write and :write_concern: allow client Ruby
</span>    <span class='comment'># options to override URI options, even when the Ruby option uses the
</span>    <span class='comment'># deprecated :write key and the URI option uses the current
</span>    <span class='comment'># :write_concern key
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_uri_options'>uri_options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:write_concern</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_uri_options'>uri_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@srv_records</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_srv_records'>srv_records</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span>
    <span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_addr'>addr</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Amongodb(\+srv)?:\/\/</span><span class='regexp_end'>/i</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; should not contain protocol. Did you mean to not use an array?</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='ivar'>@srv_records</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Options.html" title="Mongo::Options (module)">Options</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_k'>k</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auth_mech_properties</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='id identifier rubyid_pv'>pv</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_pk'>pk</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='id identifier rubyid_pv'>pv</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='rbracket'>]</span>
  <span class='kw'>end</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># Special handling for sdam_proc as it is only used during client
</span>  <span class='comment'># construction
</span>  <span class='id identifier rubyid_sdam_proc'>sdam_proc</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:sdam_proc</span><span class='rparen'>)</span>

  <span class='comment'># For gssapi service_name, the default option is given in a hash
</span>  <span class='comment'># (one level down from the top level).
</span>  <span class='id identifier rubyid_merged_options'>merged_options</span> <span class='op'>=</span> <span class='id identifier rubyid_default_options'>default_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_default_v'>default_v</span> <span class='op'>=</span> <span class='id identifier rubyid_merged_options'>merged_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_default_v'>default_v</span>
      <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_default_v'>default_v</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_merged_options'>merged_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_merged_options'>merged_options</span>

  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_new_options!'>validate_new_options!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='embdoc_beg'>=begin WriteConcern object support
</span><span class='embdoc'>  if @options[:write_concern].is_a?(WriteConcern::Base)
</span><span class='embdoc'>    # Cache the instance so that we do not needlessly reconstruct it.
</span><span class='embdoc'>    @write_concern = @options[:write_concern]
</span><span class='embdoc'>    @options[:write_concern] = @write_concern.options
</span><span class='embdoc'>  end
</span><span class='embdoc_end'>=end
</span>  <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='id identifier rubyid_validate_options!'>validate_options!</span><span class='lparen'>(</span><span class='id identifier rubyid_addresses'>addresses</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_validate_authentication_options!'>validate_authentication_options!</span>

  <span class='ivar'>@database</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Database.html#initialize-instance_method" title="Mongo::Database#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:database</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@options</span><span class='rparen'>)</span>

  <span class='comment'># Temporarily set monitoring so that event subscriptions can be
</span>  <span class='comment'># set up without there being a cluster
</span>  <span class='ivar'>@monitoring</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring.html#initialize-instance_method" title="Mongo::Monitoring#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@options</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_sdam_proc'>sdam_proc</span>
    <span class='id identifier rubyid_sdam_proc'>sdam_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@connect_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@cluster</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster.html#initialize-instance_method" title="Mongo::Cluster#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='ivar'>@monitoring</span><span class='comma'>,</span>
      <span class='id identifier rubyid_cluster_options'>cluster_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>srv_uri:</span> <span class='id identifier rubyid_srv_uri'>srv_uri</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='comment'># Unset monitoring, it will be taken out of cluster from now on
</span>    <span class='id identifier rubyid_remove_instance_variable'>remove_instance_variable</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@monitoring</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span>
      <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_build_encrypter'>build_encrypter</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>rescue</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@cluster</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_log_warn'>log_warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eror disconnecting cluster in client constructor&#39;s exception handler: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='comment'># Drop this exception so that the original exception is raised
</span>    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="cluster-instance_method">
  
    #<strong>cluster</strong>  &#x21d2; <tt><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Mongo::Cluster</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns cluster The cluster of servers for the client.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Mongo::Cluster</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>cluster The cluster of servers for the client.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 120</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cluster'>cluster</span>
  <span class='ivar'>@cluster</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="database-instance_method">
  
    #<strong>database</strong>  &#x21d2; <tt><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns database The database the client is operating on.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>database The database the client is operating on.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_database'>database</span>
  <span class='ivar'>@database</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="encrypter-instance_method">
  
    #<strong>encrypter</strong>  &#x21d2; <tt><span class='object_link'><a href="Crypt/AutoEncrypter.html" title="Mongo::Crypt::AutoEncrypter (class)">Mongo::Crypt::AutoEncrypter</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The object that encapsulates auto-encryption behavior.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Crypt/AutoEncrypter.html" title="Mongo::Crypt::AutoEncrypter (class)">Mongo::Crypt::AutoEncrypter</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The object that encapsulates auto-encryption behavior</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypter'>encrypter</span>
  <span class='ivar'>@encrypter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="options-instance_method">
  
    #<strong>options</strong>  &#x21d2; <tt>Hash</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns options The configuration options.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>options The configuration options.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_options'>options</span>
  <span class='ivar'>@options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="==-instance_method">
  
    #<strong>==</strong>(other)  &#x21d2; <tt>true</tt>, <tt>false</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='eql?-instance_method'>eql?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine if this client is equivalent to another object.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Check client equality.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>other</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The object to compare to.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the objects are equal.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 159</span>

<span class='kw'>def</span> <span class='op'>==</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="" title="Mongo::Client (class)">Client</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="[]-instance_method">
  
    #<strong>[]</strong>(collection_name, options = {})  &#x21d2; <tt><span class='object_link'><a href="Collection.html" title="Mongo::Collection (class)">Mongo::Collection</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a collection object for the provided collection name.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the collection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='lbracket'>[</span><span class='symbol'>:users</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>collection_name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the collection.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options to the collection.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Collection.html" title="Mongo::Collection (class)">Mongo::Collection</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The collection.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 176</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_collection_name'>collection_name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_database'>database</span><span class='lbracket'>[</span><span class='id identifier rubyid_collection_name'>collection_name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-instance_method">
  
    #<strong>close</strong>  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Close all connections.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


796
797
798
799
800
801</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 796</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_do_close'>do_close</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close_encrypter-instance_method">
  
    #<strong>close_encrypter</strong>  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Close encrypter and clean up auto-encryption resources.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


806
807
808
809
810</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 806</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_encrypter'>close_encrypter</span>
  <span class='ivar'>@encrypter</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='ivar'>@encrypter</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cluster_options-instance_method">
  
    #<strong>cluster_options</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 547</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cluster_options'>cluster_options</span>
  <span class='comment'># We share clusters when a new client with different CRUD_OPTIONS
</span>  <span class='comment'># is requested; therefore, cluster should not be getting any of these
</span>  <span class='comment'># options upon instantiation
</span>  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="#CRUD_OPTIONS-constant" title="Mongo::Client::CRUD_OPTIONS (constant)">CRUD_OPTIONS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span>
    <span class='comment'># but need to put the database back in for auth...
</span>    <span class='label'>database:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:database</span><span class='rbracket'>]</span><span class='comma'>,</span>

    <span class='comment'># Put these options in for legacy compatibility, but note that
</span>    <span class='comment'># their values on the client and the cluster do not have to match -
</span>    <span class='comment'># applications should read these values from client, not from cluster
</span>    <span class='label'>max_read_retries:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_read_retries</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>read_retry_interval:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read_retry_interval</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_options'>options</span><span class='op'>|</span>
    <span class='comment'># If the client has a cluster already, forward srv_uri to the new
</span>    <span class='comment'># cluster to maintain SRV monitoring. If the client is brand new,
</span>    <span class='comment'># its constructor sets srv_uri manually.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cluster'>cluster</span>
      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>srv_uri:</span> <span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:srv_uri</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="database_names-instance_method">
  
    #<strong>database_names</strong>(filter = {}, opts = {})  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the names of all databases.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the database names.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_database_names'>database_names</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filter</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The command options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:authorized_databases</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A flag that determines which databases are returned based on user privileges when access control is enabled</p>

<p>See <a href="https://docs.mongodb.com/manual/reference/command/listDatabases">docs.mongodb.com/manual/reference/command/listDatabases</a>/ for more information and usage.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The names of the databases.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.5</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


854
855
856</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 854</span>

<span class='kw'>def</span> <span class='id identifier rubyid_database_names'>database_names</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_list_databases'>list_databases</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span> <span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_session-instance_method">
  
    #<strong>get_session</strong>(options = {})  &#x21d2; <tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span> | nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Returns a session to use for operations if possible.</p>

<p>If :session option is set, validates that session and returns it. Otherwise, if deployment supports sessions, creates a new session and returns it. When a new session is created, the session will be implicit (lifecycle is managed by the driver) if the :implicit option is given, otherwise the session will be explicit (lifecycle managed by the application). If deployment does not support session, returns nil.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:implicit</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>When no session is passed in, whether to create an implicit session.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to validate and return.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span> | nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Session object or nil if sessions are not supported by the deployment.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


994
995
996
997
998</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 994</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_session'>get_session</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_get_session!'>get_session!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Error/SessionsNotSupported.html" title="Mongo::Error::SessionsNotSupported (class)">SessionsNotSupported</a></span></span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hash-instance_method">
  
    #<strong>hash</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the hash value of the client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the client hash value.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The client hash value.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_hash'>hash</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_cluster'>cluster</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get an inspection of the client as a string.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Inspect the client.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The inspection string.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


610
611
612</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 610</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Client:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> cluster=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list_databases-instance_method">
  
    #<strong>list_databases</strong>(filter = {}, name_only = false, opts = {})  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get info for each database.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the info for each database.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_list_databases'>list_databases</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filter</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>name_only</span>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Whether to only return each database name without full metadata.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The command options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:authorized_databases</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A flag that determines which databases are returned based on user privileges when access control is enabled</p>

<p>See <a href="https://docs.mongodb.com/manual/reference/command/listDatabases">docs.mongodb.com/manual/reference/command/listDatabases</a>/ for more information and usage.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The info for each database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.5</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


877
878
879
880
881
882
883</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 877</span>

<span class='kw'>def</span> <span class='id identifier rubyid_list_databases'>list_databases</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_name_only'>name_only</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>listDatabases:</span> <span class='int'>1</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:nameOnly</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_name_only'>name_only</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:filter</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_filter'>filter</span> <span class='kw'>unless</span> <span class='id identifier rubyid_filter'>filter</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:authorizedDatabases</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:authorized_databases</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_read_command'>read_command</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Database.html#DATABASES-constant" title="Mongo::Database::DATABASES (constant)">DATABASES</a></span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list_mongo_databases-instance_method">
  
    #<strong>list_mongo_databases</strong>(filter = {}, opts = {})  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a list of Mongo::Database objects.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get a list of Mongo::Database objects.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_list_mongo_databases'>list_mongo_databases</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>filter</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The command options.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The list of database objects.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


896
897
898
899
900</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 896</span>

<span class='kw'>def</span> <span class='id identifier rubyid_list_mongo_databases'>list_mongo_databases</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_database_names'>database_names</span><span class='lparen'>(</span><span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Database.html#initialize-instance_method" title="Mongo::Database#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_read_retries-instance_method">
  
    #<strong>max_read_retries</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The maximum number of retries.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


578
579
580</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 578</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_read_retries'>max_read_retries</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_read_retries</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cluster.html#MAX_READ_RETRIES-constant" title="Mongo::Cluster::MAX_READ_RETRIES (constant)">MAX_READ_RETRIES</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_write_retries-instance_method">
  
    #<strong>max_write_retries</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Get the maximum number of times the client can retry a write operation when using legacy write retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The maximum number of retries.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


598
599
600</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 598</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_write_retries'>max_write_retries</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_write_retries</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cluster.html#MAX_WRITE_RETRIES-constant" title="Mongo::Cluster::MAX_WRITE_RETRIES (constant)">MAX_WRITE_RETRIES</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_concern-instance_method">
  
    #<strong>read_concern</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the read concern for this client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the client read concern.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_read_concern'>read_concern</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The read concern.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.6.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


773
774
775</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 773</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_concern'>read_concern</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read_concern</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_preference-instance_method">
  
    #<strong>read_preference</strong>  &#x21d2; <tt>BSON::Document</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the read preference from the options passed to the client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the read preference.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_read_preference'>read_preference</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>BSON::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user-defined read preference. The document may have the following fields:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


658
659
660</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 658</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_preference'>read_preference</span>
  <span class='ivar'>@read_preference</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_retry_interval-instance_method">
  
    #<strong>read_retry_interval</strong>  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Get the interval, in seconds, in which read retries when using legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The interval.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


588
589
590</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 588</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read_retry_interval</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cluster.html#READ_RETRY_INTERVAL-constant" title="Mongo::Cluster::READ_RETRY_INTERVAL (constant)">READ_RETRY_INTERVAL</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconnect-instance_method">
  
    #<strong>reconnect</strong>  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reconnect the client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Reconnect the client.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_reconnect'>reconnect</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


820
821
822
823
824
825
826
827
828
829
830
831
832
833
834</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 820</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reconnect'>reconnect</span>
  <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>

  <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_do_close'>do_close</span> <span class='kw'>rescue</span> <span class='kw'>nil</span>

    <span class='ivar'>@cluster</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster.html#initialize-instance_method" title="Mongo::Cluster#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_cluster_options'>cluster_options</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_build_encrypter'>build_encrypter</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="server_selector-instance_method">
  
    #<strong>server_selector</strong>  &#x21d2; <tt><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">Mongo::ServerSelector</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the server selector. It either uses the read preference defined in the client options or defaults to a Primary server selector.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the server selector.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_server_selector'>server_selector</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">Mongo::ServerSelector</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server selector using the user-defined read preference or a Primary server selector default.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


636
637
638
639
640
641
642</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 636</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server_selector'>server_selector</span>
  <span class='ivar'>@server_selector</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid_read_preference'>read_preference</span>
    <span class='const'><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="ServerSelector.html#get-instance_method" title="Mongo::ServerSelector#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_read_preference'>read_preference</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></span><span class='period'>.</span><span class='id identifier rubyid_primary'><span class='object_link'><a href="ServerSelector.html#primary-instance_method" title="Mongo::ServerSelector#primary (method)">primary</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start_session-instance_method">
  
    #<strong>start_session</strong>(options = {})  &#x21d2; <tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>A Session cannot be used by multiple threads at once; session objects are not thread-safe.</p>
</div>
  </div>


<p>Start a session.</p>

<p>If the deployment does not support sessions, raises Mongo::Error::InvalidSession. This exception can also be raised when the driver is not connected to a data-bearing server, for example during failover.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Start a session.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_start_session'>start_session</span><span class='lparen'>(</span><span class='label'>causal_consistency:</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The session options. Accepts the options that Session#initialize accepts.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The session.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


921
922
923
924
925
926
927
928
929
930
931
932</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 921</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start_session'>start_session</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_get_session!'>get_session!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>implicit:</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_session'>session</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_end_session'>end_session</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_session'>session</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="summary-instance_method">
  
    #<strong>summary</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The exact format and layout of the returned summary string is not part of the driver&#39;s public API and may be changed at any time.</p>
</div>
  </div>


<p>Get a summary of the client state.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The summary string.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.7.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


622
623
624</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 622</span>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Client cluster=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_options-instance_method">
  
    #<strong>update_options</strong>(new_options)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Updates this client&#39;s options from new_options, validating all options.</p>

<p>The new options may be transformed according to various rules. The final hash of options actually applied to the client is returned.</p>

<p>If options fail validation, this method may warn or raise an exception. If this method raises an exception, the client should be discarded (similarly to if a constructor raised an exception).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>new_options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The new options to use.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Modified new options written into the client.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 725</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_options'>update_options</span><span class='lparen'>(</span><span class='id identifier rubyid_new_options'>new_options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_old_options'>old_options</span> <span class='op'>=</span> <span class='ivar'>@options</span>

  <span class='id identifier rubyid_validate_new_options!'>validate_new_options!</span><span class='lparen'>(</span><span class='id identifier rubyid_new_options'>new_options</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_opts'>opts</span><span class='op'>|</span>
    <span class='comment'># Our options are frozen
</span>    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:write</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:write_concern</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

    <span class='id identifier rubyid_auto_encryption_options_changed'>auto_encryption_options_changed</span> <span class='op'>=</span>
      <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_old_options'>old_options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span>

    <span class='comment'># If there are new auto_encryption_options, create a new encrypter.
</span>    <span class='comment'># Otherwise, allow the new client to share an encrypter with the
</span>    <span class='comment'># original client.
</span>    <span class='comment'>#
</span>    <span class='comment'># If auto_encryption_options are nil, set @encrypter to nil, but do not
</span>    <span class='comment'># close the encrypter because it may still be used by the original client.
</span>    <span class='kw'>if</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_auto_encryption_options_changed'>auto_encryption_options_changed</span>
      <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_build_encrypter'>build_encrypter</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:auto_encryption_options</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@connect_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='ivar'>@encrypter</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_validate_options!'>validate_options!</span>
    <span class='id identifier rubyid_validate_authentication_options!'>validate_authentication_options!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="use-instance_method">
  
    #<strong>use</strong>(name)  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Client (class)">Mongo::Client</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The new client shares the cluster with the original client, and as a result also shares the monitoring instance and monitoring event subscribers.</p>
</div>
  </div>


<p>Creates a new client configured to use the database with the provided name, and using the other options configured in this client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Create a client for the `users&#39; database.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='symbol'>:users</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the database to use.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Mongo::Client (class)">Mongo::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new client instance.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


677
678
679</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 677</span>

<span class='kw'>def</span> <span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='label'>database:</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="watch-instance_method">
  
    #<strong>watch</strong>(pipeline = [], options = {})  &#x21d2; <tt>ChangeStream</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>A change stream only allows &#39;majority&#39; read concern.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This helper method is preferable to running a raw aggregation with a $changeStream stage, for the purpose of supporting resumability.</p>
</div>
  </div>


<p>As of version 3.6 of the MongoDB server, a “$changeStream“ pipeline stage is supported in the aggregation framework. As of version 4.0, this stage allows users to request that notifications are sent for all changes that occur in the client&#39;s cluster.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get change notifications for the client&#39;s cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_watch'>watch</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$match</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>operationType:</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$in</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>insert</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>replace</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pipeline</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Optional additional filter operators.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The change stream options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:full_document</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Allowed values: &#39;default&#39;, &#39;updateLookup&#39;. Defaults to &#39;default&#39;. When set to &#39;updateLookup&#39;, the change notification for partial updates will include both a delta describing the changes to the document, as well as a copy of the entire document that was changed from some time after the change occurred.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:resume_after</span>
          <span class="type">(<tt>BSON::Document</tt>, <tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Specifies the logical starting point for the new change stream.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_await_time_ms</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum amount of time for the server to wait on new documents to satisfy a change stream query.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:batch_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The number of documents to return per batch.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>BSON::Document</tt>, <tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:start_at_operation_time</span>
          <span class="type">(<tt>BSON::Timestamp</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Only return changes that occurred at or after the specified timestamp. Any command run against the server will return a cluster time that can be used here. Only recognized by server versions 4.0+.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ChangeStream</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The change stream object.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.6.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


967
968
969
970
971
972
973
974
975</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 967</span>

<span class='kw'>def</span> <span class='id identifier rubyid_watch'>watch</span><span class='lparen'>(</span><span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_watch'>watch</span><span class='lparen'>(</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span></span>

  <span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View/ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)">ChangeStream</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Database.html#COMMAND-constant" title="Mongo::Database::COMMAND (constant)">COMMAND</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>.aggregate</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='id identifier rubyid_pipeline'>pipeline</span><span class='comma'>,</span>
    <span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View/ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)">ChangeStream</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Collection/View/ChangeStream.html#CLUSTER-constant" title="Mongo::Collection::View::ChangeStream::CLUSTER (constant)">CLUSTER</a></span></span><span class='comma'>,</span>
    <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with-instance_method">
  
    #<strong>with</strong>(new_options = Options::Redacted.new)  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Client (class)">Mongo::Client</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Depending on options given, the returned client may share the cluster with the original client or be created with a new cluster. If a new cluster is created, the monitoring event subscribers on the new client are set to the default event subscriber set and none of the subscribers on the original client are copied over.</p>
</div>
  </div>


<p>Creates a new client with the passed options merged over the existing options of this client. Useful for one-offs to change specific options without altering the original client.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get a client with changed options.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='symbol'>:read</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:mode</span> <span class='op'>=&gt;</span> <span class='symbol'>:primary_preferred</span> <span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>new_options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Options::Redacted.new</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The new options to use.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Mongo::Client (class)">Mongo::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new client instance.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


699
700
701
702
703
704
705
706
707
708
709</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 699</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span><span class='lparen'>(</span><span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Options.html" title="Mongo::Options (module)">Options</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_clone'>clone</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_update_options'>update_options</span><span class='lparen'>(</span><span class='id identifier rubyid_new_options'>new_options</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="Database.html" title="Mongo::Database (class)">Database</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Database.html#create-class_method" title="Mongo::Database.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
    <span class='comment'># We can&#39;t use the same cluster if some options that would affect it
</span>    <span class='comment'># have changed.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cluster_modifying?'>cluster_modifying?</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Cluster.html#create-class_method" title="Mongo::Cluster.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_session-instance_method">
  
    #<strong>with_session</strong>(options = {}, &amp;block)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Creates a session to use for operations if possible and yields it to the provided block.</p>

<p>If :session option is set, validates that session and uses it. Otherwise, if deployment supports sessions, creates a new session and uses it. When a new session is created, the session will be implicit (lifecycle is managed by the driver) if the :implicit option is given, otherwise the session will be explicit (lifecycle managed by the application). If deployment does not support session, yields nil to the block.</p>

<p>When the block finishes, if the session was created and was implicit, or if an implicit session was passed in, the session is ended which returns it to the pool of available sessions.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:implicit</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>When no session is passed in, whether to create an implicit session.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to validate and return.</p>
</div>
          
        </li>
      
    </ul>
  
    
    

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1020
1021
1022
1023
1024
1025
1026
1027
1028</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 1020</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_get_session'>get_session</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='kw'>yield</span> <span class='id identifier rubyid_session'>session</span>
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_implicit?'>implicit?</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_end_session'>end_session</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_concern-instance_method">
  
    #<strong>write_concern</strong>  &#x21d2; <tt><span class='object_link'><a href="WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the write concern for this client. If no option was provided, then a default single server acknowledgement will be used.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the client write concern.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_write_concern'>write_concern</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The write concern.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


787
788
789</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/client.rb', line 787</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_concern'>write_concern</span>
  <span class='ivar'>@write_concern</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:write</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Oct  7 18:18:57 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>