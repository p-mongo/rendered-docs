<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Mongo::Collection::View::Writable
  
    &mdash; mongo-2.15.0.alpha
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::Collection::View::Writable";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (W)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Mongo.html" title="Mongo (module)">Mongo</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Collection.html" title="Mongo::Collection (class)">Collection</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../View.html" title="Mongo::Collection::View (class)">View</a></span></span>
     &raquo; 
    <span class="title">Writable</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Mongo::Collection::View::Writable
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../View.html" title="Mongo::Collection::View (class)">Mongo::Collection::View</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/collection/view/writable.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Defines write related behavior for collection view.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="ARRAY_FILTERS-constant" class="">ARRAY_FILTERS =
          <div class="docstring">
  <div class="discussion">
    
<p>The array filters field constant.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>array_filters</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_many-instance_method" title="#delete_many (instance method)">#<strong>delete_many</strong>(opts = {})  &#x21d2; Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove documents from the collection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_one-instance_method" title="#delete_one (instance method)">#<strong>delete_one</strong>(opts = {})  &#x21d2; Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove a document from the collection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_one_and_delete-instance_method" title="#find_one_and_delete (instance method)">#<strong>find_one_and_delete</strong>(opts = {})  &#x21d2; BSON::Document<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds a single document in the database via findAndModify and deletes it, returning the original document.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_one_and_replace-instance_method" title="#find_one_and_replace (instance method)">#<strong>find_one_and_replace</strong>(replacement, opts = {})  &#x21d2; BSON::Document </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds a single document and replaces it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_one_and_update-instance_method" title="#find_one_and_update (instance method)">#<strong>find_one_and_update</strong>(document, opts = {})  &#x21d2; BSON::Document </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finds a single document and updates it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace_one-instance_method" title="#replace_one (instance method)">#<strong>replace_one</strong>(replacement, opts = {})  &#x21d2; Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Replaces a single document in the database with the new document.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_many-instance_method" title="#update_many (instance method)">#<strong>update_many</strong>(spec, opts = {})  &#x21d2; Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update documents in the collection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_one-instance_method" title="#update_one (instance method)">#<strong>update_one</strong>(spec, opts = {})  &#x21d2; Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update a single document in the collection.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="delete_many-instance_method">
  
    #<strong>delete_many</strong>(opts = {})  &#x21d2; <tt>Result</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove documents from the collection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Remove multiple documents from the collection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_collection_view'>collection_view</span><span class='period'>.</span><span class='id identifier rubyid_delete_many'>delete_many</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer, :fsync =&gt; Boolean, :j =&gt; Boolean.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Result</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The response from the database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_many'>delete_many</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_delete_doc'>delete_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#Q-constant" title="Mongo::Operation::Q (constant)">Q</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#LIMIT-constant" title="Mongo::Operation::LIMIT (constant)">LIMIT</a></span></span> <span class='op'>=&gt;</span> <span class='int'>0</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_concern'>write_concern</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="../../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="../../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_write_concern_with_session'>write_concern_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_nro_write_with_retry'>nro_write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_delete_doc'>delete_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_delete_doc'>delete_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Delete.html" title="Mongo::Operation::Delete (class)">Delete</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:deletes</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_delete_doc'>delete_doc</span> <span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:coll_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:write_concern</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='comma'>,</span>
          <span class='symbol'>:bypass_document_validation</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_one-instance_method">
  
    #<strong>delete_one</strong>(opts = {})  &#x21d2; <tt>Result</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove a document from the collection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Remove a single document from the collection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_collection_view'>collection_view</span><span class='period'>.</span><span class='id identifier rubyid_delete_one'>delete_one</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer, :fsync =&gt; Boolean, :j =&gt; Boolean.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Result</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The response from the database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_one'>delete_one</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_delete_doc'>delete_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#Q-constant" title="Mongo::Operation::Q (constant)">Q</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#LIMIT-constant" title="Mongo::Operation::LIMIT (constant)">LIMIT</a></span></span> <span class='op'>=&gt;</span> <span class='int'>1</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_concern'>write_concern</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="../../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="../../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_write_concern_with_session'>write_concern_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_write_with_retry'>write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_delete_doc'>delete_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_delete_doc'>delete_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Delete.html" title="Mongo::Operation::Delete (class)">Delete</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:deletes</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_delete_doc'>delete_doc</span> <span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:coll_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:write_concern</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='comma'>,</span>
          <span class='symbol'>:bypass_document_validation</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
          <span class='symbol'>:txn_num</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_one_and_delete-instance_method">
  
    #<strong>find_one_and_delete</strong>(opts = {})  &#x21d2; <tt>BSON::Document</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds a single document in the database via findAndModify and deletes it, returning the original document.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Find one document and delete it.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_view'>view</span><span class='period'>.</span><span class='id identifier rubyid_find_one_and_delete'>find_one_and_delete</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:max_time_ms</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum amount of time to allow the command to run in milliseconds.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:projection</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The fields to include or exclude in the returned doc.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:sort</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The key and direction pairs by which the result set will be sorted.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>BSON::Document</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The document, if found.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_delete'>find_one_and_delete</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:findAndModify</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:query</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='symbol'>:remove</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:fields</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_projection'>projection</span> <span class='kw'>if</span> <span class='id identifier rubyid_projection'>projection</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_sort'>sort</span> <span class='kw'>if</span> <span class='id identifier rubyid_sort'>sort</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:maxTimeMS</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_max_time_ms'>max_time_ms</span> <span class='kw'>if</span> <span class='id identifier rubyid_max_time_ms'>max_time_ms</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:bypassDocumentValidation</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span> <span class='op'>=</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:writeConcern</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='kw'>if</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span>
    <span class='id identifier rubyid_write_with_retry'>write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Command.html" title="Mongo::Operation::Command (class)">Command</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:selector</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
          <span class='symbol'>:txn_num</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_one_and_replace-instance_method">
  
    #<strong>find_one_and_replace</strong>(replacement, opts = {})  &#x21d2; <tt>BSON::Document</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds a single document and replaces it.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Find a document and replace it, returning the original.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_view'>view</span><span class='period'>.</span><span class='id identifier rubyid_find_one_and_replace'>find_one_and_replace</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:return_document</span> <span class='op'>=&gt;</span> <span class='symbol'>:before</span><span class='rparen'>)</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Find a document and replace it, returning the new document.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_view'>view</span><span class='period'>.</span><span class='id identifier rubyid_find_one_and_replace'>find_one_and_replace</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:return_document</span> <span class='op'>=&gt;</span> <span class='symbol'>:after</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>replacement</span>
      
      
        <span class='type'>(<tt>BSON::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The replacement.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:return_document</span>
          <span class="type">(<tt><span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Either :before or :after.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:upsert</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to upsert if the document doesn&#39;t exist.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bypass_document_validation</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether or not to skip document level validation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>BSON::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The document.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_replace'>find_one_and_replace</span><span class='lparen'>(</span><span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span><span class='lparen'>(</span><span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_one_and_update-instance_method">
  
    #<strong>find_one_and_update</strong>(document, opts = {})  &#x21d2; <tt>BSON::Document</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finds a single document and updates it.</p>

<p>an update should apply.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Find a document and update it, returning the original.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_view'>view</span><span class='period'>.</span><span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:return_document</span> <span class='op'>=&gt;</span> <span class='symbol'>:before</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>document</span>
      
      
        <span class='type'>(<tt>BSON::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The updates.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:projection</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The fields to include or exclude in the returned doc.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:sort</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The key and direction pairs by which the result set will be sorted.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:return_document</span>
          <span class="type">(<tt><span class='object_link'><a href="../../../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Either :before or :after.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:upsert</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to upsert if the document doesn&#39;t exist.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bypass_document_validation</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether or not to skip document level validation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:array_filters</span>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A set of filters specifying to which array elements</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>BSON::Document</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The document.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one_and_update'>find_one_and_update</span><span class='lparen'>(</span><span class='id identifier rubyid_document'>document</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:findAndModify</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:query</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:update</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_document'>document</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:fields</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_projection'>projection</span> <span class='kw'>if</span> <span class='id identifier rubyid_projection'>projection</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_sort'>sort</span> <span class='kw'>if</span> <span class='id identifier rubyid_sort'>sort</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:new</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:return_document</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:return_document</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='symbol'>:after</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:maxTimeMS</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_max_time_ms'>max_time_ms</span> <span class='kw'>if</span> <span class='id identifier rubyid_max_time_ms'>max_time_ms</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:bypassDocumentValidation</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span> <span class='op'>=</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:session</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='symbol'>:writeConcern</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span> <span class='kw'>if</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span>
    <span class='id identifier rubyid_write_with_retry'>write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_array_filters!'>apply_array_filters!</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_applied_write_concern'>applied_write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Command.html" title="Mongo::Operation::Command (class)">Command</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:selector</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
          <span class='symbol'>:txn_num</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace_one-instance_method">
  
    #<strong>replace_one</strong>(replacement, opts = {})  &#x21d2; <tt>Result</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Replaces a single document in the database with the new document.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Replace a single document.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_collection_view'>collection_view</span><span class='period'>.</span><span class='id identifier rubyid_replace_one'>replace_one</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>replacement</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The replacement document.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:upsert</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to upsert if the document doesn&#39;t exist.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bypass_document_validation</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether or not to skip document level validation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer, :fsync =&gt; Boolean, :j =&gt; Boolean.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Result</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The response from the database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 276</span>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_one'>replace_one</span><span class='lparen'>(</span><span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#Q-constant" title="Mongo::Operation::Q (constant)">Q</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span>
                 <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#U-constant" title="Mongo::Operation::U (constant)">U</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_replacement'>replacement</span><span class='comma'>,</span>
                <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_update_doc'>update_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>upsert</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_concern'>write_concern</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="../../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="../../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_write_concern_with_session'>write_concern_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_write_with_retry'>write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_array_filters!'>apply_array_filters!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Update.html" title="Mongo::Operation::Update (class)">Update</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:updates</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:coll_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:write_concern</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='comma'>,</span>
          <span class='symbol'>:bypass_document_validation</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
          <span class='symbol'>:txn_num</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_many-instance_method">
  
    #<strong>update_many</strong>(spec, opts = {})  &#x21d2; <tt>Result</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update documents in the collection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Update multiple documents in the collection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_collection_view'>collection_view</span><span class='period'>.</span><span class='id identifier rubyid_update_many'>update_many</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>spec</span>
      
      
        <span class='type'>(<tt>Hash | Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The update document or pipeline.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:upsert</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to upsert if the document doesn&#39;t exist.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bypass_document_validation</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether or not to skip document level validation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:array_filters</span>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A set of filters specifying to which array elements an update should apply.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer, :fsync =&gt; Boolean, :j =&gt; Boolean.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Result</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The response from the database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_many'>update_many</span><span class='lparen'>(</span><span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#Q-constant" title="Mongo::Operation::Q (constant)">Q</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span>
                 <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#U-constant" title="Mongo::Operation::U (constant)">U</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span>
                 <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#MULTI-constant" title="Mongo::Operation::MULTI (constant)">MULTI</a></span></span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
                 <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_update_doc'>update_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>upsert</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_concern'>write_concern</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="../../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="../../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_write_concern_with_session'>write_concern_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_nro_write_with_retry'>nro_write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_array_filters!'>apply_array_filters!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Update.html" title="Mongo::Operation::Update (class)">Update</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:updates</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:coll_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:write_concern</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='comma'>,</span>
          <span class='symbol'>:bypass_document_validation</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_one-instance_method">
  
    #<strong>update_one</strong>(spec, opts = {})  &#x21d2; <tt>Result</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update a single document in the collection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Update a single document in the collection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_collection_view'>collection_view</span><span class='period'>.</span><span class='id identifier rubyid_update_one'>update_one</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$set</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>spec</span>
      
      
        <span class='type'>(<tt>Hash | Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The update document or pipeline.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:upsert</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to upsert if the document doesn&#39;t exist.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bypass_document_validation</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether or not to skip document level validation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:collation</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:array_filters</span>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>A set of filters specifying to which array elements an update should apply.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:session</span>
          <span class="type">(<tt><span class='object_link'><a href="../../Session.html" title="Mongo::Session (class)">Session</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:hint</span>
          <span class="type">(<tt>Hash | String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The index to use for this operation. May be specified as a Hash (e.g. { _id: 1 }) or a String (e.g. “<em>id</em>”).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:write_concern</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The write concern options. Can be :w =&gt; Integer, :fsync =&gt; Boolean, :j =&gt; Boolean.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Result</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The response from the database.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/collection/view/writable.rb', line 391</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_one'>update_one</span><span class='lparen'>(</span><span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../QueryCache.html" title="Mongo::QueryCache (module)">QueryCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_clear_namespace'><span class='object_link'><a href="../../QueryCache.html#clear_namespace-class_method" title="Mongo::QueryCache.clear_namespace (method)">clear_namespace</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#Q-constant" title="Mongo::Operation::Q (constant)">Q</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span>
                 <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation.html#U-constant" title="Mongo::Operation::U (constant)">U</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span>
                 <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:upsert</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_update_doc'>update_doc</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>upsert</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_with_session'>with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_concern'>write_concern</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span>
      <span class='const'><span class='object_link'><a href="../../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="../../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:write_concern</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_write_concern_with_session'>write_concern_with_session</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_write_with_retry'>write_with_retry</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='op'>|</span>
      <span class='id identifier rubyid_apply_collation!'>apply_collation!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_array_filters!'>apply_array_filters!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_apply_hint!'>apply_hint!</span><span class='lparen'>(</span><span class='id identifier rubyid_update_doc'>update_doc</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>write_concern:</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='rparen'>)</span><span class='rparen'>)</span>

      <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Update.html" title="Mongo::Operation::Update (class)">Update</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span></span><span class='lparen'>(</span>
          <span class='symbol'>:updates</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_update_doc'>update_doc</span> <span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:db_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:coll_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_collection'>collection</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
          <span class='symbol'>:write_concern</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_write_concern'>write_concern</span><span class='comma'>,</span>
          <span class='symbol'>:bypass_document_validation</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bypass_document_validation</span><span class='rbracket'>]</span><span class='comma'>,</span>
          <span class='symbol'>:session</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
          <span class='symbol'>:txn_num</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_txn_num'>txn_num</span><span class='comma'>,</span>
      <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='const'><span class='object_link'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../Operation/Context.html#initialize-instance_method" title="Mongo::Operation::Context#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed May 12 17:19:08 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>