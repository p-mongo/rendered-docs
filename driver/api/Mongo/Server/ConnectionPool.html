<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mongo::Server::ConnectionPool
  
    &mdash; mongo-2.12.0.rc0
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::Server::ConnectionPool";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Server.html" title="Mongo::Server (class)">Server</a></span></span>
     &raquo; 
    <span class="title">ConnectionPool</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mongo::Server::ConnectionPool
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mongo::Server::ConnectionPool</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Forwardable</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="../Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span>, <span class='object_link'><a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)">Monitoring::Publishable</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/server/connection_pool.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Represents a connection pool for server connections.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="DEFAULT_MAX_SIZE-constant" class="">DEFAULT_MAX_SIZE =
          <div class="docstring">
  <div class="discussion">
    
<p>The default max size for the connection pool.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>5</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DEFAULT_MIN_SIZE-constant" class="">DEFAULT_MIN_SIZE =
          <div class="docstring">
  <div class="discussion">
    
<p>The default min size for the connection pool.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="DEFAULT_WAIT_TIMEOUT-constant" class="">DEFAULT_WAIT_TIMEOUT =
          <div class="docstring">
  <div class="discussion">
    
<p>The default timeout, in seconds, to wait for a connection.</p>

<p>This timeout applies while in flow threads are waiting for background threads to establish connections (and hence they must connect, handshake and auth in the allotted time).</p>

<p>It is currently set to 10 seconds. The default connect timeout is 10 seconds by itself, but setting large timeouts can get applications in trouble if their requests get timed out by the reverse proxy, thus anything over 15 seconds is potentially dangerous.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>10</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">Loggable::PREFIX</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#generation-instance_method" title="#generation (instance method)">#<strong>generation</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Generation Generation of connections currently being used by the queue.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Options The pool options.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#populate_semaphore-instance_method" title="#populate_semaphore (instance method)">#<strong>populate_semaphore</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Condition variable broadcast when the size of the pool changes to wake up the populator.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#populator-instance_method" title="#populator (instance method)">#<strong>populator</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)">Monitoring::Publishable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Monitoring/Publishable.html#monitoring-instance_method" title="Mongo::Monitoring::Publishable#monitoring (method)">#monitoring</a></span></p>


  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finalize-class_method" title="finalize (class method)">.<strong>finalize</strong>(available_connections, pending_connections, populator)  &#x21d2; Proc </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finalize the connection pool for garbage collection.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#available_count-instance_method" title="#available_count (instance method)">#<strong>available_count</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Number of available connections in the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_in-instance_method" title="#check_in (instance method)">#<strong>check_in</strong>(connection)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check a connection back into the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_out-instance_method" title="#check_out (instance method)">#<strong>check_out</strong>  &#x21d2; Mongo::Server::Connection </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks a connection out of the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear-instance_method" title="#clear (instance method)">#<strong>clear</strong>(options = nil)  &#x21d2; true </a>
    

    
      (also: #disconnect!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes all idle connections in the pool and schedules currently checked out connections to be closed when they are checked back into the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>(options = nil)  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Marks the pool closed, closes all idle connections in the pool and schedules currently checked out connections to be closed when they are checked back into the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close_idle_sockets-instance_method" title="#close_idle_sockets (instance method)">#<strong>close_idle_sockets</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Close sockets that have been open for longer than the max idle time,   if the option is set.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; true | false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Whether the pool has been closed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(server, options = {})  &#x21d2; ConnectionPool </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create the new connection pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a pretty printed string inspection for the pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_idle_time-instance_method" title="#max_idle_time (instance method)">#<strong>max_idle_time</strong>  &#x21d2; Float | nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The maximum seconds a socket can remain idle since it has been checked in to the pool, if set.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_size-instance_method" title="#max_size (instance method)">#<strong>max_size</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the maximum size of the connection pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#min_size-instance_method" title="#min_size (instance method)">#<strong>min_size</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the minimum size of the connection pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#populate-instance_method" title="#populate (instance method)">#<strong>populate</strong>  &#x21d2; true | false </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Creates and adds a connection to the pool, if the pool&#39;s size is below min_size.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Size of the connection pool.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_populator-instance_method" title="#stop_populator (instance method)">#<strong>stop_populator</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Stop the background populator thread and clean up any connections created which have not been connected yet.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wait_timeout-instance_method" title="#wait_timeout (instance method)">#<strong>wait_timeout</strong>  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The time to wait, in seconds, for a connection to become available.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_connection-instance_method" title="#with_connection (instance method)">#<strong>with_connection</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Yield the block to a connection, while handling check in/check out logic.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)">Monitoring::Publishable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Monitoring/Publishable.html#publish_cmap_event-instance_method" title="Mongo::Monitoring::Publishable#publish_cmap_event (method)">#publish_cmap_event</a></span>, <span class='object_link'><a href="../Monitoring/Publishable.html#publish_event-instance_method" title="Mongo::Monitoring::Publishable#publish_event (method)">#publish_event</a></span>, <span class='object_link'><a href="../Monitoring/Publishable.html#publish_sdam_event-instance_method" title="Mongo::Monitoring::Publishable#publish_sdam_event (method)">#publish_sdam_event</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></span>, <span class='object_link'><a href="../Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="../Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></span>, <span class='object_link'><a href="../Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></span>, <span class='object_link'><a href="../Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></span>, <span class='object_link'><a href="../Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(server, options = {})  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Server::ConnectionPool (class)">ConnectionPool</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create the new connection pool.</p>

<p>Note: Additionally, options for connections created by this pool should</p>

<pre class="code ruby"><code class="ruby">be included in the options passed here, and they will be forwarded to
any connections created by the pool.
</code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Server.html" title="Mongo::Server (class)">Server</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server which this connection pool is for.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The connection pool options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:max_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The maximum pool size.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_pool_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated. The maximum pool size. If max_size is also given, max_size and max_pool_size must be identical.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:min_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The minimum pool size.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:min_pool_size</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated. The minimum pool size. If min_size is also given, min_size and min_pool_size must be identical.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:wait_timeout</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The time to wait, in seconds, for a free connection.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:wait_queue_timeout</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated. Alias for :wait_timeout. If both wait_timeout and wait_queue_timeout are given, their values must be identical.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:max_idle_time</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The time, in seconds, after which idle connections should be closed by the pool.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, API changed in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Server.html" title="Mongo::Server (class)">Server</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>First argument must be a Server instance</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_pool_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_pool_size</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Min size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not identical to min pool size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_pool_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_pool_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_pool_size</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Max size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not identical to max pool size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_pool_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_timeout</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_queue_timeout</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_timeout</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_queue_timeout</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wait timeout </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_timeout</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not identical to wait queue timeout </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_queue_timeout</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_pool_size</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:min_pool_size</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_pool_size</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:max_pool_size</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span>
  <span class='kw'>then</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot have min size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> exceed max size </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_queue_timeout</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_timeout</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_queue_timeout</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:wait_queue_timeout</span><span class='rparen'>)</span>

  <span class='ivar'>@server</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span>
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='ivar'>@generation</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># A connection owned by this pool should be either in the
</span>  <span class='comment'># available connections array (which is used as a stack)
</span>  <span class='comment'># or in the checked out connections set.
</span>  <span class='ivar'>@available_connections</span> <span class='op'>=</span> <span class='id identifier rubyid_available_connections'>available_connections</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@checked_out_connections</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@pending_connections</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='comment'># Mutex used for synchronizing access to @available_connections and
</span>  <span class='comment'># @checked_out_connections. The pool object is thread-safe, thus
</span>  <span class='comment'># all methods that retrieve or modify instance variables generally
</span>  <span class='comment'># must do so under this lock.
</span>  <span class='ivar'>@lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='comment'># Condition variable broadcast when a connection is added to
</span>  <span class='comment'># @available_connections, to wake up any threads waiting for an
</span>  <span class='comment'># available connection when pool is at max size
</span>  <span class='ivar'>@available_semaphore</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Semaphore.html" title="Mongo::Semaphore (class)">Semaphore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Semaphore.html#initialize-instance_method" title="Mongo::Semaphore#initialize (method)">new</a></span></span>

  <span class='comment'># Background thread reponsible for maintaining the size of
</span>  <span class='comment'># the pool to at least min_size
</span>  <span class='ivar'>@populator</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Populator.html" title="Mongo::Server::Populator (class)">Populator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Populator.html#initialize-instance_method" title="Mongo::Server::Populator#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@populate_semaphore</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Semaphore.html" title="Mongo::Semaphore (class)">Semaphore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Semaphore.html#initialize-instance_method" title="Mongo::Semaphore#initialize (method)">new</a></span></span>

  <span class='const'>ObjectSpace</span><span class='period'>.</span><span class='id identifier rubyid_define_finalizer'>define_finalizer</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span><span class='lparen'>(</span><span class='ivar'>@available_connections</span><span class='comma'>,</span> <span class='ivar'>@pending_connections</span><span class='comma'>,</span> <span class='ivar'>@populator</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolCreated.html" title="Mongo::Monitoring::Event::Cmap::PoolCreated (class)">PoolCreated</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolCreated.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::PoolCreated#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='rparen'>)</span>

  <span class='ivar'>@populator</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span> <span class='kw'>if</span> <span class='id identifier rubyid_min_size'>min_size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="generation-instance_method">
  
    #<strong>generation</strong>  &#x21d2; <tt>Integer</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Returns generation Generation of connections currently being used by the queue.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>generation Generation of connections currently being used by the queue.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generation'>generation</span>
  <span class='ivar'>@generation</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="options-instance_method">
  
    #<strong>options</strong>  &#x21d2; <tt>Hash</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns options The pool options.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>options The pool options.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_options'>options</span>
  <span class='ivar'>@options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="populate_semaphore-instance_method">
  
    #<strong>populate_semaphore</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Condition variable broadcast when the size of the pool changes to wake up the populator</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_populate_semaphore'>populate_semaphore</span>
  <span class='ivar'>@populate_semaphore</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="populator-instance_method">
  
    #<strong>populator</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 257</span>

<span class='kw'>def</span> <span class='id identifier rubyid_populator'>populator</span>
  <span class='ivar'>@populator</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="finalize-class_method">
  
    .<strong>finalize</strong>(available_connections, pending_connections, populator)  &#x21d2; <tt>Proc</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finalize the connection pool for garbage collection.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>available_connections</span>
      
      
        <span class='type'>(<tt>List&lt;Mongo::Connection&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The available connections.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pending_connections</span>
      
      
        <span class='type'>(<tt>List&lt;Mongo::Connection&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The pending connections.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>populator</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Populator.html" title="Mongo::Server::Populator (class)">Populator</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The populator.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Finalizer.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 672</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span><span class='lparen'>(</span><span class='id identifier rubyid_available_connections'>available_connections</span><span class='comma'>,</span> <span class='id identifier rubyid_pending_connections'>pending_connections</span><span class='comma'>,</span> <span class='id identifier rubyid_populator'>populator</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_populator'>populator</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>

    <span class='id identifier rubyid_available_connections'>available_connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:pool_closed</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_available_connections'>available_connections</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>

    <span class='id identifier rubyid_pending_connections'>pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:pool_closed</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_pending_connections'>pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>

    <span class='comment'># Finalizer does not close checked out connections.
</span>    <span class='comment'># Those would have to be garbage collected on their own
</span>    <span class='comment'># and that should close them.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="available_count-instance_method">
  
    #<strong>available_count</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Number of available connections in the pool.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Number of available connections.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_available_count'>available_count</span>
  <span class='id identifier rubyid_raise_if_closed!'>raise_if_closed!</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_in-instance_method">
  
    #<strong>check_in</strong>(connection)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check a connection back into the pool.</p>

<p>The connection must have been previously created by this pool.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>connection</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Connection.html" title="Mongo::Server::Connection (class)">Mongo::Server::Connection</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The connection.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 404</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_in'>check_in</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_check_invariants'>check_invariants</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'>connection_pool</span> <span class='op'>==</span> <span class='kw'>self</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to check in a connection which was not checked out by this pool: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connection'>connection</span><span class='embexpr_end'>}</span><span class='tstring_content'> checked out from pool </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'>connection_pool</span><span class='embexpr_end'>}</span><span class='tstring_content'> (for </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>unless</span> <span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to check in a connection which is not currently checked out by this pool: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connection'>connection</span><span class='embexpr_end'>}</span><span class='tstring_content'> (for </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># Note: if an event handler raises, resource will not be signaled.
</span>    <span class='comment'># This means threads waiting for a connection to free up when
</span>    <span class='comment'># the pool is at max size may time out.
</span>    <span class='comment'># Threads that begin waiting after this method completes (with
</span>    <span class='comment'># the exception) should be fine.
</span>
    <span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckedIn.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckedIn (class)">ConnectionCheckedIn</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckedIn.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckedIn#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:pool_closed</span><span class='rparen'>)</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>      <span class='comment'># Connection was closed - for example, because it experienced
</span>      <span class='comment'># a network error. Nothing else needs to be done here.
</span>
      <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_generation'>generation</span> <span class='op'>!=</span> <span class='ivar'>@generation</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:stale</span><span class='rparen'>)</span>
      <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_record_checkin!'>record_checkin!</span>
      <span class='ivar'>@available_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_connection'>connection</span>

      <span class='comment'># Wake up only one thread waiting for an available connection,
</span>      <span class='comment'># since only one connection was checked in.
</span>      <span class='ivar'>@available_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_check_invariants'>check_invariants</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_out-instance_method">
  
    #<strong>check_out</strong>  &#x21d2; <tt><span class='object_link'><a href="Connection.html" title="Mongo::Server::Connection (class)">Mongo::Server::Connection</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks a connection out of the pool.</p>

<p>If there are active connections in the pool, the most recently used connection is returned. Otherwise if the connection pool size is less than the max size, creates a new connection and returns it. Otherwise waits up to the wait timeout and raises Timeout::Error if there are still no active connections and the pool is at max size.</p>

<p>The returned connection counts toward the pool&#39;s max size. When the caller is finished using the connection, the connection should be checked back in via the check_in method.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Connection.html" title="Mongo::Server::Connection (class)">Mongo::Server::Connection</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The checked out connection.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Error/PoolClosedError.html" title="Mongo::Error::PoolClosedError (class)">Error::PoolClosedError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the pool has been closed.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Timeout::Error</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the connection pool is at maximum size and remains so for longer than the wait timeout.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_out'>check_out</span>
  <span class='id identifier rubyid_check_invariants'>check_invariants</span>

  <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutStarted.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutStarted (class)">ConnectionCheckOutStarted</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutStarted.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutStarted#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
  <span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>
    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed#initialize (method)">new</a></span></span><span class='lparen'>(</span>
        <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span>
        <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#POOL_CLOSED-constant" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed::POOL_CLOSED (constant)">POOL_CLOSED</a></span></span>
      <span class='rparen'>)</span><span class='comma'>,</span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/PoolClosedError.html" title="Mongo::Error::PoolClosedError (class)">PoolClosedError</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Error/PoolClosedError.html#initialize-instance_method" title="Mongo::Error::PoolClosedError#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_wait_timeout'>wait_timeout</span>
  <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='kw'>nil</span>  <span class='comment'># It seems that synchronize sets up its own loop, thus a simple break
</span>  <span class='comment'># is insufficient to break the outer loop
</span>
  <span class='id identifier rubyid_catch'>catch</span><span class='lparen'>(</span><span class='symbol'>:done</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='comment'># Lock must be taken on each iteration, rather for the method
</span>      <span class='comment'># overall, otherwise other threads will not be able to check in
</span>      <span class='comment'># a connection while this thread is waiting for one.
</span>      <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='kw'>until</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>

          <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_generation'>generation</span> <span class='op'>!=</span> <span class='id identifier rubyid_generation'>generation</span>            <span class='comment'># Stale connections should be disconnected in the clear
</span>            <span class='comment'># method, but if any don&#39;t, check again here
</span>
            <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:stale</span><span class='rparen'>)</span>
            <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
            <span class='kw'>next</span>
          <span class='kw'>end</span>

          <span class='kw'>if</span> <span class='id identifier rubyid_max_idle_time'>max_idle_time</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_last_checkin'>last_checkin</span> <span class='op'>&amp;&amp;</span>
            <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_last_checkin'>last_checkin</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_idle_time'>max_idle_time</span>
          <span class='kw'>then</span>
            <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:idle</span><span class='rparen'>)</span>
            <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
            <span class='kw'>next</span>
          <span class='kw'>end</span>

          <span class='ivar'>@pending_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_connection'>connection</span>
          <span class='id identifier rubyid_throw'>throw</span><span class='lparen'>(</span><span class='symbol'>:done</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='comment'># Ruby does not allow a thread to lock a mutex which it already
</span>        <span class='comment'># holds.
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_unsynchronized_size'>unsynchronized_size</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_max_size'>max_size</span>
          <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='id identifier rubyid_create_connection'>create_connection</span>
          <span class='ivar'>@pending_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_connection'>connection</span>
          <span class='id identifier rubyid_throw'>throw</span><span class='lparen'>(</span><span class='symbol'>:done</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_wait'>wait</span> <span class='op'>=</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>-</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_wait'>wait</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
          <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed#initialize (method)">new</a></span></span><span class='lparen'>(</span>
            <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span>
            <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#TIMEOUT-constant" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed::TIMEOUT (constant)">TIMEOUT</a></span></span><span class='comma'>,</span>
          <span class='rparen'>)</span><span class='comma'>,</span>
        <span class='rparen'>)</span>

        <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Timed out attempting to check out a connection </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from pool for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='embexpr_end'>}</span><span class='tstring_content'> after </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wait_timeout'>wait_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> sec. </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connections in pool: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> available, </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> checked out, </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> pending </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(max size: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_size'>max_size</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/ConnectionCheckOutTimeout.html" title="Mongo::Error::ConnectionCheckOutTimeout (class)">ConnectionCheckOutTimeout</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Error/ConnectionCheckOutTimeout.html#initialize-instance_method" title="Mongo::Error::ConnectionCheckOutTimeout#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='label'>address:</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='ivar'>@available_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span><span class='lparen'>(</span><span class='id identifier rubyid_wait'>wait</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_connect_connection'>connect_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span>    <span class='comment'># Handshake or authentication failed
</span>
    <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>

    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed#initialize (method)">new</a></span></span><span class='lparen'>(</span>
        <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span>
        <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed (class)">ConnectionCheckOutFailed</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckOutFailed.html#CONNECTION_ERROR-constant" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckOutFailed::CONNECTION_ERROR (constant)">CONNECTION_ERROR</a></span></span>
      <span class='rparen'>)</span><span class='comma'>,</span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@checked_out_connections</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_connection'>connection</span>
    <span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckedOut.html" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckedOut (class)">ConnectionCheckedOut</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/ConnectionCheckedOut.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::ConnectionCheckedOut#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../Lint.html" title="Mongo::Lint (module)">Lint</a></span></span><span class='period'>.</span><span class='id identifier rubyid_enabled?'><span class='object_link'><a href="../Lint.html#enabled%3F-class_method" title="Mongo::Lint.enabled? (method)">enabled?</a></span></span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_connected?'>connected?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/LintError.html" title="Mongo::Error::LintError (class)">LintError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Connection pool checked out a disconnected connection</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_connection'>connection</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_check_invariants'>check_invariants</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear-instance_method">
  
    #<strong>clear</strong>(options = nil)  &#x21d2; <tt>true</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='disconnect!-instance_method'>disconnect!</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Closes all idle connections in the pool and schedules currently checked out connections to be closed when they are checked back into the pool. The pool remains operational and can create new connections when requested.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:lazy</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>If true, do not close any of the idle connections and instead let them be closed during a subsequent check out operation.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:stop_populator</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to stop the populator background thread. For internal driver use only.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 466</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise_if_closed!'>raise_if_closed!</span>

  <span class='id identifier rubyid_check_invariants'>check_invariants</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:stop_populator</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_stop_populator'>stop_populator</span>
  <span class='kw'>end</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@generation</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolCleared.html" title="Mongo::Monitoring::Event::Cmap::PoolCleared (class)">PoolCleared</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolCleared.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::PoolCleared#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:lazy</span><span class='rbracket'>]</span>
      <span class='kw'>until</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:stale</span><span class='rparen'>)</span>
        <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_check_invariants'>check_invariants</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-instance_method">
  
    #<strong>close</strong>(options = nil)  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Marks the pool closed, closes all idle connections in the pool and schedules currently checked out connections to be closed when they are checked back into the pool. If force option is true, checked out connections are also closed. Attempts to use the pool after it is closed will raise Error::PoolClosedError.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:force</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Also close all checked out connections.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 512</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>

  <span class='id identifier rubyid_options'>options</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_stop_populator'>stop_populator</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>until</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:pool_closed</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:force</span><span class='rbracket'>]</span>
      <span class='kw'>until</span> <span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:pool_closed</span><span class='rparen'>)</span>
        <span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># mark pool as closed before releasing lock so
</span>    <span class='comment'># no connections can be created, checked in, or checked out
</span>    <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolClosed.html" title="Mongo::Monitoring::Event::Cmap::PoolClosed (class)">PoolClosed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Monitoring/Event/Cmap/PoolClosed.html#initialize-instance_method" title="Mongo::Monitoring::Event::Cmap::PoolClosed#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='rparen'>)</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close_idle_sockets-instance_method">
  
    #<strong>close_idle_sockets</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Close sockets that have been open for longer than the max idle time,</p>

<pre class="code ruby"><code class="ruby">if the option is set.
</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 588</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_idle_sockets'>close_idle_sockets</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_max_idle_time'>max_idle_time</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@available_connections</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_last_checkin'>last_checkin</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_last_checkin'>last_checkin</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='id identifier rubyid_last_checkin'>last_checkin</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_idle_time'>max_idle_time</span>
          <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span><span class='lparen'>(</span><span class='label'>reason:</span> <span class='symbol'>:idle</span><span class='rparen'>)</span>
          <span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
          <span class='ivar'>@populate_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="closed?-instance_method">
  
    #<strong>closed?</strong>  &#x21d2; <tt>true | false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Whether the pool has been closed.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true | false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether the pool is closed.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 238</span>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@closed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a pretty printed string inspection for the pool.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Inspect the pool.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_pool'>pool</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The pool inspection.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


553
554
555
556
557
558
559
560
561</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 553</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Server::ConnectionPool:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> min_size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_min_size'>min_size</span><span class='embexpr_end'>}</span><span class='tstring_content'> max_size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_size'>max_size</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wait_timeout=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wait_timeout'>wait_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> closed&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Server::ConnectionPool:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> min_size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_min_size'>min_size</span><span class='embexpr_end'>}</span><span class='tstring_content'> max_size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_size'>max_size</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wait_timeout=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wait_timeout'>wait_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> current_size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> available=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_available_count'>available_count</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_idle_time-instance_method">
  
    #<strong>max_idle_time</strong>  &#x21d2; <tt>Float | nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The maximum seconds a socket can remain idle since it has been checked in to the pool, if set.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float | nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The max socket idle time in seconds.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_idle_time'>max_idle_time</span>
  <span class='ivar'>@max_idle_time</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_idle_time</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_size-instance_method">
  
    #<strong>max_size</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the maximum size of the connection pool.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The maximum size of the connection pool.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_size'>max_size</span>
  <span class='ivar'>@max_size</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_size</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#DEFAULT_MAX_SIZE-constant" title="Mongo::Server::ConnectionPool::DEFAULT_MAX_SIZE (constant)">DEFAULT_MAX_SIZE</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_min_size'>min_size</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="min_size-instance_method">
  
    #<strong>min_size</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the minimum size of the connection pool.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The minimum size of the connection pool.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_min_size'>min_size</span>
  <span class='ivar'>@min_size</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:min_size</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#DEFAULT_MIN_SIZE-constant" title="Mongo::Server::ConnectionPool::DEFAULT_MIN_SIZE (constant)">DEFAULT_MIN_SIZE</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="populate-instance_method">
  
    #<strong>populate</strong>  &#x21d2; <tt>true | false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Creates and adds a connection to the pool, if the pool&#39;s size is below min_size. Retries once if a socket-related error is encountered during this process and raises if a second error or a non socket-related error occurs.</p>

<p>Used by the pool populator background thread.</p>

<p>occured, or the non socket-related error</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true | false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether this method should be called again to create more connections.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Error/AuthError.html" title="Mongo::Error::AuthError (class)">Error::AuthError</a></span></tt>, <tt><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The second socket-related error raised if a retry</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 646</span>

<span class='kw'>def</span> <span class='id identifier rubyid_populate'>populate</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_closed?'>closed?</span>

  <span class='kw'>begin</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_create_and_add_connection'>create_and_add_connection</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>    <span class='comment'># an error was encountered while connecting the connection,
</span>    <span class='comment'># ignore this first error and try again.
</span>
    <span class='id identifier rubyid_log_warn'>log_warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Populator failed to connect a connection for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'>address</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'>. It will retry.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_create_and_add_connection'>create_and_add_connection</span>
<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error/AuthError.html" title="Mongo::Error::AuthError (class)">AuthError</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span></span>  <span class='comment'># wake up one thread waiting for connections, since one could not
</span>  <span class='comment'># be created here, and can instead be created in flow
</span>
  <span class='ivar'>@available_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="size-instance_method">
  
    #<strong>size</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Size of the connection pool.</p>

<p>Includes available and checked out connections.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Size of the connection pool.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_raise_if_closed!'>raise_if_closed!</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_unsynchronized_size'>unsynchronized_size</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_populator-instance_method">
  
    #<strong>stop_populator</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Stop the background populator thread and clean up any connections created which have not been connected yet.</p>

<p>Used when closing the pool or when terminating the bg thread for testing purposes. In the latter case, this method must be called before the pool is used, to ensure no connections in pending_connections were created in-flow by the check_out method.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0, largely rewritten in 2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


618
619
620
621
622
623
624
625
626
627
628
629
630
631
632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 618</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_populator'>stop_populator</span>
  <span class='ivar'>@populator</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>

  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='comment'># If stop_populator is called while populate is running, there may be
</span>    <span class='comment'># connections waiting to be connected, connections which have not yet
</span>    <span class='comment'># been moved to available_connections, or connections moved to available_connections
</span>    <span class='comment'># but not deleted from pending_connections. These should be cleaned up.
</span>    <span class='kw'>until</span> <span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span>
      <span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="summary-instance_method">
  
    #<strong>summary</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method is experimental and subject to change.</p>
</div>
  </div>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.11.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
  <span class='ivar'>@lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ConnectionPool size=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_unsynchronized_size'>unsynchronized_size</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_min_size'>min_size</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_size'>max_size</span><span class='embexpr_end'>}</span><span class='tstring_content'>) </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>used=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@checked_out_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> avail=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@available_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> pending=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@pending_connections</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wait_timeout-instance_method">
  
    #<strong>wait_timeout</strong>  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The time to wait, in seconds, for a connection to become available.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The queue wait timeout.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.9.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wait_timeout'>wait_timeout</span>
  <span class='ivar'>@wait_timeout</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:wait_timeout</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#DEFAULT_WAIT_TIMEOUT-constant" title="Mongo::Server::ConnectionPool::DEFAULT_WAIT_TIMEOUT (constant)">DEFAULT_WAIT_TIMEOUT</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_connection-instance_method">
  
    #<strong>with_connection</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Yield the block to a connection, while handling check in/check out logic.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Execute with a connection.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_pool'>pool</span><span class='period'>.</span><span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
  <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The result of the block.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


573
574
575
576
577
578
579
580
581
582</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/server/connection_pool.rb', line 573</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_connection'>with_connection</span>
  <span class='id identifier rubyid_raise_if_closed!'>raise_if_closed!</span>

  <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='id identifier rubyid_check_out'>check_out</span>
  <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span>
    <span class='id identifier rubyid_check_in'>check_in</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Apr  9 22:19:59 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.0).
</div>

    </div>
  </body>
</html>