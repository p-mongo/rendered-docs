<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Mongo::Cluster
  
    &mdash; mongo-2.12.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Mongo::Cluster";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span>
     &raquo; 
    <span class="title">Cluster</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Mongo::Cluster
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mongo::Cluster</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>Forwardable</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)">Mongo::ClusterTime::Consumer</a></span>, <span class='object_link'><a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)">Event::Subscriber</a></span>, <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span>, <span class='object_link'><a href="Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)">Monitoring::Publishable</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/mongo/cluster.rb<span class="defines">,<br />
  lib/mongo/cluster/topology.rb,<br /> lib/mongo/cluster/topology.rb,<br /> lib/mongo/cluster/sdam_flow.rb,<br /> lib/mongo/cluster/topology/base.rb,<br /> lib/mongo/cluster/topology/single.rb,<br /> lib/mongo/cluster/topology/sharded.rb,<br /> lib/mongo/cluster/topology/unknown.rb,<br /> lib/mongo/cluster/periodic_executor.rb,<br /> lib/mongo/cluster/reapers/cursor_reaper.rb,<br /> lib/mongo/cluster/reapers/socket_reaper.rb,<br /> lib/mongo/cluster/topology/no_replica_set_options.rb,<br /> lib/mongo/cluster/topology/replica_set_no_primary.rb,<br /> lib/mongo/cluster/topology/replica_set_with_primary.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Copyright (C) 2018-2020 MongoDB Inc.</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_http'>http</span><span class='symbol'>:/</span><span class='op'>/</span><span class='id identifier rubyid_www'>www</span><span class='period'>.</span><span class='id identifier rubyid_apache'>apache</span><span class='period'>.</span><span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_licenses'>licenses</span><span class='op'>/</span><span class='const'>LICENSE</span><span class='op'>-</span><span class='float'>2.0</span>
</code></pre>

<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Cluster/CursorReaper.html" title="Mongo::Cluster::CursorReaper (class)">CursorReaper</a></span>, <span class='object_link'><a href="Cluster/PeriodicExecutor.html" title="Mongo::Cluster::PeriodicExecutor (class)">PeriodicExecutor</a></span>, <span class='object_link'><a href="Cluster/SdamFlow.html" title="Mongo::Cluster::SdamFlow (class)">SdamFlow</a></span>, <span class='object_link'><a href="Cluster/SocketReaper.html" title="Mongo::Cluster::SocketReaper (class)">SocketReaper</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="MAX_READ_RETRIES-constant" class="">MAX_READ_RETRIES =
          <div class="docstring">
  <div class="discussion">
    
<p>The default number of legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.1</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
        <dt id="MAX_WRITE_RETRIES-constant" class="">MAX_WRITE_RETRIES =
          <div class="docstring">
  <div class="discussion">
    
<p>The default number of legacy write retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.4.2</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
        <dt id="READ_RETRY_INTERVAL-constant" class="">READ_RETRY_INTERVAL =
          <div class="docstring">
  <div class="discussion">
    
<p>The default read retry interval, in seconds, when using legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.1</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>5</span></pre></dd>
      
        <dt id="IDLE_WRITE_PERIOD_SECONDS-constant" class="">IDLE_WRITE_PERIOD_SECONDS =
          <div class="docstring">
  <div class="discussion">
    
<p>How often an idle primary writes a no-op to the oplog.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.4.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='int'>10</span></pre></dd>
      
        <dt id="CLUSTER_TIME-constant" class="deprecated">CLUSTER_TIME =
          <div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

<p>The cluster time key in responses from mongos servers.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>clusterTime</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">Loggable::PREFIX</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#app_metadata-instance_method" title="#app_metadata (instance method)">#<strong>app_metadata</strong>  &#x21d2; Mongo::Server::AppMetadata </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The application metadata, used for connection handshakes.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#monitoring-instance_method" title="#monitoring (instance method)">#<strong>monitoring</strong>  &#x21d2; Monitoring </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Monitoring The monitoring.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The options hash.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#seeds-instance_method" title="#seeds (instance method)">#<strong>seeds</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>The addresses of seed servers.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server_selection_semaphore-instance_method" title="#server_selection_semaphore (instance method)">#<strong>server_selection_semaphore</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_pool-instance_method" title="#session_pool (instance method)">#<strong>session_pool</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#srv_monitor-instance_method" title="#srv_monitor (instance method)">#<strong>srv_monitor</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#topology-instance_method" title="#topology (instance method)">#<strong>topology</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The logical session timeout value in minutes.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)">Mongo::ClusterTime::Consumer</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ClusterTime/Consumer.html#cluster_time-instance_method" title="Mongo::ClusterTime::Consumer#cluster_time (method)">#cluster_time</a></span></p>

  
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)">Event::Subscriber</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Event/Subscriber.html#event_listeners-instance_method" title="Mongo::Event::Subscriber#event_listeners (method)">#event_listeners</a></span></p>


  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="create (class method)">.<strong>create</strong>(client)  &#x21d2; Cluster </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Create a cluster for the provided client, for use when we don&#39;t want the client&#39;s original cluster instance to be the same.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#finalize-class_method" title="finalize (class method)">.<strong>finalize</strong>(pools, periodic_executor, session_pool)  &#x21d2; Proc </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Finalize the cluster for garbage collection.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; true, false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine if this cluster of servers is equal to another object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add-instance_method" title="#add (instance method)">#<strong>add</strong>(host, add_options = nil)  &#x21d2; Server </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a server to the cluster with the provided address.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#addresses-instance_method" title="#addresses (instance method)">#<strong>addresses</strong>  &#x21d2; Array&lt;Mongo::Address&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The addresses in the cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">#<strong>connected?</strong>  &#x21d2; true|false </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Whether the cluster object is connected to its cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connecting%3F-instance_method" title="#connecting? (instance method)">#<strong>connecting?</strong>  &#x21d2; true|false </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Whether the cluster object is in the process of connecting to its cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect!-instance_method" title="#disconnect! (instance method)">#<strong>disconnect!</strong>  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes the cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect_server_if_connected-instance_method" title="#disconnect_server_if_connected (instance method)">#<strong>disconnect_server_if_connected</strong>(server)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_readable_server%3F-instance_method" title="#has_readable_server? (instance method)">#<strong>has_readable_server?</strong>(server_selector = nil)  &#x21d2; true, false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine if the cluster would select a readable server for the provided read preference.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_writable_server%3F-instance_method" title="#has_writable_server? (instance method)">#<strong>has_writable_server?</strong>  &#x21d2; true, false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine if the cluster would select a writable server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#heartbeat_interval-instance_method" title="#heartbeat_interval (instance method)">#<strong>heartbeat_interval</strong>  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Get the refresh interval for the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(seeds, monitoring, options = Options::Redacted.new)  &#x21d2; Cluster </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Instantiate the new cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the nicer formatted string for use in inspection.</p>
</div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#max_read_retries-instance_method" title="#max_read_retries (instance method)">#<strong>max_read_retries</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_primary-instance_method" title="#next_primary (instance method)">#<strong>next_primary</strong>(ping = nil, session = nil)  &#x21d2; Mongo::Server </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the next primary server we can send an operation to.</p>
</div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#pool-instance_method" title="#pool (instance method)">#<strong>pool</strong>(server)  &#x21d2; Server::ConnectionPool </a>
    

    
  </span>
  
  
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'></div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#read_retry_interval-instance_method" title="#read_retry_interval (instance method)">#<strong>read_retry_interval</strong>  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'></div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#reconnect!-instance_method" title="#reconnect! (instance method)">#<strong>reconnect!</strong>  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'>
<p>Use Client#reconnect to reconnect to the cluster instead of calling this method. This method does not send SDAM events.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove-instance_method" title="#remove (instance method)">#<strong>remove</strong>(host, disconnect: true)  &#x21d2; Array&lt;Server&gt; | true | false </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove the server from the cluster for the provided address, if it exists.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_sdam_flow-instance_method" title="#run_sdam_flow (instance method)">#<strong>run_sdam_flow</strong>(previous_desc, updated_desc, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Runs SDAM flow on the cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scan!-instance_method" title="#scan! (instance method)">#<strong>scan!</strong>(sync = true)  &#x21d2; true </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Force a scan of all known servers in the cluster.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#servers-instance_method" title="#servers (instance method)">#<strong>servers</strong>  &#x21d2; Array&lt;Server&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get a list of server candidates from the cluster that can have operations executed on them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#servers_list-instance_method" title="#servers_list (instance method)">#<strong>servers_list</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sessions_supported%3F-instance_method" title="#sessions_supported? (instance method)">#<strong>sessions_supported?</strong>  &#x21d2; true | false </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Returns whether the deployment that the driver is connected to supports sessions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_server_list-instance_method" title="#set_server_list (instance method)">#<strong>set_server_list</strong>(server_address_strs)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the list of servers to the addresses in the provided list of address strings.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_cluster_time-instance_method" title="#update_cluster_time (instance method)">#<strong>update_cluster_time</strong>(result)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update the max cluster time seen in a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_topology-instance_method" title="#update_topology (instance method)">#<strong>update_topology</strong>(new_topology)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)">Mongo::ClusterTime::Consumer</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ClusterTime/Consumer.html#advance_cluster_time-instance_method" title="Mongo::ClusterTime::Consumer#advance_cluster_time (method)">#advance_cluster_time</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Loggable.html" title="Mongo::Loggable (module)">Loggable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></span>, <span class='object_link'><a href="Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></span>, <span class='object_link'><a href="Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></span>, <span class='object_link'><a href="Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></span>, <span class='object_link'><a href="Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></span>, <span class='object_link'><a href="Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)">Event::Subscriber</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Event/Subscriber.html#subscribe_to-instance_method" title="Mongo::Event::Subscriber#subscribe_to (method)">#subscribe_to</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)">Monitoring::Publishable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Monitoring/Publishable.html#publish_cmap_event-instance_method" title="Mongo::Monitoring::Publishable#publish_cmap_event (method)">#publish_cmap_event</a></span>, <span class='object_link'><a href="Monitoring/Publishable.html#publish_event-instance_method" title="Mongo::Monitoring::Publishable#publish_event (method)">#publish_event</a></span>, <span class='object_link'><a href="Monitoring/Publishable.html#publish_sdam_event-instance_method" title="Mongo::Monitoring::Publishable#publish_sdam_event (method)">#publish_sdam_event</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(seeds, monitoring, options = Options::Redacted.new)  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Cluster should never be directly instantiated outside of a Client.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>When connecting to a mongodb+srv:// URI, the client expands such a URI into a list of servers and passes that list to the Cluster constructor. When connecting to a standalone mongod, the Cluster constructor receives the corresponding address as an array of one string.</p>
</div>
  </div>


<p>Instantiate the new cluster.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Instantiate the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>seeds</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The addresses of the configured servers</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>monitoring</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The monitoring.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Options::Redacted.new</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options. Client constructor forwards its options to Cluster constructor, although Cluster recognizes only a subset of the options recognized by Client.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:direct_connection</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to connect directly to the specified seed, bypassing topology discovery. Exactly one seed must be provided.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:connect</span>
          <span class="type">(<tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Deprecated - use :direct_connection option instead of this option. The connection method to use. This forces the cluster to behave in the specified way instead of auto-discovering. One of :direct, :replica_set, :sharded</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:replica_set</span>
          <span class="type">(<tt><span class='object_link'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The name of the replica set to connect to. Servers not in this replica set will be ignored.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:scan</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Whether to scan all seeds in constructor. The default in driver version 2.x is to do so; driver version 3.x will not scan seeds in constructor. Opt in to the new behavior by setting this option to false. <strong>Note:</strong> setting this option to nil enables scanning seeds in constructor in driver version 2.x. Driver version 3.x will recognize this option but will ignore it and will never scan seeds in the constructor.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:monitoring_io</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent SDAM-related I/O from being done by this cluster or servers under it. Note: setting this option to false will make the cluster non-functional. It is intended for use in tests which manually invoke SDAM state transitions.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cleanup</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent endSessions command being sent to the server to clean up server sessions when the cluster is disconnected, and to to not start the periodic executor. If :monitoring_io is false, :cleanup automatically defaults to false as well.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:heartbeat_frequency</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The interval, in seconds, for the server monitor to refresh its description via ismaster.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:resolv_options</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>For internal driver use only. Options to pass through to Resolv::DNS constructor for SRV lookups.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 112</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_seeds'>seeds</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Options.html" title="Mongo::Options (module)">Options</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_seeds'>seeds</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Seeds cannot be nil</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:monitoring_io</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='symbol'>:cleanup</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cleanup</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>

  <span class='comment'># @update_lock covers @servers, @connecting, @connected, @topology and
</span>  <span class='comment'># @sessions_supported. Generally instance variables that do not have a
</span>  <span class='comment'># designated for them lock should only be modified under the update lock.
</span>  <span class='comment'># Note that topology change is locked by @update_lock and not by
</span>  <span class='comment'># @sdam_flow_lock.
</span>  <span class='ivar'>@update_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@servers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@monitoring</span> <span class='op'>=</span> <span class='id identifier rubyid_monitoring'>monitoring</span>
  <span class='ivar'>@event_listeners</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Event.html" title="Mongo::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Event/Listeners.html" title="Mongo::Event::Listeners (class)">Listeners</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Event/Listeners.html#initialize-instance_method" title="Mongo::Event::Listeners#initialize (method)">new</a></span></span>
  <span class='ivar'>@app_metadata</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Server/AppMetadata.html" title="Mongo::Server::AppMetadata (class)">AppMetadata</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Server/AppMetadata.html#initialize-instance_method" title="Mongo::Server::AppMetadata#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@options</span><span class='rparen'>)</span>
  <span class='ivar'>@cluster_time_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@cluster_time</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@srv_monitor_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@srv_monitor</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@server_selection_semaphore</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Semaphore.html" title="Mongo::Semaphore (class)">Semaphore</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Semaphore.html#initialize-instance_method" title="Mongo::Semaphore#initialize (method)">new</a></span></span>
  <span class='ivar'>@topology</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span></span><span class='period'>.</span><span class='id identifier rubyid_initial'><span class='object_link'><a href="Cluster/Topology.html#initial-instance_method" title="Mongo::Cluster::Topology#initial (method)">initial</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>  <span class='comment'># State change lock is similar to the sdam flow lock, but is designed
</span>  <span class='comment'># to serialize state changes initated by consumers of Cluster
</span>  <span class='comment'># (e.g. application connecting or disconnecting the cluster), so that
</span>  <span class='comment'># e.g. an application calling disconnect-connect-disconnect rapidly
</span>  <span class='comment'># does not put the cluster into an inconsistent state.
</span>  <span class='comment'># Monitoring updates performed internally by the driver do not take
</span>  <span class='comment'># the state change lock.
</span>
  <span class='ivar'>@state_change_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>  <span class='comment'># @sdam_flow_lock covers just the sdam flow. Note it does not apply
</span>  <span class='comment'># to @topology replacements which are done under @update_lock.
</span>
  <span class='ivar'>@sdam_flow_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='const'><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Session/SessionPool.html" title="Mongo::Session::SessionPool (class)">SessionPool</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Session/SessionPool.html#create-class_method" title="Mongo::Session::SessionPool.create (method)">create</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>

  <span class='comment'># The opening topology is always unknown with no servers.
</span>  <span class='comment'># https://github.com/mongodb/specifications/pull/388
</span>  <span class='id identifier rubyid_opening_topology'>opening_topology</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Cluster/Topology/Unknown.html" title="Mongo::Cluster::Topology::Unknown (class)">Unknown</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster/Topology/Base.html#initialize-instance_method" title="Mongo::Cluster::Topology::Base#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#TOPOLOGY_OPENING-constant" title="Mongo::Monitoring::TOPOLOGY_OPENING (constant)">TOPOLOGY_OPENING</a></span></span><span class='comma'>,</span>
    <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/TopologyOpening.html" title="Mongo::Monitoring::Event::TopologyOpening (class)">TopologyOpening</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/TopologyOpening.html#initialize-instance_method" title="Mongo::Monitoring::Event::TopologyOpening#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opening_topology'>opening_topology</span><span class='rparen'>)</span>
  <span class='rparen'>)</span>

  <span class='ivar'>@seeds</span> <span class='op'>=</span> <span class='id identifier rubyid_seeds'>seeds</span> <span class='op'>=</span> <span class='id identifier rubyid_seeds'>seeds</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='id identifier rubyid_servers'>servers</span> <span class='op'>=</span> <span class='id identifier rubyid_seeds'>seeds</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_seed'>seed</span><span class='op'>|</span>
    <span class='comment'># Server opening events must be sent after topology change events.
</span>    <span class='comment'># Therefore separate server addition, done here before topoolgy change
</span>    <span class='comment'># event is published, from starting to monitor the server which is
</span>    <span class='comment'># done later.
</span>    <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_seed'>seed</span><span class='comma'>,</span> <span class='label'>monitor:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_seeds'>seeds</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;=</span> <span class='int'>1</span>    <span class='comment'># Recreate the topology to get the current server list into it
</span>
    <span class='ivar'>@topology</span> <span class='op'>=</span> <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_monitoring'>monitoring</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#TOPOLOGY_CHANGED-constant" title="Mongo::Monitoring::TOPOLOGY_CHANGED (constant)">TOPOLOGY_CHANGED</a></span></span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/TopologyChanged.html" title="Mongo::Monitoring::Event::TopologyChanged (class)">TopologyChanged</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/TopologyChanged.html#initialize-instance_method" title="Mongo::Monitoring::Event::TopologyChanged#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opening_topology'>opening_topology</span><span class='comma'>,</span> <span class='ivar'>@topology</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:monitoring_io</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>false</span>    <span class='comment'># Omit periodic executor construction, because without servers
</span>    <span class='comment'># no commands can be sent to the cluster and there shouldn&#39;t ever
</span>    <span class='comment'># be anything that needs to be cleaned up.
</span>    <span class='comment'>#
</span>    <span class='comment'># Omit monitoring individual servers and the legacy single round of
</span>    <span class='comment'># of SDAM on the main thread, as it would race with tests that mock
</span>    <span class='comment'># SDAM responses.
</span>
    <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># Update instance variables prior to starting monitoring threads.
</span>  <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cleanup</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='ivar'>@cursor_reaper</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/CursorReaper.html" title="Mongo::Cluster::CursorReaper (class)">CursorReaper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster/CursorReaper.html#initialize-instance_method" title="Mongo::Cluster::CursorReaper#initialize (method)">new</a></span></span>
    <span class='ivar'>@socket_reaper</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/SocketReaper.html" title="Mongo::Cluster::SocketReaper (class)">SocketReaper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster/SocketReaper.html#initialize-instance_method" title="Mongo::Cluster::SocketReaper#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='ivar'>@periodic_executor</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/PeriodicExecutor.html" title="Mongo::Cluster::PeriodicExecutor (class)">PeriodicExecutor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster/PeriodicExecutor.html#initialize-instance_method" title="Mongo::Cluster::PeriodicExecutor#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='lbracket'>[</span>
      <span class='ivar'>@cursor_reaper</span><span class='comma'>,</span> <span class='ivar'>@socket_reaper</span><span class='comma'>,</span>
    <span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

    <span class='const'>ObjectSpace</span><span class='period'>.</span><span class='id identifier rubyid_define_finalizer'>define_finalizer</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span><span class='lparen'>(</span>
      <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='ivar'>@periodic_executor</span><span class='comma'>,</span> <span class='ivar'>@session_pool</span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='ivar'>@periodic_executor</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span>
  <span class='kw'>end</span>

  <span class='comment'># Need to record start time prior to starting monitoring
</span>  <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

  <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
    <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_start_monitoring'>start_monitoring</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:scan</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_server_selection_timeout'>server_selection_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:server_selection_timeout</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ServerSelector.html#SERVER_SELECTION_TIMEOUT-constant" title="Mongo::ServerSelector::SERVER_SELECTION_TIMEOUT (constant)">SERVER_SELECTION_TIMEOUT</a></span></span>    <span class='comment'># The server selection timeout can be very short especially in
</span>    <span class='comment'># tests, when the client waits for a synchronous scan before
</span>    <span class='comment'># starting server selection. Limiting the scan to server selection time
</span>    <span class='comment'># then aborts the scan before it can process even local servers.
</span>    <span class='comment'># Therefore, allow at least 3 seconds for the scan here.
</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_server_selection_timeout'>server_selection_timeout</span> <span class='op'>&lt;</span> <span class='int'>3</span>
      <span class='id identifier rubyid_server_selection_timeout'>server_selection_timeout</span> <span class='op'>=</span> <span class='int'>3</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>=</span> <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>+</span> <span class='id identifier rubyid_server_selection_timeout'>server_selection_timeout</span>    <span class='comment'># Wait for the first scan of each server to complete, for
</span>    <span class='comment'># backwards compatibility.
</span>    <span class='comment'># If any servers are discovered during this SDAM round we are going to
</span>    <span class='comment'># wait for these servers to also be queried, and so on, up to the
</span>    <span class='comment'># server selection timeout or the 3 second minimum.
</span>
    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='comment'># Ensure we do not try to read the servers list while SDAM is running
</span>      <span class='id identifier rubyid_servers'>servers</span> <span class='op'>=</span> <span class='ivar'>@sdam_flow_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_last_scan'>last_scan</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_last_scan'>last_scan</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_start_time'>start_time</span> <span class='rbrace'>}</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_time_remaining'>time_remaining</span> <span class='op'>=</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>-</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_log_debug'>log_debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Waiting for up to </span><span class='embexpr_beg'>#{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%.2f</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time_remaining'>time_remaining</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds for servers to be scanned: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>      <span class='comment'># Since the semaphore may have been signaled between us checking
</span>      <span class='comment'># the servers list above and the wait call below, we should not
</span>      <span class='comment'># wait for the full remaining time - wait for up to 1 second, then
</span>      <span class='comment'># recheck the state.
</span>
      <span class='id identifier rubyid_server_selection_semaphore'>server_selection_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_wait'>wait</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_time_remaining'>time_remaining</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_start_stop_srv_monitor'>start_stop_srv_monitor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="app_metadata-instance_method">
  
    #<strong>app_metadata</strong>  &#x21d2; <tt><span class='object_link'><a href="Server/AppMetadata.html" title="Mongo::Server::AppMetadata (class)">Mongo::Server::AppMetadata</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The application metadata, used for connection handshakes.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server/AppMetadata.html" title="Mongo::Server::AppMetadata (class)">Mongo::Server::AppMetadata</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The application metadata, used for connection handshakes.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.4.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


289
290
291</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 289</span>

<span class='kw'>def</span> <span class='id identifier rubyid_app_metadata'>app_metadata</span>
  <span class='ivar'>@app_metadata</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="monitoring-instance_method">
  
    #<strong>monitoring</strong>  &#x21d2; <tt><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns monitoring The monitoring.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>monitoring The monitoring.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 280</span>

<span class='kw'>def</span> <span class='id identifier rubyid_monitoring'>monitoring</span>
  <span class='ivar'>@monitoring</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="options-instance_method">
  
    #<strong>options</strong>  &#x21d2; <tt>Hash</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The options hash.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The options hash.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_options'>options</span>
  <span class='ivar'>@options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="seeds-instance_method">
  
    #<strong>seeds</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Returns The addresses of seed servers. Contains addresses that were given to Cluster when it was instantiated, not current addresses that the cluster is using as a result of SDAM.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The addresses of seed servers. Contains addresses that were given to Cluster when it was instantiated, not current addresses that the cluster is using as a result of SDAM.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.7.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


297
298
299</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 297</span>

<span class='kw'>def</span> <span class='id identifier rubyid_seeds'>seeds</span>
  <span class='ivar'>@seeds</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="server_selection_semaphore-instance_method">
  
    #<strong>server_selection_semaphore</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 446</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server_selection_semaphore'>server_selection_semaphore</span>
  <span class='ivar'>@server_selection_semaphore</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="session_pool-instance_method">
  
    #<strong>session_pool</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


302
303
304</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 302</span>

<span class='kw'>def</span> <span class='id identifier rubyid_session_pool'>session_pool</span>
  <span class='ivar'>@session_pool</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="srv_monitor-instance_method">
  
    #<strong>srv_monitor</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


316
317
318</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 316</span>

<span class='kw'>def</span> <span class='id identifier rubyid_srv_monitor'>srv_monitor</span>
  <span class='ivar'>@srv_monitor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="topology-instance_method">
  
    #<strong>topology</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The logical session timeout value in minutes.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the logical session timeout in minutes.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The logical session timeout.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 283</span>

<span class='kw'>def</span> <span class='id identifier rubyid_topology'>topology</span>
  <span class='ivar'>@topology</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-class_method">
  
    .<strong>create</strong>(client)  &#x21d2; <tt><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Create a cluster for the provided client, for use when we don&#39;t want the client&#39;s original cluster instance to be the same.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Create a cluster for the client.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>client</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Client.html" title="Mongo::Client (class)">Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The client to create on.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cluster.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 267</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Mongo::Cluster#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring.html#initialize-instance_method" title="Mongo::Monitoring#initialize (method)">new</a></span></span><span class='comma'>,</span>
    <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_cluster_options'>cluster_options</span><span class='comma'>,</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@cluster</span><span class='comma'>,</span> <span class='id identifier rubyid_cluster'>cluster</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="finalize-class_method">
  
    .<strong>finalize</strong>(pools, periodic_executor, session_pool)  &#x21d2; <tt>Proc</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Finalize the cluster for garbage collection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Finalize the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='const'><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span><span class='lparen'>(</span><span class='id identifier rubyid_pools'>pools</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pools</span>
      
      
        <span class='type'>(<tt>Hash&lt;<span class='object_link'><a href="Address.html" title="Mongo::Address (class)">Address</a></span>, <span class='object_link'><a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">Server::ConnectionPool</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Ignored.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>periodic_executor</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Cluster/PeriodicExecutor.html" title="Mongo::Cluster::PeriodicExecutor (class)">PeriodicExecutor</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The periodic executor.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>session_pool</span>
      
      
        <span class='type'>(<tt>SessionPool</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The session pool.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Finalizer.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.2.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


460
461
462
463
464
465</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 460</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span><span class='lparen'>(</span><span class='id identifier rubyid_pools'>pools</span><span class='comma'>,</span> <span class='id identifier rubyid_periodic_executor'>periodic_executor</span><span class='comma'>,</span> <span class='id identifier rubyid_session_pool'>session_pool</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_session_pool'>session_pool</span><span class='period'>.</span><span class='id identifier rubyid_end_sessions'>end_sessions</span>
    <span class='id identifier rubyid_periodic_executor'>periodic_executor</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="==-instance_method">
  
    #<strong>==</strong>(other)  &#x21d2; <tt>true</tt>, <tt>false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine if this cluster of servers is equal to another object. Checks the servers currently in the cluster, not what was configured.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Is the cluster equal to the object?</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>other</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The object to compare to.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the objects are equal.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


683
684
685
686</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 683</span>

<span class='kw'>def</span> <span class='op'>==</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="" title="Mongo::Cluster (class)">Cluster</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="add-instance_method">
  
    #<strong>add</strong>(host, add_options = nil)  &#x21d2; <tt><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a server to the cluster with the provided address. Useful in auto-discovery of new servers when an existing server executes an ismaster and potentially non-configured servers were included.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Add the server for the address to the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27018</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The address of the server to add.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a customizable set of options</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The newly added server, if not present already.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 781</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_add_options'>add_options</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Address.html" title="Mongo::Address (class)">Address</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Address.html#initialize-instance_method" title="Mongo::Address#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Server.html#initialize-instance_method" title="Mongo::Server#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_event_listeners'>event_listeners</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span>
      <span class='label'>monitor:</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='comment'># Need to recheck whether server is present in @servers, because
</span>      <span class='comment'># the previous check was not under a lock.
</span>      <span class='comment'># Since we are under the update lock here, we cannot call servers_list.
</span>      <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:address</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>

      <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_add_options'>add_options</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_add_options'>add_options</span><span class='lbracket'>[</span><span class='symbol'>:monitor</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_start_monitoring'>start_monitoring</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_server'>server</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="addresses-instance_method">
  
    #<strong>addresses</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Address.html" title="Mongo::Address (class)">Mongo::Address</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The addresses in the cluster.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the addresses in the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_addresses'>addresses</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Address.html" title="Mongo::Address (class)">Mongo::Address</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The addresses.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.6</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


409
410
411</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 409</span>

<span class='kw'>def</span> <span class='id identifier rubyid_addresses'>addresses</span>
  <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:address</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connected?-instance_method">
  
    #<strong>connected?</strong>  &#x21d2; <tt>true|false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Whether the cluster object is connected to its cluster.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true|false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether the cluster is connected.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.7.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


382
383
384
385
386</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 382</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connected?'>connected?</span>
  <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@connected</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connecting?-instance_method">
  
    #<strong>connecting?</strong>  &#x21d2; <tt>true|false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Whether the cluster object is in the process of connecting to its cluster.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true|false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether the cluster is connecting.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


370
371
372
373
374</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connecting?'>connecting?</span>
  <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@connecting</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect!-instance_method">
  
    #<strong>disconnect!</strong>  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Applications should call Client#close to disconnect from</p>
</div>
  </div>


<p>Closes the cluster.</p>

<p>the cluster rather than calling this method. This method is for internal driver use only.</p>

<p>Disconnects all servers in the cluster, publishing appropriate SDAM events in the process. Stops SRV monitoring if it is active. Marks the cluster disconnected.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 480</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect!'>disconnect!</span>
  <span class='ivar'>@state_change_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connecting?'>connecting?</span> <span class='op'>||</span> <span class='id identifier rubyid_connected?'>connected?</span>
      <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:cleanup</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_session_pool'>session_pool</span><span class='period'>.</span><span class='id identifier rubyid_end_sessions'>end_sessions</span>
      <span class='ivar'>@periodic_executor</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>
    <span class='kw'>end</span>
    <span class='ivar'>@srv_monitor_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@srv_monitor</span>
        <span class='ivar'>@srv_monitor</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_connected?'>connected?</span>
        <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span>
        <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
          <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#SERVER_CLOSED-constant" title="Mongo::Monitoring::SERVER_CLOSED (constant)">SERVER_CLOSED</a></span></span><span class='comma'>,</span>
          <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/ServerClosed.html" title="Mongo::Monitoring::Event::ServerClosed (class)">ServerClosed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/ServerClosed.html#initialize-instance_method" title="Mongo::Monitoring::Event::ServerClosed#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'>topology</span><span class='rparen'>)</span>
        <span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#TOPOLOGY_CLOSED-constant" title="Mongo::Monitoring::TOPOLOGY_CLOSED (constant)">TOPOLOGY_CLOSED</a></span></span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/TopologyClosed.html" title="Mongo::Monitoring::Event::TopologyClosed (class)">TopologyClosed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/TopologyClosed.html#initialize-instance_method" title="Mongo::Monitoring::Event::TopologyClosed#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_topology'>topology</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect_server_if_connected-instance_method">
  
    #<strong>disconnect_server_if_connected</strong>(server)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


879
880
881
882
883
884
885
886
887</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 879</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect_server_if_connected'>disconnect_server_if_connected</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_connected?'>connected?</span>
    <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_disconnect!'>disconnect!</span>
    <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#SERVER_CLOSED-constant" title="Mongo::Monitoring::SERVER_CLOSED (constant)">SERVER_CLOSED</a></span></span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/ServerClosed.html" title="Mongo::Monitoring::Event::ServerClosed (class)">ServerClosed</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/ServerClosed.html#initialize-instance_method" title="Mongo::Monitoring::Event::ServerClosed#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'>topology</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_readable_server?-instance_method">
  
    #<strong>has_readable_server?</strong>(server_selector = nil)  &#x21d2; <tt>true</tt>, <tt>false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine if the cluster would select a readable server for the provided read preference.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Is a readable server present?</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span><span class='lparen'>(</span><span class='id identifier rubyid_server_selector'>server_selector</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_selector</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The server selector.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If a readable server is present.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.4.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


700
701
702</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 700</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span><span class='lparen'>(</span><span class='id identifier rubyid_server_selector'>server_selector</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_server_selector'>server_selector</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_writable_server?-instance_method">
  
    #<strong>has_writable_server?</strong>  &#x21d2; <tt>true</tt>, <tt>false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine if the cluster would select a writable server.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Is a writable server present?</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If a writable server is present.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.4.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


712
713
714</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 712</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span>
  <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="heartbeat_interval-instance_method">
  
    #<strong>heartbeat_interval</strong>  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Get the refresh interval for the server. This will be defined via an option or will default to 10.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The heartbeat interval, in seconds.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.10.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 361</span>

<span class='kw'>def</span> <span class='id identifier rubyid_heartbeat_interval'>heartbeat_interval</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:heartbeat_frequency</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Server/Monitor.html" title="Mongo::Server::Monitor (class)">Monitor</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Server/Monitor.html#DEFAULT_HEARTBEAT_INTERVAL-constant" title="Mongo::Server::Monitor::DEFAULT_HEARTBEAT_INTERVAL (constant)">DEFAULT_HEARTBEAT_INTERVAL</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the nicer formatted string for use in inspection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Inspect the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cluster inspection.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Cluster:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> servers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_servers'>servers</span><span class='embexpr_end'>}</span><span class='tstring_content'> topology=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_read_retries-instance_method">
  
    #<strong>max_read_retries</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>max_read_retries should be retrieved from the Client instance, not from a Cluster instance, because clusters may be shared between clients with different values for max read retries.</p>
</div>
  </div>


<p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the max read retries.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_max_read_retries'>max_read_retries</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The maximum number of retries.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 332</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_read_retries'>max_read_retries</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:max_read_retries</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#MAX_READ_RETRIES-constant" title="Mongo::Cluster::MAX_READ_RETRIES (constant)">MAX_READ_RETRIES</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="next_primary-instance_method">
  
    #<strong>next_primary</strong>(ping = nil, session = nil)  &#x21d2; <tt><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Mongo::Server</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the next primary server we can send an operation to.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the next primary server.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_next_primary'>next_primary</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>ping</span>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Whether to ping the server before selection. Deprecated and ignored.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>session</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Session.html" title="Mongo::Session (class)">Session</a></span> | nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Optional session to take into account for mongos pinning.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Mongo::Server</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A primary server.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


729
730
731</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 729</span>

<span class='kw'>def</span> <span class='id identifier rubyid_next_primary'>next_primary</span><span class='lparen'>(</span><span class='id identifier rubyid_ping'>ping</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></span><span class='period'>.</span><span class='id identifier rubyid_primary'><span class='object_link'><a href="ServerSelector.html#primary-instance_method" title="Mongo::ServerSelector#primary (method)">primary</a></span></span><span class='period'>.</span><span class='id identifier rubyid_select_server'>select_server</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pool-instance_method">
  
    #<strong>pool</strong>(server)  &#x21d2; <tt><span class='object_link'><a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">Server::ConnectionPool</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

<p>Get the connection pool for the server.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the connection pool.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_pool'>pool</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The server.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">Server::ConnectionPool</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The connection pool.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.2.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


744
745
746</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 744</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pool'>pool</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_pool'>pool</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_retry_interval-instance_method">
  
    #<strong>read_retry_interval</strong>  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>read_retry_interval should be retrieved from the Client instance, not from a Cluster instance, because clusters may be shared between clients with different values for the read retry interval.</p>
</div>
  </div>


<p>Get the interval, in seconds, in which read retries when using legacy read retries.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the read retry interval.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The interval.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


350
351
352</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 350</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:read_retry_interval</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="#READ_RETRY_INTERVAL-constant" title="Mongo::Cluster::READ_RETRY_INTERVAL (constant)">READ_RETRY_INTERVAL</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconnect!-instance_method">
  
    #<strong>reconnect!</strong>  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Use Client#reconnect to reconnect to the cluster instead of calling this method. This method does not send SDAM events.</p>
</div></div>

<p>Reconnect all servers.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Reconnect the cluster&#39;s servers.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_reconnect!'>reconnect!</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.1.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 524</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reconnect!'>reconnect!</span>
  <span class='ivar'>@state_change_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_scan!'>scan!</span>
    <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_reconnect!'>reconnect!</span>
    <span class='kw'>end</span>
    <span class='ivar'>@periodic_executor</span><span class='period'>.</span><span class='id identifier rubyid_restart!'>restart!</span>
    <span class='ivar'>@srv_monitor_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@srv_monitor</span>
        <span class='ivar'>@srv_monitor</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove-instance_method">
  
    #<strong>remove</strong>(host, disconnect: true)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span>&gt; | true | false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The return value of this method is not part of the driver&#39;s public API.</p>
</div>
  </div>


<p>Remove the server from the cluster for the provided address, if it exists.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Remove the server from the cluster.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The host/port or socket address.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>disconnect</span>
      
      
        <span class='type'>(<tt>true | false</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Whether to disconnect the servers being removed. For internal driver use only.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span>&gt; | true | false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If disconnect is any value other than false, including nil, returns whether any servers were removed. If disconnect is false, returns an array of servers that were removed (and should be disconnected by the caller).</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 820</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>disconnect:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Address.html" title="Mongo::Address (class)">Address</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Address.html#initialize-instance_method" title="Mongo::Address#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_removed_servers'>removed_servers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span> <span class='op'>==</span> <span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_delete'>delete</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_delete'>delete</span>
          <span class='id identifier rubyid_removed_servers'>removed_servers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_server'>server</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_disconnect'>disconnect</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_disconnect_server_if_connected'>disconnect_server_if_connected</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_disconnect'>disconnect</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_sdam_flow-instance_method">
  
    #<strong>run_sdam_flow</strong>(previous_desc, updated_desc, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Runs SDAM flow on the cluster.</p>

<p>This method can be invoked to process a new server description returned by the server on a monitoring or non-monitoring connection, and also by the driver when it marks a server unknown as a result of a (network) error.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>previous_desc</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server/Description.html" title="Mongo::Server::Description (class)">Server::Description</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Previous server description.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>updated_desc</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Server/Description.html" title="Mongo::Server::Description (class)">Server::Description</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The changed description.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Options.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:keep_connection_pool</span>
          <span class="type">(<tt>true | false</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Usually when the new server description is unknown, the connection pool on the respective server is cleared. Set this option to true to keep the existing connection pool (required when handling not master errors on 4.2+ servers).</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 604</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_sdam_flow'>run_sdam_flow</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_desc'>previous_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@sdam_flow_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_flow'>flow</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Cluster/SdamFlow.html" title="Mongo::Cluster::SdamFlow (class)">SdamFlow</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Cluster/SdamFlow.html#initialize-instance_method" title="Mongo::Cluster::SdamFlow#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_previous_desc'>previous_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_flow'>flow</span><span class='period'>.</span><span class='id identifier rubyid_server_description_changed'>server_description_changed</span>

    <span class='comment'># SDAM flow may alter the updated description - grab the final
</span>    <span class='comment'># version for the purposes of broadcasting if a server is available
</span>    <span class='id identifier rubyid_updated_desc'>updated_desc</span> <span class='op'>=</span> <span class='id identifier rubyid_flow'>flow</span><span class='period'>.</span><span class='id identifier rubyid_updated_desc'>updated_desc</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:keep_connection_pool</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_flow'>flow</span><span class='period'>.</span><span class='id identifier rubyid_became_unknown?'>became_unknown?</span>
        <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span> <span class='op'>==</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span>
            <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_clear_connection_pool'>clear_connection_pool</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_start_stop_srv_monitor'>start_stop_srv_monitor</span>
  <span class='kw'>end</span>

  <span class='comment'># Some updated descriptions, e.g. a mismatched me one, result in the
</span>  <span class='comment'># server whose description we are processing being removed from
</span>  <span class='comment'># the topology. When this happens, the server&#39;s monitoring thread gets
</span>  <span class='comment'># killed. As a result, any code after the flow invocation may not run
</span>  <span class='comment'># a particular monitor instance, hence there should generally not be
</span>  <span class='comment'># any code in this method past the flow invocation.
</span>  <span class='comment'>#
</span>  <span class='comment'># However, this broadcast call can be here because if the monitoring
</span>  <span class='comment'># thread got killed the server should have been closed and no client
</span>  <span class='comment'># should be currently waiting for it, thus not signaling the semaphore
</span>  <span class='comment'># shouldn&#39;t cause any problems.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='period'>.</span><span class='id identifier rubyid_unknown?'>unknown?</span>
    <span class='id identifier rubyid_server_selection_semaphore'>server_selection_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_broadcast'>broadcast</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="scan!-instance_method">
  
    #<strong>scan!</strong>(sync = true)  &#x21d2; <tt>true</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>In both synchronous and asynchronous scans, each monitor thread maintains a minimum interval between scans, meaning calling this method may not initiate a scan on a particular server the very next instant.</p>
</div>
  </div>


<p>Force a scan of all known servers in the cluster.</p>

<p>If the sync parameter is true which is the default, the scan is performed synchronously in the thread which called this method. Each server in the cluster is checked sequentially. If there are many servers in the cluster or they are slow to respond, this can be a long running operation.</p>

<p>If the sync parameter is false, this method instructs all server monitor threads to perform an immediate scan and returns without waiting for scan results.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Force a full cluster scan.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_scan!'>scan!</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Always true.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 569</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scan!'>scan!</span><span class='lparen'>(</span><span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_sync'>sync</span>
    <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_monitor'>monitor</span>
        <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_monitor'>monitor</span><span class='period'>.</span><span class='id identifier rubyid_scan!'>scan!</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_log_warn'>log_warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Synchronous scan requested on cluster </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'> but server </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server'>server</span><span class='embexpr_end'>}</span><span class='tstring_content'> has no monitor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_scan_semaphore'>scan_semaphore</span><span class='period'>.</span><span class='id identifier rubyid_signal'>signal</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="servers-instance_method">
  
    #<strong>servers</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get a list of server candidates from the cluster that can have operations executed on them.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get the server candidates for an operation.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_servers'>servers</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Server.html" title="Mongo::Server (class)">Server</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The candidate servers.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 397</span>

<span class='kw'>def</span> <span class='id identifier rubyid_servers'>servers</span>
  <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_servers'>servers</span><span class='lparen'>(</span><span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="servers_list-instance_method">
  
    #<strong>servers_list</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


872
873
874
875
876</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 872</span>

<span class='kw'>def</span> <span class='id identifier rubyid_servers_list'>servers_list</span>
  <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sessions_supported?-instance_method">
  
    #<strong>sessions_supported?</strong>  &#x21d2; <tt>true | false</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Returns whether the deployment that the driver is connected to supports sessions.</p>

<p>Session support may change over time, for example due to servers in the deployment being upgraded or downgraded. This method returns the current information if the client is connected to at least one data bearing server. If the client is currently not connected to any data bearing servers, this method returns the last known value for whether the deployment supports sessions.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true | false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Whether deployment supports sessions.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 901</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sessions_supported?'>sessions_supported?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_data_bearing_servers?'>data_bearing_servers?</span>
    <span class='kw'>return</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
  <span class='kw'>end</span>

  <span class='comment'># No data bearing servers known - perform server selection to try to
</span>  <span class='comment'># get a response from at least one of them, to return an accurate
</span>  <span class='comment'># assessment of whether sessions are currently supported.
</span>  <span class='kw'>begin</span>
    <span class='const'><span class='object_link'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="ServerSelector.html#get-instance_method" title="Mongo::ServerSelector#get (method)">get</a></span></span><span class='lparen'>(</span><span class='label'>mode:</span> <span class='symbol'>:primary_preferred</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select_server'>select_server</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Error.html" title="Mongo::Error (class)">Error</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Error/NoServerAvailable.html" title="Mongo::Error::NoServerAvailable (class)">NoServerAvailable</a></span></span>    <span class='comment'># We haven&#39;t been able to contact any servers - use last known
</span>    <span class='comment'># value for esssion support.
</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@sessions_supported</span> <span class='op'>||</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_server_list-instance_method">
  
    #<strong>set_server_list</strong>(server_address_strs)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>

<p>Sets the list of servers to the addresses in the provided list of address strings.</p>

<p>This method is called by the SRV monitor after receiving new DNS records for the monitored hostname.</p>

<p>Removes servers in the cluster whose addresses are not in the passed list of server addresses, and adds servers for any addresses in the argument which are not already in the cluster.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_address_strs</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>List of server addresses to sync the cluster servers to.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


656
657
658
659
660
661
662
663
664
665
666
667
668
669
670</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 656</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_server_list'>set_server_list</span><span class='lparen'>(</span><span class='id identifier rubyid_server_address_strs'>server_address_strs</span><span class='rparen'>)</span>
  <span class='ivar'>@sdam_flow_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_server_address_strs'>server_address_strs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_address_str'>address_str</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='period'>.</span><span class='id identifier rubyid_seed'>seed</span> <span class='op'>==</span> <span class='id identifier rubyid_address_str'>address_str</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_address_str'>address_str</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_server_address_strs'>server_address_strs</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_address_str'>address_str</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='period'>.</span><span class='id identifier rubyid_seed'>seed</span> <span class='op'>==</span> <span class='id identifier rubyid_address_str'>address_str</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_remove'>remove</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_address'>address</span><span class='period'>.</span><span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="summary-instance_method">
  
    #<strong>summary</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method is experimental and subject to change.</p>
</div>
  </div>



  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.7.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


439
440
441
442
443</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 439</span>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Cluster </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>topology=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='op'>+</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>servers=[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_servers_list'>servers_list</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:summary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_cluster_time-instance_method">
  
    #<strong>update_cluster_time</strong>(result)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update the max cluster time seen in a response.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Update the cluster time.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_cluster'>cluster</span><span class='period'>.</span><span class='id identifier rubyid_update_cluster_time'>update_cluster_time</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>result</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Operation/Result.html" title="Mongo::Operation::Result (class)">Operation::Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The operation result containing the cluster time.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cluster time.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.5.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


758
759
760
761
762
763
764</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 758</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_cluster_time'>update_cluster_time</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cluster_time_doc'>cluster_time_doc</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_cluster_time'>cluster_time</span>
    <span class='ivar'>@cluster_time_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_advance_cluster_time'>advance_cluster_time</span><span class='lparen'>(</span><span class='id identifier rubyid_cluster_time_doc'>cluster_time_doc</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_topology-instance_method">
  
    #<strong>update_topology</strong>(new_topology)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>2.0.0</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mongo/cluster.rb', line 845</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_topology'>update_topology</span><span class='lparen'>(</span><span class='id identifier rubyid_new_topology'>new_topology</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_old_topology'>old_topology</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_old_topology'>old_topology</span> <span class='op'>=</span> <span class='id identifier rubyid_topology'>topology</span>
    <span class='ivar'>@topology</span> <span class='op'>=</span> <span class='id identifier rubyid_new_topology'>new_topology</span>
  <span class='kw'>end</span>

  <span class='comment'># If new topology has data bearing servers, we know for sure whether
</span>  <span class='comment'># sessions are supported - update our cached value.
</span>  <span class='comment'># If new topology has no data bearing servers, leave the old value
</span>  <span class='comment'># as it is and sessions_supported? method will perform server selection
</span>  <span class='comment'># to try to determine session support accurately, falling back to the
</span>  <span class='comment'># last known value.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_data_bearing_servers?'>data_bearing_servers?</span>
    <span class='id identifier rubyid_sessions_supported'>sessions_supported</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_topology'>topology</span><span class='period'>.</span><span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
    <span class='ivar'>@update_lock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@sessions_supported</span> <span class='op'>=</span> <span class='id identifier rubyid_sessions_supported'>sessions_supported</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring.html#TOPOLOGY_CHANGED-constant" title="Mongo::Monitoring::TOPOLOGY_CHANGED (constant)">TOPOLOGY_CHANGED</a></span></span><span class='comma'>,</span>
    <span class='const'><span class='object_link'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Monitoring/Event/TopologyChanged.html" title="Mongo::Monitoring::Event::TopologyChanged (class)">TopologyChanged</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Monitoring/Event/TopologyChanged.html#initialize-instance_method" title="Mongo::Monitoring::Event::TopologyChanged#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_old_topology'>old_topology</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'>topology</span><span class='rparen'>)</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue May 26 19:51:32 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>